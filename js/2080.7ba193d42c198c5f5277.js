"use strict";(self.webpackChunksources=self.webpackChunksources||[]).push([[2080,1530],{12080:(t,e,n)=>{n.r(e),n.d(e,{FlagContext:()=>U,FlagProvider:()=>P,InMemoryStorageProvider:()=>d,LocalStorageProvider:()=>p,UnleashClient:()=>N,default:()=>P,useFlag:()=>D,useFlags:()=>j,useFlagsStatus:()=>A,useUnleashClient:()=>_,useUnleashContext:()=>M,useVariant:()=>H});var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},o=function(){return o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},o.apply(this,arguments)};function s(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}c((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var a={exports:{}};function c(){}c.prototype={on:function(t,e,n){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var r=this;function o(){r.off(t,o),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),r=n[t],o=[];if(r&&e)for(var s=0,i=r.length;s<i;s++)r[s].fn!==e&&r[s].fn._!==e&&o.push(r[s]);return o.length?n[t]=o:delete n[t],this}},a.exports=c;var u=a.exports.TinyEmitter=c,l=function(t){return null!=t[1]},h=function(){},f=function(){function t(t){var e=t.onError,n=t.onSent,r=t.appName,o=t.metricsInterval,s=t.disableMetrics,i=void 0!==s&&s,a=t.url,c=t.clientKey,u=t.fetch,l=t.headerName,f=t.customHeaders,d=void 0===f?{}:f;this.onError=e,this.onSent=n||h,this.disabled=i,this.metricsInterval=1e3*o,this.appName=r,this.url=a instanceof URL?a:new URL(a),this.clientKey=c,this.bucket=this.createEmptyBucket(),this.fetch=u,this.headerName=l,this.customHeaders=d}return t.prototype.start=function(){var t=this;if(this.disabled)return!1;"number"==typeof this.metricsInterval&&this.metricsInterval>0&&setTimeout((function(){t.startTimer(),t.sendMetrics()}),2e3)},t.prototype.stop=function(){this.timer&&(clearTimeout(this.timer),delete this.timer)},t.prototype.createEmptyBucket=function(){return{start:new Date,stop:null,toggles:{}}},t.prototype.getHeaders=function(){var t,e=((t={})[this.headerName]=this.clientKey,t.Accept="application/json",t["Content-Type"]="application/json",t);return Object.entries(this.customHeaders).filter(l).forEach((function(t){var n=t[0],r=t[1];return e[n]=r})),e},t.prototype.sendMetrics=function(){return s(this,void 0,void 0,(function(){var t,e,n;return i(this,(function(r){switch(r.label){case 0:if(t="".concat(this.url,"/client/metrics"),e=this.getPayload(),this.bucketIsEmpty(e))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.fetch(t,{cache:"no-cache",method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)})];case 2:return r.sent(),this.onSent(e),[3,4];case 3:return n=r.sent(),console.error("Unleash: unable to send feature metrics",n),this.onError(n),[3,4];case 4:return[2]}}))}))},t.prototype.count=function(t,e){return!(this.disabled||!this.bucket||(this.assertBucket(t),this.bucket.toggles[t][e?"yes":"no"]++,0))},t.prototype.countVariant=function(t,e){return!(this.disabled||!this.bucket||(this.assertBucket(t),this.bucket.toggles[t].variants[e]?this.bucket.toggles[t].variants[e]+=1:this.bucket.toggles[t].variants[e]=1,0))},t.prototype.assertBucket=function(t){if(this.disabled||!this.bucket)return!1;this.bucket.toggles[t]||(this.bucket.toggles[t]={yes:0,no:0,variants:{}})},t.prototype.startTimer=function(){var t=this;this.timer=setInterval((function(){t.sendMetrics()}),this.metricsInterval)},t.prototype.bucketIsEmpty=function(t){return 0===Object.keys(t.bucket.toggles).length},t.prototype.getPayload=function(){var t=o(o({},this.bucket),{stop:new Date});return this.bucket=this.createEmptyBucket(),{bucket:t,appName:this.appName,instanceId:"browser"}},t}(),d=function(){function t(){this.store=new Map}return t.prototype.save=function(t,e){return s(this,void 0,void 0,(function(){return i(this,(function(n){return this.store.set(t,e),[2]}))}))},t.prototype.get=function(t){return s(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.store.get(t)]}))}))},t}(),p=function(){function t(){this.prefix="unleash:repository"}return t.prototype.save=function(t,e){return s(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){n=JSON.stringify(e),r="".concat(this.prefix,":").concat(t);try{window.localStorage.setItem(r,n)}catch(t){console.error(t)}return[2]}))}))},t.prototype.get=function(t){try{var e="".concat(this.prefix,":").concat(t),n=window.localStorage.getItem(e);return n?JSON.parse(n):void 0}catch(t){console.error(t)}},t}();let v;const g=new Uint8Array(16);function y(){if(!v&&(v="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!v))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return v(g)}const m=[];for(let t=0;t<256;++t)m.push((t+256).toString(16).slice(1));var b={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function w(t,e,n){if(b.randomUUID&&!e&&!t)return b.randomUUID();const r=(t=t||{}).random||(t.rng||y)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=r[t];return e}return function(t,e=0){return m[t[e+0]]+m[t[e+1]]+m[t[e+2]]+m[t[e+3]]+"-"+m[t[e+4]]+m[t[e+5]]+"-"+m[t[e+6]]+m[t[e+7]]+"-"+m[t[e+8]]+m[t[e+9]]+"-"+m[t[e+10]]+m[t[e+11]]+m[t[e+12]]+m[t[e+13]]+m[t[e+14]]+m[t[e+15]]}(r)}var E=function(){function t(){}return t.prototype.generateEventId=function(){return w()},t.prototype.createImpressionEvent=function(t,e,n,r,s,i){var a=this.createBaseEvent(t,e,n,r,s);return i?o(o({},a),{variant:i}):a},t.prototype.createBaseEvent=function(t,e,n,r,o){return{eventType:r,eventId:this.generateEventId(),context:t,enabled:e,featureName:n,impressionData:o}},t}(),x=["userId","sessionId","remoteAddress"],I="error",S="ready",T="impression",k={name:"disabled",enabled:!1,feature_enabled:!1},O="repo",N=function(t){function e(e){var n=e.storageProvider,r=e.url,s=e.clientKey,i=e.disableRefresh,a=void 0!==i&&i,c=e.refreshInterval,u=void 0===c?30:c,l=e.metricsInterval,h=void 0===l?30:l,v=e.disableMetrics,g=void 0!==v&&v,y=e.appName,m=e.environment,b=void 0===m?"default":m,w=e.context,x=e.fetch,S=void 0===x?function(){try{if("undefined"!=typeof window&&"fetch"in window)return fetch.bind(window);if("fetch"in globalThis)return fetch.bind(globalThis)}catch(t){console.error('Unleash failed to resolve "fetch"',t)}}():x,T=e.bootstrap,k=e.bootstrapOverride,O=void 0===k||k,N=e.headerName,C=void 0===N?"Authorization":N,U=e.customHeaders,R=void 0===U?{}:U,P=e.impressionDataAll,D=void 0!==P&&P,j=e.usePOSTrequests,A=void 0!==j&&j,H=t.call(this)||this;if(H.toggles=[],H.etag="",H.readyEventEmitted=!1,H.usePOSTrequests=!1,H.started=!1,!r)throw new Error("url is required");if(!s)throw new Error("clientKey is required");if(!y)throw new Error("appName is required.");return H.eventsHandler=new E,H.impressionDataAll=D,H.toggles=T&&T.length>0?T:[],H.url=r instanceof URL?r:new URL(r),H.clientKey=s,H.headerName=C,H.customHeaders=R,H.storage=n||("undefined"!=typeof window?new p:new d),H.refreshInterval=a?0:1e3*u,H.context=o({appName:y,environment:b},w),H.usePOSTrequests=A,H.ready=new Promise((function(t){H.init().then(t).catch((function(e){console.error(e),H.emit(I,e),t()}))})),S||console.error('Unleash: You must either provide your own "fetch" implementation or run in an environment where "fetch" is available.'),H.fetch=S,H.bootstrap=T&&T.length>0?T:void 0,H.bootstrapOverride=O,H.metrics=new f({onError:H.emit.bind(H,I),onSent:H.emit.bind(H,"sent"),appName:y,metricsInterval:h,disableMetrics:g,url:H.url,clientKey:s,fetch:S,headerName:C,customHeaders:R}),H}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.getAllToggles=function(){return function(t,e,n){if(n||2===arguments.length)for(var r,o=0,s=e.length;o<s;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],this.toggles,!0)},e.prototype.isEnabled=function(t){var e,n=this.toggles.find((function(e){return e.name===t})),r=!!n&&n.enabled;if(this.metrics.count(t,r),(null==n?void 0:n.impressionData)||this.impressionDataAll){var o=this.eventsHandler.createImpressionEvent(this.context,r,t,"isEnabled",null!==(e=null==n?void 0:n.impressionData)&&void 0!==e?e:void 0);this.emit(T,o)}return r},e.prototype.getVariant=function(t){var e,n=this.toggles.find((function(e){return e.name===t})),r=(null==n?void 0:n.enabled)||!1,s=n?n.variant:k;if(s.name&&this.metrics.countVariant(t,s.name),this.metrics.count(t,r),(null==n?void 0:n.impressionData)||this.impressionDataAll){var i=this.eventsHandler.createImpressionEvent(this.context,r,t,"getVariant",null!==(e=null==n?void 0:n.impressionData)&&void 0!==e?e:void 0,s.name);this.emit(T,i)}return o(o({},s),{feature_enabled:r})},e.prototype.updateContext=function(t){return s(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(r){switch(r.label){case 0:return(t.appName||t.environment)&&console.warn("appName and environment are static. They can't be updated with updateContext."),e={environment:this.context.environment,appName:this.context.appName,sessionId:this.context.sessionId},this.context=o(o({},e),t),this.timerRef||this.readyEventEmitted?[4,this.fetchToggles()]:[3,2];case 1:return r.sent(),[3,4];case 2:return this.started?[4,new Promise((function(t){var e=function(){n.fetchToggles().then((function(){n.off(S,e),t()}))};n.once(S,e)}))]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.getContext=function(){return o({},this.context)},e.prototype.setContextField=function(t,e){var n,r;if(x.includes(t))this.context=o(o({},this.context),((n={})[t]=e,n));else{var s=o(o({},this.context.properties),((r={})[t]=e,r));this.context=o(o({},this.context),{properties:s})}this.timerRef&&this.fetchToggles()},e.prototype.init=function(){return s(this,void 0,void 0,(function(){var t,e;return i(this,(function(n){switch(n.label){case 0:return[4,this.resolveSessionId()];case 1:return t=n.sent(),this.context=o({sessionId:t},this.context),e=this,[4,this.storage.get(O)];case 2:return e.toggles=n.sent()||[],!this.bootstrap||!this.bootstrapOverride&&0!==this.toggles.length?[3,4]:[4,this.storage.save(O,this.bootstrap)];case 3:n.sent(),this.toggles=this.bootstrap,this.emit(S),n.label=4;case 4:return this.emit("initialized"),[2]}}))}))},e.prototype.start=function(){return s(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:return this.started=!0,this.timerRef?(console.error("Unleash SDK has already started, if you want to restart the SDK you should call client.stop() before starting again."),[2]):[4,this.ready];case 1:return n.sent(),this.metrics.start(),t=this.refreshInterval,[4,this.fetchToggles()];case 2:return n.sent(),t>0&&(this.timerRef=setInterval((function(){return e.fetchToggles()}),t)),[2]}}))}))},e.prototype.stop=function(){this.timerRef&&(clearInterval(this.timerRef),this.timerRef=void 0),this.metrics.stop()},e.prototype.resolveSessionId=function(){return s(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this.context.sessionId?[2,this.context.sessionId]:[3,1];case 1:return[4,this.storage.get("sessionId")];case 2:return(t=e.sent())?[3,4]:(t=Math.floor(1e9*Math.random()),[4,this.storage.save("sessionId",t)]);case 3:e.sent(),e.label=4;case 4:return[2,t]}}))}))},e.prototype.getHeaders=function(){var t,e=((t={})[this.headerName]=this.clientKey,t.Accept="application/json",t["Content-Type"]="application/json",t["If-None-Match"]=this.etag,t);return Object.entries(this.customHeaders).filter(l).forEach((function(t){var n=t[0],r=t[1];return e[n]=r})),e},e.prototype.storeToggles=function(t){return s(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.toggles=t,this.emit("update"),[4,this.storage.save(O,t)];case 1:return e.sent(),[2]}}))}))},e.prototype.fetchToggles=function(){return s(this,void 0,void 0,(function(){var t,e,n,r,o,s,a;return i(this,(function(i){switch(i.label){case 0:if(!this.fetch)return[3,8];i.label=1;case 1:return i.trys.push([1,7,,8]),t=this.usePOSTrequests,e=t?this.url:function(t,e){var n=new URL(t.toString());return Object.entries(e).filter(l).forEach((function(t){var e=t[0],r=t[1];"properties"===e&&r?Object.entries(r).filter(l).forEach((function(t){var e=t[0],r=t[1];return n.searchParams.append("properties[".concat(e,"]"),r)})):n.searchParams.append(e,r)})),n}(this.url,this.context),n=t?"POST":"GET",r=t?JSON.stringify({context:this.context}):void 0,[4,this.fetch(e.toString(),{method:n,cache:"no-cache",headers:this.getHeaders(),body:r})];case 2:return(o=i.sent()).ok&&304!==o.status?(this.etag=o.headers.get("ETag")||"",[4,o.json()]):[3,5];case 3:return s=i.sent(),[4,this.storeToggles(s.toggles)];case 4:return i.sent(),this.bootstrap||this.readyEventEmitted||(this.emit(S),this.readyEventEmitted=!0),[3,6];case 5:o.ok||304===o.status||(console.error("Unleash: Fetching feature toggles did not have an ok response"),this.emit(I,{type:"HttpError",code:o.status})),i.label=6;case 6:return[3,8];case 7:return a=i.sent(),console.error("Unleash: unable to fetch feature toggles",a),this.emit(I,a),[3,8];case 8:return[2]}}))}))},e}(u),C=n(28416);const U=C.createContext(null),R={bootstrap:[],disableRefresh:!0,disableMetrics:!0,url:"http://localhost",appName:"offline",clientKey:"not-used"},P=({config:t,children:e,unleashClient:n,startClient:r=!0})=>{const o=t||R,s=C.useRef(n||new N(o)),[i,a]=C.useState(!!(n?null!=t&&t.bootstrap&&!1!==(null==t?void 0:t.bootstrapOverride):o.bootstrap&&!1!==o.bootstrapOverride)),[c,u]=C.useState(null);C.useEffect((()=>{!o&&!n&&console.error("You must provide either a config or an unleash client to the flag provider.\n        If you are initializing the client in useEffect, you can avoid this warning\n        by checking if the client exists before rendering.");const t=t=>{C.startTransition((()=>{u((e=>e||t))}))};let e;const i=()=>{e=setTimeout((()=>{C.startTransition((()=>{a(!0)}))}),0)};return s.current.on("ready",i),s.current.on("error",t),(r||!n)&&(s.current.stop(),s.current.start()),function(){s.current&&(s.current.off("error",t),s.current.off("ready",i),s.current.stop()),e&&clearTimeout(e)}}),[]);const l=async t=>{await s.current.updateContext(t)},h=t=>s.current.isEnabled(t),f=t=>s.current.getVariant(t),d=(t,e,n)=>s.current.on(t,e,n),p=C.useMemo((()=>({on:d,updateContext:l,isEnabled:h,getVariant:f,client:s.current,flagsReady:i,flagsError:c,setFlagsReady:a,setFlagsError:u})),[i,c]);return C.createElement(U.Provider,{value:p},e)},D=t=>{const{isEnabled:e,client:n}=(0,C.useContext)(U),[r,o]=(0,C.useState)(!!e(t)),s=(0,C.useRef)();return s.current=r,(0,C.useEffect)((()=>{if(!n)return;const r=()=>{const n=e(t);n!==s.current&&(s.current=n,o(!!n))},i=()=>{const n=e(t);s.current=n,o(n)};return n.on("update",r),n.on("ready",i),()=>{n.off("update",r),n.off("ready",i)}}),[n]),r},j=()=>{const{client:t}=(0,C.useContext)(U),[e,n]=(0,C.useState)(t.getAllToggles());return(0,C.useEffect)((()=>{const e=()=>{n(t.getAllToggles())};return t.on("update",e),()=>{t.off("update",e)}}),[]),e},A=()=>{const{flagsReady:t,flagsError:e}=(0,C.useContext)(U);return{flagsReady:t,flagsError:e}},H=t=>{const{getVariant:e,client:n}=(0,C.useContext)(U),[r,o]=(0,C.useState)(e(t)),s=(0,C.useRef)({name:r.name,enabled:r.enabled});return s.current=r,(0,C.useEffect)((()=>{if(!n)return;const r=()=>{const n=e(t);((t,e)=>{var n,r,o,s;return!(t.name===(null==e?void 0:e.name)&&t.enabled===(null==e?void 0:e.enabled)&&(null==(n=t.payload)?void 0:n.type)===(null==(r=null==e?void 0:e.payload)?void 0:r.type)&&(null==(o=t.payload)?void 0:o.value)===(null==(s=null==e?void 0:e.payload)?void 0:s.value))})(s.current,n)&&(o(n),s.current=n)},i=()=>{const n=e(t);s.current.name=null==n?void 0:n.name,s.current.enabled=null==n?void 0:n.enabled,o(n)};return n.on("update",r),n.on("ready",i),()=>{n.off("update",r),n.off("ready",i)}}),[n]),r||{}},M=()=>{const{updateContext:t}=(0,C.useContext)(U);return t},_=()=>{const{client:t}=(0,C.useContext)(U);return t}}}]);
//# sourceMappingURL=../sourcemaps/2080.22c957a416b5c99d01f278c55315e1ce.js.map