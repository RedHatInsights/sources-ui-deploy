"use strict";(self.webpackChunksources=self.webpackChunksources||[]).push([[9061],{29061:(e,t,a)=>{a.r(t),a.d(t,{AddSourceButton:()=>ne,default:()=>oe});var s=a(66029),i=a.n(s),r=a(45697),n=a.n(r),o=a(41609),c=a.n(o),u=a(25387),l=a(46665),p=a(86706),d=a(67850),m=a(9820),y=a(73047),h=a(22955),g=a(18111),f=a(12567),T=a(31379),S=a(96354),v=a(98658),b=a(48880),E=a(64124);const w=e=>{const t=(0,u.YB)(),a=(0,b.default)(),{authentication:s}=a.getState().values,r=e.validate&&e.validate.filter((({type:e})=>e!==E.Z.REQUIRED)),n={...e,...s&&s.id?{isRequired:!1,helperText:t.formatMessage({id:"wizard.changeAuthHelper",defaultMessage:"Changing this resets your current {label}."},{label:e.label}),validate:r}:{}},o=v.ZP[S.Z.TEXT_FIELD];return i().createElement(o,{...n})};var C=a(35729),M=a(26946),_=a(79083);const R={schema:{},sourceTypes:[],isLoading:!0},B=e=>i().createElement(d.ZP,{...e,showFormControls:!1}),Z=({sourceTypes:e,applicationTypes:t,disableAppSelection:a,isCancelling:r,onCancel:n,values:o,onSubmit:c,selectedType:l,initialWizardState:d,activeCategory:S})=>{const v=(0,_.useFlag)("sources.wizard.lighthouse"),[{schema:b,sourceTypes:E,applicationTypes:Z,isLoading:z},q]=(0,s.useReducer)(((e,{type:t,sourceTypes:a,applicationTypes:s,container:i,disableAppSelection:r,intl:n,selectedType:o,initialWizardState:c,activeCategory:u,hcsEnrolled:l})=>{if("loaded"===t)return{...e,schema:(0,y.ZP)(a.filter(T.Z).filter((0,T.j)(u)),s.filter(f.Z).filter((0,f.W)(a,u)),r,i,n,o,c,u,v,l),isLoading:!1,sourceTypes:a,applicationTypes:s,hcsEnrolled:l}}),R),A=(0,p.v9)((({sources:e})=>e.hcsEnrolled),p.wU),k=(0,s.useRef)(!1),O=(0,s.useRef)(document.createElement("div")),x=(0,u.YB)();return(0,s.useEffect)((()=>{k.current=!0;const s=[];return e||s.push((0,h.lH)()),t||s.push((0,h.$l)()),Promise.all(s).then((s=>{const i=s.find((e=>Object.prototype.hasOwnProperty.call(e,"sourceTypes"))),r=s.find((e=>Object.prototype.hasOwnProperty.call(e,"applicationTypes")));k.current&&q({type:"loaded",sourceTypes:e||i.sourceTypes,applicationTypes:t||r.applicationTypes,hcsEnrolled:A,disableAppSelection:a,container:O.current,intl:x,selectedType:l,initialWizardState:d,activeCategory:S})})),()=>{k.current=!1}}),[]),(0,s.useEffect)((()=>{O.current.style.opacity=r?0:1}),[r]),z?i().createElement(m.e,{className:"sources",isOpen:!0,onClose:n,title:(0,g.Z5)(S),description:(0,g.A6)(S),steps:[{name:"Loading",component:i().createElement(M.Z,{onClose:()=>n()}),isFinishedStep:!0}]}):i().createElement(C.Z,{initialValues:{...o,...l&&{source_type:l}},schema:b,onSubmit:(e,t,a)=>c(e,E,a,Z,A),onCancel:n,FormTemplate:B,subscription:{values:!0},componentMapper:{authentication:w}})};Z.propTypes={onCancel:n().func.isRequired,onSubmit:n().func.isRequired,sourceTypes:n().arrayOf(n().shape({id:n().string.isRequired,name:n().string.isRequired,product_name:n().string.isRequired,schema:n().shape({authentication:n().array,endpoint:n().object})})),applicationTypes:n().arrayOf(n().shape({id:n().string.isRequired,name:n().string.isRequired,display_name:n().string.isRequired})),values:n().object,disableAppSelection:n().bool,isCancelling:n().bool,selectedType:n().string,initialWizardState:n().object,activeCategory:n().string},Z.defaultProps={values:{},disableAppSelection:!1};const z=Z;var q=a(36494),A=a(82793),k=a(90573),O=a(16872),x=a(55140),F=a(32952),j=a(96380);const N=({id:e})=>{const t=(0,u.YB)().formatMessage({id:"wizard.editSource",defaultMessage:"Edit integration"}),{getApp:a,isBeta:s}=(0,x.Z)();return"sources"===a()?i().createElement(j.Z,{to:`/detail/${e}`},i().createElement(l.Button,{variant:"primary",className:"pf-v5-u-mt-xl"},t)):i().createElement(l.Button,{variant:"primary",className:"pf-v5-u-mt-xl",component:"a",target:"_blank",href:`${(0,F.Z)(s())}/detail/${e}`,rel:"noopener noreferrer"},t)};N.propTypes={id:n().string.isRequired};const W=N;var P=a(29494),D=a(93759),I=a(27552),L=a(54243),V=a(85779),Y=a(75614);const H=({afterSubmit:e,afterError:t,isFinished:a,isErrored:r,successfulMessage:n,hideSourcesButton:o,returnButtonTitle:c,reset:p,createdSource:d={},tryAgain:y,afterSuccess:h,sourceTypes:f,activeCategory:T})=>{const[S,v]=(0,s.useState)(),[b,E]=(0,s.useState)(),w=d.applications?.some((e=>e?.extra?.storage_only)),C=d.applications?.some((e=>e?.application_type_id===Y.sC)),_=d.applications?.some((e=>e?.extra?.hcs)),R=(0,u.YB)(),B=()=>(v(!0),(0,k.Rj)().deleteSource(d.id).then((()=>{h&&h(),E(!0)})).catch((()=>v(!1)))),Z=i().createElement(l.Button,{variant:"link",onClick:p},R.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another integration"}));let z;if(b)z=i().createElement(D.Z,{onClose:e,title:R.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:R.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Integration was successfully removed."}),hideSourcesButton:o,returnButtonTitle:c,secondaryActions:Z});else if(S)z=i().createElement(M.Z,{customText:R.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing integration"})});else if(a)switch((0,O.Z)(d)){case"unavailable":z=i().createElement(I.Z,{onClose:e,secondaryActions:i().createElement(l.Button,{variant:"link",onClick:B},R.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove integration"})),Component:()=>i().createElement(W,{id:d.id}),message:(0,P.Z)(d,R),title:R.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})});break;case"timeout":z=i().createElement(L.Z,{onClose:e,returnButtonTitle:c,secondaryActions:Z,...C&&w&&{uuid:d?.uid}});break;default:z=d.source_type_id===f.find((({name:e})=>"amazon"===e))?.id?i().createElement(V.Z,{onClose:e}):i().createElement(D.Z,{onClose:e,successfulMessage:C&&w?`You have chosen to manually customize the cost data set sent to ${_?Y.X0:"Cost Management"}, you will still need to perform additional steps to complete the process.`:n,...C&&w&&{title:i().createElement(u._H,{id:"wizard.waitTheresMore",defaultMessage:"Success, but wait there's more!"}),uuid:d?.uid},hideSourcesButton:o,returnButtonTitle:c,secondaryActions:Z})}else z=r?i().createElement(I.Z,{onClose:t,primaryAction:y,secondaryActions:i().createElement(A.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},R.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:R.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):i().createElement(M.Z,{customText:R.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating credentials"}),description:i().createElement(A.TextContent,null,i().createElement(A.Text,{className:"pf-v5-u-mb-md"},R.formatMessage({id:"wizard.loadingDescription-a",defaultMessage:"This might take some time. You'll receive a notification if you are still in the Integrations application when the process completes. Otherwise, you can check the status in the main integrations table at any time."})),i().createElement(A.Text,null,R.formatMessage({id:"wizard.loadingDescription-b",defaultMessage:"In the meantime, you can close this window while the validation process continues."}))),onClose:t,cancelTitle:R.formatMessage({id:"wizard.close",defaultMessage:"Close"})});const x=i().useMemo((()=>document.querySelector(".pf-v5-c-page.chr-c-page")),[]);return i().createElement(q.Modal,{isOpen:!0,width:"58%",hasNoBodyWrapper:!0,appendTo:x,showClose:!1},i().createElement(m.e,{className:"sources",onClose:a?e:t,title:(0,g.Z5)(T),description:(0,g.A6)(T),steps:[{name:"Finish",component:z,isFinishedStep:!0}]}))};H.propTypes={afterSubmit:n().func.isRequired,afterError:n().func.isRequired,isFinished:n().bool.isRequired,isErrored:n().bool.isRequired,successfulMessage:n().node.isRequired,hideSourcesButton:n().bool,returnButtonTitle:n().node.isRequired,errorMessage:n().node,reset:n().func,createdSource:n().object,tryAgain:n().func,afterSuccess:n().func,sourceTypes:n().arrayOf(n().shape({id:n().string.isRequired,name:n().string.isRequired})),activeCategory:n().string};const $=H;var U=a(70642),X=a(5454),G=a(5495);const J=async e=>{try{const t=new Date,a=await(0,k.Rj)().bulkCreate({sources:[{...e.source,source_type_name:e.source_type}],authentications:[{...e.authentication,resource_name:e.source.name,resource_type:"source"}],applications:e.applications.map((t=>({application_type_id:t,source_name:e.source.name})))}),s=await(0,X.h)(a.authentications[0].id,void 0,void 0,"showAuthentication",t);return{...a,...a.sources[0],authentications:[s]}}catch(e){throw await(0,G.Z)(e)}};var Q=a(85490),K=a(33646);const ee=e=>e.url?(e=>{if(!e)return{};try{const t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}})(e.url):e,te=async(e,t=[],a)=>{let s;try{const i={sources:[{...e.source,source_type_name:e.source_type}],endpoints:[],authentications:[],applications:[]},r=e.url||e.endpoint;if(r){const{scheme:t,host:a,port:s,path:r}=ee(e),n=parseInt(s,10);i.endpoints.push({...e.endpoint,default:!0,source_name:e.source.name,scheme:t,host:a,port:isNaN(n)?void 0:n,path:r})}const n=e.application?.application_type_id&&e.application?.application_type_id!==g.Dt;n&&i.applications.push({...e.application,source_name:e.source.name}),e.authentication&&e.authentication.authtype!==K.Z.type&&i.authentications.push({...e.authentication,resource_type:r?"endpoint":n?"application":"source",resource_name:e.source.name,...n&&{resource_name:a?.find((({id:t})=>t===e.application.application_type_id))?.name},...r&&{resource_name:ee(e).host}});const o=await(0,k.Rj)().bulkCreate(i);s=o.sources?.[0];let c=o.applications?.[0],u=o.endpoints?.[0],l=o.authentications?.[0];if(r&&n&&await(0,k.Rj)().createAuthApp({application_id:c.id,authentication_id:l.id}),await(0,Q.Z)(s.id),c){const e=t.includes(c.application_type_id)?1e4:0;c=await(0,X.h)(c.id,e)}return u&&(u=await(0,X.h)(u.id,void 0,void 0,"getEndpoint")),{...s,endpoint:[u].filter(Boolean),applications:[c].filter(Boolean)}}catch(e){throw await(0,G.S)(e,s?s.id:void 0)}};var ae=a(95772);const se=(e,t)=>({isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0,activeCategory:t}),ie=(e,{type:t,values:a,data:s,error:i,initialValues:r,sourceTypes:n,applicationTypes:o})=>{switch(t){case"reset":return se(r,e.activeCategory);case"prepareSubmitState":return{...e,isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:a,sourceTypes:n,applicationTypes:o};case"setSubmitted":return{...e,isFinished:!0,createdSource:s};case"setErrored":return{...e,isErrored:!0,error:i.toString()};case"onStay":return{...e,isCancelling:!1};case"showCancelModal":return{...e,isCancelling:!0,values:a}}},re=({successfulMessage:e,isOpen:t,sourceTypes:a,applicationTypes:r,disableAppSelection:n,hideSourcesButton:o,returnButtonTitle:u,initialValues:l,onClose:p,afterSuccess:d,selectedType:m,initialWizardState:y,submitCallback:h,activeCategory:g})=>{const[{isErrored:f,isFinished:T,isSubmitted:S,values:v,error:b,isCancelling:E,createdSource:w,activeCategory:C,...M},_]=(0,s.useReducer)(ie,se(l,g)),R=(e,t,a,s,i)=>(_({type:"prepareSubmitState",values:e,sourceTypes:t,applicationTypes:s}),((0,U.Z)(e.source)?J:te)({...e,application:{...e.application,extra:{...e.application?.extra||{},hcs:!!i}}},(0,Y.T2)(s),s).then((e=>{d&&d(e),h&&h({isSubmitted:!0,createdSource:e,sourceTypes:t}),_({type:"setSubmitted",data:e})})).catch((s=>{h&&h({isErrored:!0,error:s,values:e,sourceTypes:t,wizardState:a}),_({type:"setErrored",error:s})}))),B=()=>_({type:"reset",initialValues:l});return t?S?i().createElement($,{afterSubmit:()=>{p(void 0,w),B()},afterError:()=>p({}),isFinished:T,isErrored:f,successfulMessage:e,hideSourcesButton:o,returnButtonTitle:u,errorMessage:b,reset:B,createdSource:w,tryAgain:()=>R(v,M.sourceTypes,void 0,M.applicationTypes),afterSuccess:d,sourceTypes:M.sourceTypes,activeCategory:C}):i().createElement(i().Fragment,null,E&&i().createElement(ae.Z,{onExit:()=>p(v),onStay:()=>_({type:"onStay"})}),i().createElement(z,{isCancelling:E,values:v,onSubmit:R,onCancel:e=>c()(e)?p({}):_({type:"showCancelModal",values:e}),sourceTypes:a,applicationTypes:r,disableAppSelection:n,selectedType:m,initialWizardState:y,activeCategory:C})):null};re.propTypes={afterSuccess:n().func,sourceTypes:n().arrayOf(n().shape({id:n().string.isRequired,name:n().string.isRequired,product_name:n().string.isRequired,schema:n().shape({authentication:n().array,endpoint:n().object})})),applicationTypes:n().arrayOf(n().shape({id:n().string.isRequired,name:n().string.isRequired,display_name:n().string.isRequired})),onClose:n().func.isRequired,isOpen:n().bool.isRequired,successfulMessage:n().node,initialValues:n().shape({[n().string]:n().oneOf([n().string,n().array,n().number,n().bool])}),disableAppSelection:n().bool,hideSourcesButton:n().bool,returnButtonTitle:n().node,selectedType:n().string,initialWizardState:n().object,submitCallback:n().func,activeCategory:n().oneOf([Y.B0,Y.JL])},re.defaultProps={successfulMessage:i().createElement(u._H,{id:"wizard.successfulMessage",defaultMessage:"Your integration was successfully added."}),initialValues:{},returnButtonTitle:i().createElement(u._H,{id:"wizard.goBackToSources",defaultMessage:"Go back to Integrations"})};const ne=e=>{const[t,a]=(0,s.useState)(!1);return i().createElement(i().Fragment,null,i().createElement(l.Button,{variant:"primary",onClick:()=>a(!0)},(0,g.Z5)()),i().createElement(re,{isOpen:t,onClose:()=>a(!1),...e}))},oe=re},31379:(e,t,a)=>{a.d(t,{Z:()=>n,j:()=>r});var s=a(75614);const i=[s.OH,s.N9],r=(e,t)=>({category:a,name:s})=>t?a===e:a===e&&!i.includes(s),n=e=>e.schema},70642:(e,t,a)=>{a.d(t,{Z:()=>i});var s=a(64072);const i=e=>e?.app_creation_workflow===s.b}}]);
//# sourceMappingURL=../sourcemaps/9061.9f3ba29e3df85b66ed186bacdc2fd5ab.js.map