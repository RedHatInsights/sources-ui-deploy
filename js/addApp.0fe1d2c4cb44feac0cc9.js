(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{395:function(e,t,a){"use strict";var n=a(0),i=Object(n.createContext)();t.a=i},417:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(105),i=a.n(n),o=a(0),r=a.n(o),s=a(9),c=a.n(s),u=a(363),l=a.n(u),p=a(478),d=a.n(p),m=a(50),f=a(365),h=a(395),g=a(360),y=a.n(g),v="edit-field",b=function(e){var t=e.isRequired,a=e.label,n=e.helperText,s=e.hideLabel,c=e.name,u=e.type,p=e.isEditable,g=y()(),v=g.getFieldState,b=g.getState,O=Object(o.useContext)(h.a).setState,_=v(c)||{value:l()(b().initialValues,c)},E=_.error,M=_.touched,T=_.value,j=M&&E,A="password"===u||c.includes("password")?"Click to edit":"Click to add";return r.a.createElement(f.FormGroup,i()({isRequired:t,label:!s&&a,fieldId:c,validated:j?"error":"default",helperText:n,helperTextInvalid:E,tabIndex:0,onKeyPress:function(e){32===e.charCode&&p&&(e.preventDefault(),O({type:"setEdit",name:c}))}},p&&{onClick:function(){return O({type:"setEdit",name:c})}}),r.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(p?"clickable":"")},r.a.createElement(m.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(p?"clickable":"")},r.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},T||(p?A:"")),p&&r.a.createElement(d.a,null))))};b.propTypes={label:c.a.node,isRequired:c.a.bool,helperText:c.a.node,hideLabel:c.a.bool,isEditable:c.a.bool,type:c.a.string,name:c.a.string},t.b=b},529:function(e,t,a){"use strict";var n=a(105),i=a.n(n),o=a(2),r=a.n(o),s=a(0),c=a.n(s),u=a(412),l=a.n(u),p=a(359),d=a.n(p),m=a(361),f=a.n(m),h=a(400),g=a.n(h),y=a(390),v=a.n(y),b=a(414),O=a.n(b),_=a(506),E=a(75),M=a.n(E),T=a(9),j=a.n(T),A=a(424),w=a.n(A),C=a(395),x=a(417),S=[d.a.CHECKBOX,d.a.SWITCH],k=function(e){var t=e.originalComponent,a=e.isEditable,n=void 0===a||a,o=M()(e,["originalComponent","isEditable"]),r=x.b,u={},l=Object(s.useContext)(w.a).componentMapper;return Object(s.useContext)(C.a).editing[o.name]||S.includes(t)?r=l[t]:n&&(u={isEditable:!0}),c.a.createElement(r,i()({},o,u))};k.propTypes={originalComponent:j.a.string,name:j.a.string,isEditable:j.a.bool};var R=k;function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){r()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a=function(e){return c.a.createElement(l.a,i()({FormTemplate:v.a,componentMapper:D(D(D({},O.a),_.mapperExtension),{},{"edit-field":R,"switch-field":O.a[d.a.SWITCH]}),validatorMapper:{"required-validator":g.a[f.a.REQUIRED],"pattern-validator":g.a[f.a.PATTERN],"min-length-validator":g.a[f.a.MIN_LENGTH],"url-validator":g.a[f.a.URL]}},e))}},806:function(e,t,a){"use strict";a.r(t),a.d(t,"onSubmit",(function(){return ct}));var n=a(26),i=a.n(n),o=a(44),r=a.n(o),s=a(105),c=a.n(s),u=a(89),l=a.n(u),p=a(116),d=a.n(p),m=a(0),f=a.n(m),h=a(11),g=a(72),y=a(34),v=a(202),b=a(569),O=a.n(b),_=a(570),E=a.n(_),M=a(571),T=a.n(M),j=a(572),A=a.n(j),w=a(573),C=a.n(w),x=a(574),S=a.n(x),k=a(390),R=a.n(k),P=a(102),D=a(529),V=a(359),N=a.n(V),I=a(361),B=a.n(I),F=a(28),q=a(50),L=a(575),z=a(363),G=a.n(z),U=a(360),W=a.n(U),Q=function(){var e=W()(),t=G()(e.getState().values,"application.application_type_id",""),a=Object(m.useState)(t),n=r()(a,2),i=n[0],o=n[1];return Object(m.useEffect)((function(){i!==t&&(e.batch((function(){e.change("authentication",void 0),e.change("selectedAuthentication",void 0)})),o(void 0))}),[t]),null},H=a(9),Y=a.n(H),K=a(461),J=a(99),X=a(419),Z=a(100),$=a(74),ee=a.n($),te=a(398),ae=function(e,t,a,n,i){var o=t.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:e.display_name}),r=t.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:e.display_name});return a&&a(),n(Object(P.i)(e.id,i.id,o,r))},ne=function(e){var t=e.app,a=e.onCancel,n=e.container,i=Object(v.a)(),o=Object(y.useSelector)((function(e){return e.sources.appTypes})),r=Object(te.a)(),s=Object(y.useDispatch)();Object(m.useEffect)((function(){n&&(n.hidden=!0)}),[]);var c=t.dependent_applications.map((function(e){var a=o.find((function(t){return t.name===e}));return a&&t.sourceAppsNames.includes(a.display_name)?a.display_name:void 0})).filter((function(e){return e}));return f.a.createElement(X.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:a,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:f.a.createElement(Z.Title,{headingLevel:"h1",size:"2xl"},f.a.createElement(ee.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[f.a.createElement(J.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){return ae(t,i,a,s,r)}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove application"})),f.a.createElement(J.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:a},i.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},f.a.createElement(q.TextContent,null,f.a.createElement(F.Text,{component:F.TextVariants.p},i.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?"},{appName:f.a.createElement("b",{key:"b"},t.display_name)})),c.length>0&&f.a.createElement(F.Text,{component:F.TextVariants.p},i.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:c}))))};ne.propTypes={app:Y.a.shape({id:Y.a.string.isRequired,display_name:Y.a.string.isRequired,dependent_applications:Y.a.arrayOf(Y.a.string),sourceAppsNames:Y.a.arrayOf(Y.a.string)}).isRequired,onCancel:Y.a.func.isRequired,container:Y.a.instanceOf(Element)};var ie=ne,oe=a(367),re=a(368),se=function(e){var t=e.setApplicationToRemove,a=e.breakpoints,n=e.namePrefix,i=Object(v.a)(),o=Object(y.useSelector)((function(e){return e.sources.appTypes})),r=Object(te.a)(),s=r.applications.map((function(e){var t=e.application_type_id,a=o.find((function(e){return e.id===t}));return a?a.display_name:void 0}));return r.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=o.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var o=e.display_name,r=e.id,c=e.dependent_applications;return f.a.createElement(q.TextContent,{key:r},f.a.createElement(oe.Grid,null,f.a.createElement(re.GridItem,{md:a.display_name||4},f.a.createElement(F.Text,{component:F.TextVariants.p,style:{marginBottom:0}},n,o)),f.a.createElement(re.GridItem,{md:a.remove||8,className:"ins-c-sources__remove-app"},f.a.createElement(J.Button,{variant:J.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:r,display_name:o,dependent_applications:c,sourceAppsNames:s})}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove"})))))}))};se.propTypes={setApplicationToRemove:Y.a.func.isRequired,breakpoints:Y.a.shape({display_name:Y.a.number,remove:Y.a.number}),namePrefix:Y.a.node},se.defaultProps={breakpoints:{}};var ce=se,ue=function(e){var t=e.container,a=Object(m.useState)({}),n=r()(a,2),i=n[0],o=n[1],s=Object(v.a)(),c=Object(y.useSelector)((function(e){return e.sources.sourceTypes})),u=Object(te.a)(),l=c.find((function(e){return e.id===u.source_type_id})),p=u.applications.filter((function(e){return!e.isDeleting}));return f.a.createElement(f.a.Fragment,null,i.id&&f.a.createElement(ie,{app:i,onCancel:function(){return t&&(t.hidden=!1),o({})},container:t}),f.a.createElement(q.TextContent,null,f.a.createElement(K.Grid,{hasGutter:!0},f.a.createElement(K.GridItem,{md:2},f.a.createElement(F.Text,{component:F.TextVariants.h4},s.formatMessage({id:"sources.sourceName",defaultMessage:"Source name"}))),f.a.createElement(K.GridItem,{md:2},f.a.createElement(F.Text,{component:F.TextVariants.h4},s.formatMessage({id:"sources.type",defaultMessage:"Type"}))),f.a.createElement(K.GridItem,{md:8},f.a.createElement(F.Text,{component:F.TextVariants.h4},s.formatMessage({id:"sources.apps",defaultMessage:"Applications"}))),f.a.createElement(K.GridItem,{md:2},f.a.createElement(F.Text,{component:F.TextVariants.p},u.name)),f.a.createElement(K.GridItem,{md:2},f.a.createElement(F.Text,{component:F.TextVariants.p},l?l.product_name:s.formatMessage({id:"sources.typeNotFound",defaultMessage:"Type not found"}))),f.a.createElement(K.GridItem,{md:8},p.length>0?f.a.createElement(ce,{setApplicationToRemove:o}):s.formatMessage({id:"sources.noApps",defaultMessage:"No applications"})))))};ue.propTypes={container:Y.a.instanceOf(Element)};var le=ue,pe=function(e,t,a,n){return{name:"selectAuthType-".concat(t.id),title:a.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:N.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var a;return{value:t,label:(null===(a=e.schema.authentication.find((function(e){return e.type===t})))||void 0===a?void 0:a.name)||"Unknown type"}})),isRequired:!0,validate:[{type:B.a.REQUIRED}]}],nextStep:function(t){var a=t.values,i=a.application,o=a.authtype;if(o)return n.find((function(e){return e.authtype===o}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(o)}}},de=a(2),me=a.n(de);function fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function he(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(a),!0).forEach((function(t){me()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ge=function(e,t,a,n,o){var r,s=i()(a),c=e.schema.authentication.find((function(e){return e.type===n})),u="".concat(e.name,"-").concat(n,"-").concat(t.name,"-additional-step"),l=L.shouldSkipEndpoint(e.name,n,t.name),p=L.hasCustomSteps(e.name,n,t.name);r=L.getAdditionalSteps(e.name,n,t.name).length>0?u:0!==a.length||l?"summary":"".concat(e.name,"-endpoint");var d=L.getAdditionalStepKeys(e.name,n,t.name),m={};if(L.shouldSkipSelection(e.name,n,t.name)){var f=L.getAdditionalSteps(e.name,n,t.name).find((function(e){return!e.name})),h=L.getAdditionalStepFields(c.fields,u);r=f.nextStep?f.nextStep:0!==a.length||l||p?"summary":"".concat(e.name,"-endpoint"),m=he(he({},f),{},{fields:[].concat(i()(s),i()(L.injectAuthFieldsInfo([].concat(i()(f.fields),i()(h)),e.name,n,t.name)))})}return he({name:"".concat(e.name,"-").concat(t.id,"-").concat(n),title:o.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(i()(s),i()(L.getAdditionalAuthFields(e.name,n,t.name)),i()(L.injectAuthFieldsInfo(L.getNoStepsFields(c.fields,d),e.name,n,t.name))),nextStep:r},m)},ye=function(e){var t=e.authenticationValues,a=W()(),n=a.getState().values.selectedAuthentication,i=Object(m.useState)(n),o=r()(i,2),s=o[0],c=o[1];return Object(m.useEffect)((function(){s!==n&&(!function(e){var t=e.formOptions,a=e.authenticationValues,n=e.selectedAuthentication;if(n.startsWith("new-")){var i=n.replace("new-","");t.change("authentication",{authtype:i})}else{var o=a.find((function(e){return e.id===n}));t.change("authentication",o)}}({formOptions:a,authenticationValues:t,selectedAuthentication:n}),c(void 0))}),[n]),null};ye.propTypes={authenticationValues:Y.a.arrayOf(Y.a.object)};var ve=function(e){var t=e.applicationTypeName,a=e.authenticationTypeName,n=Object(v.a)();return f.a.createElement(q.TextContent,null,f.a.createElement(F.Text,{component:F.TextVariants.p},n.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:a})))};ve.propTypes={applicationTypeName:Y.a.string,authenticationTypeName:Y.a.string};var be=function(e){var t=e.source,a=e.authenticationValues,n=e.applicationTypes,i=e.supportedAuthTypeName,o=e.supportedAuthType;return a.filter((function(e){return e.authtype===o})).map((function(e){var a=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),o=a&&a.application_type_id?n.find((function(e){return e.id===a.application_type_id})):"",r=e.username?"-".concat(e.username):"",s=o?"-".concat(o.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(r).concat(s),value:e.id}}))},Oe=function(e){var t=e.intl,a=e.source,n=e.authenticationValues,o=e.sourceType,r=e.applicationTypes,s=[{component:"description",name:"authtypesetter",Content:ye,authenticationValues:n,hideField:!0}];return r.forEach((function(e){var c,u=e.supported_source_types.includes(o.name),l=!(null===(c=a.applications)||void 0===c?void 0:c.find((function(t){return t.application_type_id===e.id})));if(u&&l){var p=G()(e,"supported_authentication_types[".concat(o.name,"]"),[]);p.forEach((function(c){if(n.find((function(e){return e.authtype===c}))){var u=G()(o,"schema.authentication",{}).find((function(e){return e.type===c})).name;s.push({component:N.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(i()(p.length>1?[{when:"authtype",is:c}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:ve,applicationTypeName:e.display_name,authenticationTypeName:u},{component:N.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:B.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new-".concat(c)}].concat(i()(be({authenticationValues:n,source:a,applicationTypes:r,supportedAuthTypeName:u,supportedAuthType:c})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:s,nextStep:function(e){var t=e.values,a=t.application,n=t.authtype,i=t.authentication,r=a||{},s=r.application_type_id?r.application_type_id:"";return"".concat(o.name,"-").concat(s,"-").concat(n||(null==i?void 0:i.authtype))}}},_e=function(){var e=Object(v.a)();return f.a.createElement(q.TextContent,null,f.a.createElement(F.Text,{component:F.TextVariants.p},e.formatMessage({id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source."})))},Ee=function(){var e=Object(v.a)();return f.a.createElement(q.TextContent,null,f.a.createElement(F.Text,{component:F.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===G()(t,"supported_authentication_types.".concat(a,"[0]"))}))},Te=function(e,t){var a;return e.supported_source_types.includes(t.name)&&(null===(a=e.supported_authentication_types[t.name])||void 0===a?void 0:a.length)>1},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=e.length>0,u=c?"summary":void 0,l=[],p=a.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&c){var d=p.schema.endpoint.hidden?p.schema.endpoint.fields:[],m=0===d.length;n.forEach((function(e){e.supported_source_types.includes(p.name)&&e.supported_authentication_types[p.name].forEach((function(a){l.push(ge(p,e,d,a,t))}))})),p.schema.authentication.forEach((function(e){n.forEach((function(t){if(t.supported_source_types.includes(p.name)){var a=L.getAdditionalSteps(p.name,e.type,t.name);a.length>0&&l.push.apply(l,i()(L.createAdditionalSteps(a,p.name,e.type,m,e.fields,t.name)))}}))})),m&&l.push(L.createEndpointStep(p.schema.endpoint,p.name)),u=function(e){var t=e.values.application;if(t){var a,i=n.find((function(e){return e.id===t.application_type_id}));if((null==i||null===(a=i.supported_authentication_types[p.name])||void 0===a?void 0:a.length)>1)return"selectAuthType-".concat(t.application_type_id);if(Me(o,n.find((function(e){return e.id===t.application_type_id})),p.name))return"selectAuthentication";var r=null==i?void 0:i.supported_authentication_types[p.name][0];return"".concat(p.name,"-").concat(t&&t.application_type_id,"-").concat(r)}}}var f=c?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:B.a.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:B.a.REQUIRED}],Content:_e},h=n.filter((function(e){return Te(e,p)})).map((function(e){return pe(p,e,t,o)}));return!r.imported&&c&&h.push(Oe({intl:t,source:r,authenticationValues:o,sourceType:p,applicationTypes:n})),{fields:[{component:N.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:s,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:c?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:u,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:le,container:s},f,{component:"description",name:"authtypesetter",Content:Q,hideField:!0}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:Ee},{component:"summary",name:"summary",sourceTypes:a,applicationTypes:n}]}].concat(i()(h),l)}]}},Ae=a(576),we=function(e){var t=e.step,a=e.goToSources,n=Object(v.a)();return f.a.createElement(Ae.Wizard,{isOpen:!0,onClose:a,title:n.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:n.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};we.propTypes={step:H.PropTypes.node.isRequired,goToSources:H.PropTypes.func.isRequired};var Ce=we,xe=a(16),Se=a(421),ke=a(111),Re=a(103),Pe=a(75),De=a.n(Pe),Ve=a(203),Ne=a.n(Ve),Ie=a(740),Be=a(469),Fe=a(418),qe=a(519),Le=a(366),ze=a(580),Ge=a.n(ze),Ue=a(751),We=a.n(Ue),Qe=a(778),He=a.n(Qe),Ye=a(155);function Ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Je(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(a),!0).forEach((function(t){me()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ke(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Xe=function e(t){return Object.keys(t).forEach((function(a){t[a]&&"object"===Ne()(t[a])?Ge()(t[a])?delete t[a]:e(t[a]):void 0===t[a]&&delete t[a]})),t},Ze=function(){var e=d()(l.a.mark((function e(t,a,n,i){var o,s,c,u,p,d,m,f,h,g,y,v,b,O,_,E,M,T,j,A,w,C,x,S,k,R,P,D,V,N,I,B,F,q,L,z,G,U,W,Q=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Q.length>4&&void 0!==Q[4]?Q[4]:[],c=a.getState(),u=c.values,p=u.authentication?u.authentication.id:void 0,d=p?n.find((function(e){return e.id===p})):void 0,m=t.authentication,f=De()(t,["authentication"]),h=Object(Ie.addedDiff)(i,f),g=Object(Ie.updatedDiff)(i,f),y=Object(Ie.addedDiff)(d,m),v=Object(Ie.updatedDiff)(d,m),b=Xe(Je(Je({},We()(He()(h),g)),{},{authentication:Je({},We()(He()(y),v))})),e.prev=11,u.source&&u.source.id){e.next=14;break}throw"Missing source id";case 14:if(O=u.source.id,_=u.endpoint?u.endpoint.id:void 0,E=[],b.source&&!Ge()(b.source)?E.push(Object(xe.j)().updateSource(O,b.source)):E.push(Promise.resolve(void 0)),M=b.endpoint&&!Ge()(b.endpoint),T=b.url&&!Ge()(b.url),!M&&!T){e.next=36;break}if(j=Object(Ye.b)(b),A=j.scheme,w=j.host,C=j.port,x=j.path,S=parseInt(C,10),k=Xe(Je(Je({},b.endpoint),{},{scheme:A,host:w,port:isNaN(S)?void 0:S,path:x})),!_){e.next=28;break}E.push(Object(xe.j)().updateEndpoint(_,k)),e.next=34;break;case 28:return E.push(Promise.resolve(void 0)),R=Je(Je({},k),{},{default:!0,source_id:O}),e.next=32,Object(xe.j)().createEndpoint(R);case 32:P=e.sent,_=P.id;case 34:e.next=37;break;case 36:E.push(Promise.resolve(void 0));case 37:return b.authentication&&!Ge()(b.authentication)?p?E.push(Object(xe.j)().updateAuthentication(p,b.authentication)):_&&(D=Je(Je({},b.authentication),{},{resource_id:_,resource_type:"Endpoint"}),E.push(Object(xe.j)().createAuthentication(D))):E.push(Promise.resolve(void 0)),b.application&&b.application.application_type_id?E.push(Object(xe.b)(O,b.application.application_type_id)):E.push(Promise.resolve(void 0)),e.next=41,Promise.all(E);case 41:return V=e.sent,N=r()(V,4),N[0],N[1],I=N[2],B=N[3],s=null==B?void 0:B.id,F=p||(I?I.id:void 0),q=[],B&&B.id&&F&&(L={application_id:B.id,authentication_id:F},q.push(Object(xe.j)().createAuthApp(L))),(b.credentials||b.billing_source)&&(z=b.credentials,G=b.billing_source,U={},U=z?{authentication:{credentials:z}}:{},U=G?Je(Je({},U),{},{billing_source:G}):U,q.push(Object(Be.patchSource)(Je({id:O},U)))),e.next=55,Promise.all(q);case 55:if(!B){e.next=60;break}return W=Object(Le.timeoutedApps)(o).includes(B.application_type_id)?1e4:0,e.next=59,Object(qe.checkAppAvailability)(B.id,W);case 59:return e.abrupt("return",e.sent);case 60:return e.abrupt("return",{});case 63:if(e.prev=63,e.t0=e.catch(11),console.error(e.t0),!s){e.next=69;break}return e.next=69,Object(xe.j)().deleteApplication(s);case 69:return e.next=71,Object(Fe.handleError)(e.t0);case 71:throw e.sent;case 73:case"end":return e.stop()}}),e,null,[[11,63]])})));return function(t,a,n,i){return e.apply(this,arguments)}}(),$e=a(488);function et(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function tt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?et(Object(a),!0).forEach((function(t){me()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):et(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var at={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},nt=function(e,t){var a=t.type,n=t.length,i=t.authenticationsValues,o=t.initialValues,r=t.error,s=t.values,c=t.data,u=t.formApi;switch(a){case"setSourceAppslength":return tt(tt({},e),{},{sourceAppsLength:n});case"loadAuthentications":return tt(tt({},e),{},{authenticationsValues:i,initialValues:o,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return tt(tt({},e),{},{initialValues:o,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return tt(tt({},e),{},{state:"wizard"});case"submit":return tt(tt({},e),{},{values:s,formApi:u,state:"submitting"});case"finish":return tt(tt({},e),{},{state:"finished",data:c});case"error":return tt(tt({},e),{},{state:"errored",error:r});case"toggleCancelling":return tt(tt({},e),{},{isCancelling:!e.isCancelling},s&&{values:s});default:return e}},it=a(70),ot=a(797),rt=void 0,st=function(e){var t=e.values.application;return rt=t},ct=function(e,t,a,n,i,o,r){return i({type:"submit",values:e,formApi:t}),Ze(e,t,a,o,r).then(function(){var e=d()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object($e.a)(o.source.id),e.next=3,n(Object(P.f)());case 3:return rt=void 0,e.abrupt("return",i({type:"finish",data:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i({type:"error",error:e})}))},ut=function(e){return f.a.createElement(R.a,c()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(v.a)(),t=Object(h.k)(),a=Object(Se.a)(),n=Object(y.useSelector)((function(e){return e.sources}),y.shallowEqual),o=n.appTypes,s=n.sourceTypesLoaded,c=n.appTypesLoaded,u=n.sourceTypes,l=Object(te.a)(),p=Object(y.useDispatch)(),d=Object(m.useReducer)(nt,at),b=r()(d,2),_=b[0],M=b[1],j=Object(m.useRef)(document.createElement("div"));Object(m.useEffect)((function(){rt=void 0}),[]),Object(m.useEffect)((function(){if(l){var e=_.sourceAppsLength>=l.applications.length&&_.sourceAppsLength>0;M({type:"setSourceAppslength",length:l.applications.length}),e||(l.endpoints&&l.endpoints[0]?Object(xe.j)().listEndpointAuthentications(l.endpoints[0].id).then((function(e){var t=e.data;return M({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:l,endpoint:l.endpoints[0],url:Object(ke.b)(l.endpoints[0]),application:rt},values:{}})})):M({type:"loadWithoutAuthentications",initialValues:{source:l,application:rt},values:{}}))}}),[l]);var w=function(){return t.push(Re.c.sources.path)};if(!(c&&s&&a&&"loading"!==_.state||"submitting"===_.state))return f.a.createElement(Ce,{goToSources:w,step:f.a.createElement(T.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w})});var x=function(e,t){return ct(e,t,_.authenticationsValues,p,M,_.initialValues,o)};if("submitting"===_.state)return f.a.createElement(Ce,{goToSources:w,step:f.a.createElement(T.a,{cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w,customText:e.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var k=function(){return M({type:"reset"})};if("wizard"!==_.state){var R;if("finished"!==_.state)R=f.a.createElement(A.a,{onRetry:k,onClose:w,returnButtonTitle:e.formatMessage({id:"sources.retry",defaultMessage:"Retry"}),primaryAction:function(){return x(_.values,_.formApi)},secondaryActions:f.a.createElement(ot.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},e.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"}))});else switch(_.data.availability_status){case"available":R=f.a.createElement(C.a,{title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),hideSourcesButton:!0,onReset:k,onClose:w,secondaryActions:f.a.createElement(it.Button,{variant:"link",onClick:k},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:e.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application was successfully added."})});break;case"unavailable":R=f.a.createElement(A.a,{onRetry:k,onClose:w,message:_.data.availability_status_error||e.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),secondaryActions:f.a.createElement(it.Button,{variant:"link",onClick:function(){var t,a;return M({type:"reset"}),ae({id:null===(t=_.data)||void 0===t?void 0:t.id,display_name:null===(a=o.find((function(e){var t;return e.id===(null===(t=_.data)||void 0===t?void 0:t.application_type_id)})))||void 0===a?void 0:a.display_name},e,void 0,p,l)}},e.formatMessage({id:"wizard.removeApp",defaultMessage:"Remove application"})),Component:function(){return f.a.createElement(g.Link,{to:Object(Re.b)(Re.c.sourcesEdit.path,l.id)},f.a.createElement(it.Button,{variant:"primary",className:"pf-u-mt-xl"},e.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))}});break;default:R=f.a.createElement(S.a,{returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),onClose:w,secondaryActions:f.a.createElement(it.Button,{variant:"link",onClick:k},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"}))})}return f.a.createElement(Ce,{goToSources:w,step:R})}var P=l.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),V=u.find((function(e){return e.id===l.source_type_id})),N=V&&V.name,I=o.filter((function(e){return!P.includes(e.id)&&e.supported_source_types.includes(N)})).filter(O.a),B=I.map((function(t){var a=l.applications.find((function(e){return e.application_type_id===t.id})),n="".concat(t.display_name," ").concat(a?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:n,isDisabled:!!a}})),F=je(B,e,u,o,_.authenticationsValues,l,j.current),q=I.length>0?x:w;return f.a.createElement(f.a.Fragment,null,f.a.createElement(E.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:_.isCancelling,onStay:function(){j.current.hidden=!1,M({type:"toggleCancelling"})},onExit:w}),f.a.createElement(D.a,{schema:F,showFormControls:!1,onSubmit:q,onCancel:function(e){(null==e?void 0:e.application)?(j.current.hidden=!0,M({type:"toggleCancelling",values:e})):w()},initialValues:_.initialValues,subscription:{values:!0},debug:st,clearedValue:null,FormTemplate:ut}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map