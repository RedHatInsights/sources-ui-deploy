(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{539:function(e,t,n){"use strict";var a=n(135);t.a=function(e,t,n,i,r){var o=t.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:e.display_name}),c=t.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:e.display_name});return n&&n(),i(Object(a.i)(e.id,r.id,o,c))}},592:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(39),i=function(e){return Object(a.k)().checkAvailabilitySource(e).catch((function(){}))}},608:function(e,t,n){"use strict";var a=n(138),i=n.n(a),r=n(3),o=n.n(r),c=n(0),s=n.n(c),u=n(480),l=n.n(u),p=n(464),d=n.n(p),f=n(485),m=n.n(f),h=n(588),g=n(60),v=n.n(g),y=n(423),b=n.n(y),O=n(422),j=n(448),_=n(583),A=n.n(_),M=n(417),E=n.n(M),T=n(418),w=n.n(T),S=n(488),k=n.n(S);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=function(e){var t,n,a=E()(),r=a.getState().values,o=(null==e||null===(t=e.name)||void 0===t?void 0:t.match(/\d+/))||[],u=v()(o,1)[0]||(null===(n=r.authentication)||void 0===n?void 0:n.id),l=b()(r,e.name),p=Object(c.useState)(!u||l),d=v()(p,2),f=d[0],m=d[1],h=Object(c.useRef)(!0),g=Object(c.useRef)(!1);Object(c.useEffect)((function(){g.current&&(!h.current&&a.getState().pristine&&(m(!1),h.current=!0),f&&(h.current=!1))})),Object(c.useEffect)((function(){g.current=!0}),[]);var y=e.validate&&e.validate.filter((function(e){return e.type!==w.a.REQUIRED})),_=P(P({},e),u?{validate:y,resolveProps:k.a}:{});return!f&&u?s.a.createElement(O.FormGroup,{helperText:_.helperText,label:_.label,onFocus:function(){return m(!0)},isRequired:!0},s.a.createElement(j.TextInput,{"aria-label":"pre-filled-authentication",value:"•••••••••••••"})):s.a.createElement(A.a,i()({},_,{autoFocus:!0}))},D=n(50),R=n.n(D),V=n(12),N=n.n(V),F=n(43),q=n(258),B=n(450),z=n(134),I=n(540),L=n.n(I),U=n(421),W=n.n(U),Q=n(447),J=n(217),Y=n(218),G=n(133),K=n(470),Z=n(219),$=n(221),H=n.n($),X=n(539),ee=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(q.a)(),r=Object(F.useSelector)((function(e){return e.sources.appTypes})),o=Object(Q.a)(),u=Object(F.useDispatch)();Object(c.useEffect)((function(){a&&(a.hidden=!0)}),[]);var l=t.dependent_applications.map((function(e){var n=r.find((function(t){return t.name===e}));return t.sourceAppsNames.includes(null==n?void 0:n.display_name)&&(null==n?void 0:n.display_name)})).filter((function(e){return e}));return s.a.createElement(K.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:s.a.createElement(Z.Title,{headingLevel:"h1",size:"2xl"},s.a.createElement(H.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[s.a.createElement(G.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){return Object(X.a)(t,i,n,u,o)}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove"})),s.a.createElement(G.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},i.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},s.a.createElement(Y.TextContent,null,s.a.createElement(J.Text,{component:J.TextVariants.p},i.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"{ appName } will be disconnected from this source."},{appName:s.a.createElement("b",{key:"b"},t.display_name)})),l.length>0&&s.a.createElement(J.Text,{component:J.TextVariants.p},i.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:l}))))};ee.propTypes={app:N.a.shape({id:N.a.string.isRequired,display_name:N.a.string.isRequired,dependent_applications:N.a.arrayOf(N.a.string),sourceAppsNames:N.a.arrayOf(N.a.string)}).isRequired,onCancel:N.a.func.isRequired,container:N.a.instanceOf(Element)};var te=ee,ne=function(e){var t=e.option,n=e.setApplicationToRemove,a=e.sourceAppsNames,i=e.app,r=e.appType,o=Object(q.a)();return s.a.createElement("div",{className:"pf-c-radio pf-u-mb-md"},s.a.createElement(z.Button,{id:"remove-app-".concat(t.value),variant:"plain","aria-label":o.formatMessage({id:"source.removeAppAria",defaultMessage:"Remove application {app} from this source"},{app:t.label}),className:"pf-u-p-0",onClick:function(){return n({id:null==i?void 0:i.id,display_name:null==r?void 0:r.display_name,dependent_applications:null==r?void 0:r.dependent_applications,sourceAppsNames:a})}},s.a.createElement(L.a,{variant:"small"})),s.a.createElement("label",{className:"pf-c-radio__label",htmlFor:"remove-app-".concat(t.value)},t.label))};ne.propTypes={option:N.a.shape({label:N.a.string.isRequired,value:N.a.string.isRequired}),setApplicationToRemove:N.a.func.isRequired,sourceAppsNames:N.a.arrayOf(N.a.string),appType:N.a.shape({display_name:N.a.string.isRequired,dependent_applications:N.a.arrayOf(N.a.string)}),app:N.a.shape({id:N.a.string.isRequired,application_type_id:N.a.string.isRequired})};var ae=function(e){var t=W()(e),n=t.options,a=t.input,i=a.onChange,r=a.value,o=a.name,u=t.container,l=Object(c.useState)({}),p=v()(l,2),d=p[0],f=p[1],m=Object(F.useSelector)((function(e){return e.sources.appTypes})),h=Object(Q.a)(),g=h.applications.map((function(e){var t,n=e.application_type_id;return null===(t=m.find((function(e){return e.id===n})))||void 0===t?void 0:t.display_name})),y=function(e){return null==m?void 0:m.find((function(t){return t.id===e}))},b=function(e){return h.applications.find((function(t){return t.application_type_id===e}))},O=function(e){var t;return null===(t=b(e))||void 0===t?void 0:t.isDeleting},j=h.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(R()(e),[t.application_type_id])}),[]);return s.a.createElement("div",null,d.id&&s.a.createElement(te,{app:d,onCancel:function(){return u&&(u.hidden=!1),f({})},container:u}),n.map((function(e){return j.includes(e.value)?s.a.createElement(ne,{key:e.value,option:e,setApplicationToRemove:f,sourceAppsNames:g,app:b(e.value),appType:y(e.value)}):s.a.createElement(B.Radio,{className:"pf-u-mb-md",key:e.value,onChange:function(){return i(e.value)},label:e.label,id:"".concat(o,"-").concat(e.value),name:o,isChecked:r===e.value,isDisabled:O(e.value)})})))};function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return s.a.createElement(l.a,i()({FormTemplate:d.a,componentMapper:re(re(re({},m.a),h.mapperExtension),{},{authentication:C,"application-select":ae})},e))}},610:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return p}));var a=n(3),i=n.n(a),r=n(471),o=n(39),c=n(15);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=function(e){return e.url||null===e.url?function(e){if(null===e)return{scheme:null,host:null,port:null,path:null};if(!e)return{};try{var t=new URL(e),n=t.protocol.replace(/:$/,"");return{scheme:n,host:t.hostname,port:""===t.port?Object(r.b)(n):t.port,path:t.pathname}}catch(e){return{}}}(e.url):e.endpoint?e.endpoint:e},p=function(e,t){var n,a,i=[];if(t.source&&i.push(Object(o.k)().updateSource(e.source.id,t.source)),t.endpoint||t.url||null===t.url){var r=l(t),s=r.scheme,p=r.host,d=r.port,f=r.path,m=null===d?null:parseInt(d,10),h=u({scheme:s,host:p,path:f,port:null===m?null:isNaN(m)?void 0:m},t.endpoint);i.push(Object(o.k)().updateEndpoint(e.endpoints[0].id,h))}if(t.authentications&&Object.keys(t.authentications).forEach((function(e){var n=e.replace("a","");i.push(Object(o.k)().updateAuthentication(n,t.authentications[e]))})),t.billing_source||t.credentials){var g={};t.credentials&&(g={authentication:{credentials:t.credentials}}),t.billing_source&&(g=u(u({},g),{},{billing_source:t.billing_source})),i.push((n=e.source.id,a=g,o.a.patch("".concat(c.a,"/sources/").concat(n,"/"),a)))}return Promise.all(i)}},955:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return Ge}));var a=n(60),i=n.n(a),r=n(138),o=n.n(r),c=n(109),s=n.n(c),u=n(140),l=n.n(u),p=n(0),d=n.n(p),f=n(13),m=n(103),h=n(43),g=n(258),v=n(596),y=n.n(v),b=n(597),O=n.n(b),j=n(594),_=n.n(j),A=n(595),M=n.n(A),E=n(922),T=n.n(E),w=n(599),S=n.n(w),k=n(600),x=n.n(k),P=n(464),C=n.n(P),D=n(135),R=n(608),V=n(50),N=n.n(V),F=n(419),q=n.n(F),B=n(418),z=n.n(B),I=n(217),L=n(218),U=n(696),W=n(423),Q=n.n(W),J=n(417),Y=n.n(J),G=function(){var e=Y()(),t=Q()(e.getState().values,"application.application_type_id",""),n=Object(p.useState)(t),a=i()(n,2),r=a[0],o=a[1];return Object(p.useEffect)((function(){r!==t&&(e.batch((function(){e.change("authentication",void 0),e.change("selectedAuthentication",void 0)})),o(void 0))}),[t]),null},K=n(447),Z=function(){var e=Object(g.a)(),t=Object(h.useSelector)((function(e){return e.sources.sourceTypes})),n=Object(K.a)(),a=t.find((function(e){return e.id===n.source_type_id})),i=n.applications.filter((function(e){return!e.isDeleting})),r=n.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(N()(e),[t.application_type_id])}),[]),o=i.filter((function(e){var t=e.id;return!r.includes(t)})).length>0?d.a.createElement(d.a.Fragment,null,d.a.createElement(I.Text,{component:I.TextVariants.h4,id:"add-application-header"},e.formatMessage({id:"sources.apps",defaultMessage:"Applications"})),d.a.createElement(I.Text,{component:I.TextVariants.p,id:"add-application-description"},e.formatMessage({id:"sources.addAppMultipleAppDesc",defaultMessage:"Select a radio button to add an application. Click trash icon to remove an application."}))):d.a.createElement(d.a.Fragment,null,d.a.createElement(I.Text,{component:I.TextVariants.h4,id:"add-application-header"},e.formatMessage({id:"sources.addApp",defaultMessage:"Add an application"})),d.a.createElement(I.Text,{component:I.TextVariants.p,id:"add-application-description"},e.formatMessage({id:"sources.addAppNoAppsDesc",defaultMessage:"There are currently no applications connected to this source. Select from available applications below."})));return d.a.createElement(L.TextContent,null,d.a.createElement(I.Text,{component:I.TextVariants.h4},e.formatMessage({id:"sources.type",defaultMessage:"Source type"})),d.a.createElement(I.Text,{component:I.TextVariants.p,id:"add-application-desc-type"},a?a.product_name:e.formatMessage({id:"sources.typeNotFound",defaultMessage:"Type not found"})),o)},$=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:q.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:z.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,r=n.authtype;if(r)return a.find((function(e){return e.authtype===r}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(r)}}},H=n(3),X=n.n(H);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){X()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=function(e,t,n,a,i){var r=N()(n);U.shouldUseAppAuth(e.name,a,t.name)&&(r=[]);var o,c=e.schema.authentication.find((function(e){return e.type===a})),s="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),u=U.shouldSkipEndpoint(e.name,a,t.name),l=U.hasCustomSteps(e.name,a,t.name);o=U.getAdditionalSteps(e.name,a,t.name).length>0?s:0!==n.length||u?"summary":"".concat(e.name,"-endpoint");var p=U.getAdditionalStepKeys(e.name,a,t.name),d={};if(U.shouldSkipSelection(e.name,a,t.name)){var f=U.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),m=U.getAdditionalStepFields(c.fields,s);o=f.nextStep?f.nextStep:0!==n.length||u||l?"summary":"".concat(e.name,"-endpoint"),d=te(te({},f),{},{fields:[].concat(N()(r),N()(U.injectAuthFieldsInfo([].concat(N()(f.fields),N()(m)),e.name,a,t.name)))})}return te({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:i.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(N()(r),N()(U.getAdditionalAuthFields(e.name,a,t.name)),N()(U.injectAuthFieldsInfo(U.getNoStepsFields(c.fields,p),e.name,a,t.name))),nextStep:o},d)},ae=n(12),ie=n.n(ae),re=function(e){var t=e.authenticationValues,n=Y()(),a=n.getState().values.selectedAuthentication,r=Object(p.useState)(a),o=i()(r,2),c=o[0],s=o[1];return Object(p.useEffect)((function(){c!==a&&(!function(e){var t=e.formOptions,n=e.authenticationValues,a=e.selectedAuthentication;if(a.startsWith("new-")){var i=a.replace("new-","");t.change("authentication",{authtype:i})}else{var r=n.find((function(e){return e.id===a}));t.change("authentication",r)}}({formOptions:n,authenticationValues:t,selectedAuthentication:a}),s(void 0))}),[a]),null};re.propTypes={authenticationValues:ie.a.arrayOf(ie.a.object)};var oe=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName,a=Object(g.a)();return d.a.createElement(L.TextContent,null,d.a.createElement(I.Text,{component:I.TextVariants.p},a.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:n})))};oe.propTypes={applicationTypeName:ie.a.string,authenticationTypeName:ie.a.string};var ce=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,r=e.supportedAuthType;return n.filter((function(e){return e.authtype===r})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),r=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",o=e.username?"-".concat(e.username):"",c=r?"-".concat(r.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(o).concat(c),value:e.id}}))},se=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,i=e.sourceType,r=e.applicationTypes,o=[{component:"description",name:"authtypesetter",Content:re,authenticationValues:a,hideField:!0}];return r.forEach((function(e){var c,s=e.supported_source_types.includes(i.name),u=!(null===(c=n.applications)||void 0===c?void 0:c.find((function(t){return t.application_type_id===e.id})));if(s&&u){var l=Q()(e,"supported_authentication_types[".concat(i.name,"]"),[]);l.forEach((function(c){if(a.find((function(e){return e.authtype===c}))){var s=Q()(i,"schema.authentication",{}).find((function(e){return e.type===c})).name;o.push({component:q.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(N()(l.length>1?[{when:"authtype",is:c}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:oe,applicationTypeName:e.display_name,authenticationTypeName:s},{component:q.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:z.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:s}),value:"new-".concat(c)}].concat(N()(ce({authenticationValues:a,source:n,applicationTypes:r,supportedAuthTypeName:s,supportedAuthType:c})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:o,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,r=t.authentication,o=n||{},c=o.application_type_id?o.application_type_id:"";return"".concat(i.name,"-").concat(c,"-").concat(a||(null==r?void 0:r.authtype))}}},ue=function(){var e=Object(g.a)();return d.a.createElement(L.TextContent,null,d.a.createElement(I.Text,{component:I.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===Q()(t,"supported_authentication_types.".concat(n,"[0]"))}))},pe=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},de=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=e.length>0,s=c?"summary":void 0,u=[],l=n.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&c){var p=l.schema.endpoint.hidden?l.schema.endpoint.fields:[],d=0===p.length;a.forEach((function(e){e.supported_source_types.includes(l.name)&&e.supported_authentication_types[l.name].forEach((function(n){u.push(ne(l,e,p,n,t))}))})),l.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(l.name)){var n=U.getAdditionalSteps(l.name,e.type,t.name);n.length>0&&u.push.apply(u,N()(U.createAdditionalSteps(n,l.name,e.type,d,e.fields,t.name)))}}))})),d&&u.push(U.createEndpointStep(l.schema.endpoint,l.name)),s=function(e){var t=e.values.application;if(t){var n,r=a.find((function(e){return e.id===t.application_type_id}));if((null==r||null===(n=r.supported_authentication_types[l.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(le(i,a.find((function(e){return e.id===t.application_type_id})),l.name))return"selectAuthentication";var o=null==r?void 0:r.supported_authentication_types[l.name][0];return"".concat(l.name,"-").concat(t&&t.application_type_id,"-").concat(o)}}}var f={component:"application-select",name:"application.application_type_id",options:e,container:o,validate:[{type:z.a.REQUIRED}]},m=a.filter((function(e){return pe(e,l)})).map((function(e){return $(l,e,t,i)}));return!r.imported&&c&&m.push(se({intl:t,source:r,authenticationValues:i,sourceType:l,applicationTypes:a})),{fields:[{component:q.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:o,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"Add or remove applications from {name}."},{name:r.name}),buttonLabels:{submit:t.formatMessage({id:"sources.add",defaultMessage:"Add"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:s,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Add / remove applications"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:Z,container:o},f,{component:"description",name:"authtypesetter",Content:G,hideField:!0}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:ue},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(N()(m),u)}]}},fe=n(601),me=function(e){var t=e.step,n=e.goToSources,a=e.name,i=Object(g.a)();return d.a.createElement(fe.Wizard,{isOpen:!0,onClose:n,title:i.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:i.formatMessage({id:"sources.addAppDescription",defaultMessage:"Add or remove applications from {name}."},{name:a}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};me.propTypes={step:ae.PropTypes.node.isRequired,goToSources:ae.PropTypes.func.isRequired,name:ae.PropTypes.string};var he=me,ge=n(39),ve=n(496),ye=n(471),be=n(136),Oe=n(108),je=n.n(Oe),_e=n(261),Ae=n.n(_e),Me=n(923),Ee=n(542),Te=n(490),we=n(541),Se=n(424),ke=n(605),xe=n.n(ke),Pe=n(926),Ce=n.n(Pe),De=n(927),Re=n.n(De),Ve=n(610);function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){X()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qe=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===Ae()(t[n])?xe()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},Be=function(){var e=l()(s.a.mark((function e(t,n,a,r){var o,c,u,l,p,d,f,m,h,g,v,y,b,O,j,_,A,M,E,T,w,S,k,x,P,C,D,R,V,N,F,q,B,z,I,L,U,W,Q,J,Y,G,K,Z,$,H,X,ee=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=ee.length>4&&void 0!==ee[4]?ee[4]:[],l=n.getState(),p=l.values,d=null===(o=p.authentication)||void 0===o?void 0:o.id,f=d&&a.find((function(e){return e.id===d})),m=t.authentication,h=je()(t,["authentication"]),g=Object(Me.addedDiff)(r,h),v=Object(Me.updatedDiff)(r,h),y=Object(Me.addedDiff)(f,m),b=Object(Me.updatedDiff)(f,m),O=qe(Fe(Fe({},Ce()(Re()(g),v)),{},{authentication:Fe({},Ce()(Re()(y),b))})),e.prev=11,null==p||null===(j=p.source)||void 0===j?void 0:j.id){e.next=14;break}throw"Missing source id";case 14:return E=new Date,T=p.source.id,w=null==p||null===(_=p.endpoint)||void 0===_?void 0:_.id,S=[],O.source&&!xe()(O.source)?S.push(Object(ge.k)().updateSource(T,O.source)):S.push(Promise.resolve(void 0)),k=O.endpoint&&!xe()(O.endpoint),x=O.url&&!xe()(O.url),k||x?(P=Object(Ve.b)(O),C=P.scheme,D=P.host,R=P.port,V=P.path,N=parseInt(R,10),F=qe(Fe(Fe({},O.endpoint),{},{scheme:C,host:D,port:isNaN(N)?void 0:N,path:V})),w?S.push(Object(ge.k)().updateEndpoint(w,F)):(q=Fe(Fe({},F),{},{default:!0,source_id:T}),S.push(Object(ge.k)().createEndpoint(q)))):S.push(Promise.resolve(void 0)),(null===(A=O.application)||void 0===A?void 0:A.application_type_id)?S.push(Object(ge.b)(T,O.application.application_type_id)):S.push(Promise.resolve(void 0)),e.next=25,Promise.all(S);case 25:if(B=e.sent,z=i()(B,3),z[0],I=z[1],L=z[2],!O.authentication||xe()(O.authentication)){e.next=41;break}if(!d){e.next=37;break}return e.next=34,Object(ge.k)().updateAuthentication(d,O.authentication);case 34:U=e.sent,e.next=41;break;case 37:return W=Fe(Fe({},O.authentication),{},{resource_id:(null==I?void 0:I.id)||(null==L?void 0:L.id),resource_type:(null==I?void 0:I.id)?"Endpoint":"Application"}),e.next=40,Object(ge.k)().createAuthentication(W);case 40:U=e.sent;case 41:return u=null==L?void 0:L.id,Q=d||(null===(M=U)||void 0===M?void 0:M.id),J=[],(null==L?void 0:L.id)&&Q&&(Y={application_id:L.id,authentication_id:Q},J.push(Object(ge.k)().createAuthApp(Y))),(O.credentials||O.billing_source)&&(G=O.credentials,K=O.billing_source,Z={},Z=G?{authentication:{credentials:G}}:{},Z=K?Fe(Fe({},Z),{},{billing_source:K}):Z,J.push(Object(Ee.patchSource)(Fe({id:T},Z)))),e.next=49,Promise.all(J);case 49:if(!w){e.next=53;break}return e.next=52,Object(we.checkAppAvailability)(w,void 0,void 0,"getEndpoint",E);case 52:$=e.sent;case 53:if(!L){e.next=59;break}return H=Object(Se.timeoutedApps)(c).includes(L.application_type_id)?1e4:0,e.next=57,Object(we.checkAppAvailability)(L.id,H);case 57:return X=e.sent,e.abrupt("return",Fe({id:X.id,applications:[X]},$&&{endpoint:[$]}));case 59:return e.abrupt("return",{});case 62:if(e.prev=62,e.t0=e.catch(11),console.error(e.t0),!u){e.next=68;break}return e.next=68,Object(ge.k)().deleteApplication(u);case 68:return e.next=70,Object(Te.handleError)(e.t0);case 70:throw e.sent;case 72:case"end":return e.stop()}}),e,null,[[11,62]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),ze=n(592);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){X()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ue={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},We=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,r=t.initialValues,o=t.error,c=t.values,s=t.data,u=t.formApi;switch(n){case"setSourceAppslength":return Le(Le({},e),{},{sourceAppsLength:a});case"loadAuthentications":return Le(Le({},e),{},{authenticationsValues:i,initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return Le(Le({},e),{},{initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return Le(Le({},e),{},{state:"wizard"});case"submit":return Le(Le({},e),{},{values:c,formApi:u,state:"submitting"});case"finish":return Le(Le({},e),{},{state:"finished",data:s});case"error":return Le(Le({},e),{},{state:"errored",error:o});case"toggleCancelling":return Le(Le({},e),{},{isCancelling:!e.isCancelling},c&&{values:c});default:return e}},Qe=n(134),Je=n(944),Ye=n(539),Ge=function(e,t,n,a,i,r,o,c){return i({type:"submit",values:e,formApi:t}),Be(e,t,n,r,o).then(function(){var e=l()(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(ze.a)(r.source.id),e.next=3,a(Object(D.f)());case 3:return c({values:{application:null}}),e.abrupt("return",i({type:"finish",data:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i({type:"error",error:e})}))},Ke=function(e){return d.a.createElement(C.a,o()({},e,{showFormControls:!1}))};t.default=function(){var e,t,n,a,r=Object(g.a)(),o=Object(f.k)(),c=Object(p.useRef)(),s=function(e){var t=e.values.application;return c.current=t},u=Object(ve.a)(),l=Object(h.useSelector)((function(e){return e.sources}),h.shallowEqual),v=l.appTypes,b=l.sourceTypesLoaded,j=l.appTypesLoaded,A=l.sourceTypes,E=Object(K.a)(),w=Object(h.useDispatch)(),k=Object(p.useReducer)(We,Ue),P=i()(k,2),C=P[0],D=P[1],V=Object(p.useRef)(document.createElement("div"));Object(p.useEffect)((function(){if(E){var e=C.sourceAppsLength>=E.applications.length&&C.sourceAppsLength>0;D({type:"setSourceAppslength",length:E.applications.length}),e||(E.endpoints&&E.endpoints[0]?Object(ge.k)().listEndpointAuthentications(E.endpoints[0].id).then((function(e){var t=e.data;return D({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:E,endpoint:E.endpoints[0],url:Object(ye.c)(E.endpoints[0]),application:c.current},values:{}})})):D({type:"loadWithoutAuthentications",initialValues:{source:E,application:c.current},values:{}}))}}),[E]);var N=function(){return o.push(be.c.sources.path)};if(!(j&&b&&u&&"loading"!==C.state||"submitting"===C.state))return d.a.createElement(he,{goToSources:N,step:d.a.createElement(_.a,{customText:r.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:r.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:N})});var F=function(e,t){return Ge(e,t,C.authenticationsValues,w,D,C.initialValues,v,s)};if("submitting"===C.state)return d.a.createElement(he,{name:E.name,goToSources:N,step:d.a.createElement(_.a,{cancelTitle:r.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:N,customText:r.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var q=function(){return D({type:"reset"})};if("wizard"!==C.state){var B;if("finished"!==C.state)B=d.a.createElement(M.a,{onRetry:q,onClose:N,returnButtonTitle:r.formatMessage({id:"sources.retry",defaultMessage:"Retry"}),primaryAction:function(){return F(C.values,C.formApi)},secondaryActions:d.a.createElement(Je.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},r.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"}))});else switch(x()(C.data)){default:B=d.a.createElement(T.a,{title:r.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),hideSourcesButton:!0,onReset:q,onClose:N,secondaryActions:d.a.createElement(Qe.Button,{variant:"link",onClick:q},r.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:r.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:r.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application was successfully added."})});break;case"unavailable":B=d.a.createElement(M.a,{onRetry:q,onClose:N,message:(null===(e=C.data.applications)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.availability_status_error)||(null===(n=C.data.endpoint)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.availability_status_error)||r.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:r.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),secondaryActions:d.a.createElement(Qe.Button,{variant:"link",onClick:function(){var e,t;return D({type:"reset"}),Object(Ye.a)({id:null===(e=C.data)||void 0===e?void 0:e.id,display_name:null===(t=v.find((function(e){var t;return e.id===(null===(t=C.data)||void 0===t?void 0:t.application_type_id)})))||void 0===t?void 0:t.display_name},r,void 0,w,E)}},r.formatMessage({id:"wizard.removeApp",defaultMessage:"Remove application"})),Component:function(){return d.a.createElement(m.Link,{to:Object(be.b)(be.c.sourcesEdit.path,E.id)},d.a.createElement(Qe.Button,{variant:"primary",className:"pf-u-mt-xl"},r.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))}});break;case"timeout":B=d.a.createElement(S.a,{returnButtonTitle:r.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),onClose:N,secondaryActions:d.a.createElement(Qe.Button,{variant:"link",onClick:q},r.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"}))})}return d.a.createElement(he,{name:E.name,goToSources:N,step:B})}var z=A.find((function(e){return e.id===E.source_type_id})),I=z&&z.name,L=v.filter((function(e){return e.supported_source_types.includes(I)})).filter(y.a).map((function(e){return{value:e.id,label:e.display_name}})),U=de(L,r,A,v,C.authenticationsValues,E,V.current),W=L.length>0?F:N;return d.a.createElement(d.a.Fragment,null,d.a.createElement(O.a,{title:r.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:C.isCancelling,onStay:function(){V.current.hidden=!1,D({type:"toggleCancelling"})},onExit:N}),d.a.createElement(R.a,{schema:U,showFormControls:!1,onSubmit:W,onCancel:function(e){(null==e?void 0:e.application)?(V.current.hidden=!0,D({type:"toggleCancelling",values:e})):N()},initialValues:C.initialValues,subscription:{values:!0},debug:s,clearedValue:null,FormTemplate:Ke}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map