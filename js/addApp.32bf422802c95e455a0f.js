(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{524:function(e,t,n){"use strict";var a=n(129);t.a=function(e,t,n,i,r){var o=t.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:e.display_name}),c=t.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:e.display_name});return n&&n(),i(Object(a.i)(e.id,r.id,o,c))}},589:function(e,t,n){"use strict";var a=n(131),i=n.n(a),r=n(3),o=n.n(r),c=n(0),s=n.n(c),u=n(467),p=n.n(u),l=n(449),d=n.n(l),f=n(472),m=n.n(f),h=n(571),g=n(56),v=n.n(g),y=n(410),b=n.n(y),O=n(409),j=n(434),_=n(568),A=n.n(_),M=n(404),E=n.n(M),T=n(405),w=n.n(T),S=n(474),k=n.n(S);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=function(e){var t,n,a=E()(),r=a.getState().values,o=(null==e||null===(t=e.name)||void 0===t?void 0:t.match(/\d+/))||[],u=v()(o,1)[0]||(null===(n=r.authentication)||void 0===n?void 0:n.id),p=b()(r,e.name),l=Object(c.useState)(!u||p),d=v()(l,2),f=d[0],m=d[1],h=Object(c.useRef)(!0),g=Object(c.useRef)(!1);Object(c.useEffect)((function(){g.current&&(!h.current&&a.getState().pristine&&(m(!1),h.current=!0),f&&(h.current=!1))})),Object(c.useEffect)((function(){g.current=!0}),[]);var y=e.validate&&e.validate.filter((function(e){return e.type!==w.a.REQUIRED})),_=P(P({},e),u?{validate:y,resolveProps:k.a}:{});return!f&&u?s.a.createElement(O.FormGroup,{helperText:_.helperText,label:_.label,onFocus:function(){return m(!0)},isRequired:!0},s.a.createElement(j.TextInput,{"aria-label":"pre-filled-authentication",value:"•••••••••••••"})):s.a.createElement(A.a,i()({},_,{autoFocus:!0}))},D=n(49),R=n.n(D),V=n(12),N=n.n(V),F=n(48),q=n(252),B=n(436),z=n(128),I=n(525),L=n.n(I),U=n(408),W=n.n(U),Q=n(433),J=n(208),Y=n(209),G=n(127),K=n(457),Z=n(211),$=n(213),H=n.n($),X=n(524),ee=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(q.a)(),r=Object(F.useSelector)((function(e){return e.sources.appTypes})),o=Object(Q.a)(),u=Object(F.useDispatch)();Object(c.useEffect)((function(){a&&(a.hidden=!0)}),[]);var p=t.dependent_applications.map((function(e){var n=r.find((function(t){return t.name===e}));return t.sourceAppsNames.includes(null==n?void 0:n.display_name)&&(null==n?void 0:n.display_name)})).filter((function(e){return e}));return s.a.createElement(K.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:s.a.createElement(Z.Title,{headingLevel:"h1",size:"2xl"},s.a.createElement(H.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[s.a.createElement(G.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){return Object(X.a)(t,i,n,u,o)}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove"})),s.a.createElement(G.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},i.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},s.a.createElement(Y.TextContent,null,s.a.createElement(J.Text,{component:J.TextVariants.p},i.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"{ appName } will be disconnected from this source."},{appName:s.a.createElement("b",{key:"b"},t.display_name)})),p.length>0&&s.a.createElement(J.Text,{component:J.TextVariants.p},i.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:p}))))};ee.propTypes={app:N.a.shape({id:N.a.string.isRequired,display_name:N.a.string.isRequired,dependent_applications:N.a.arrayOf(N.a.string),sourceAppsNames:N.a.arrayOf(N.a.string)}).isRequired,onCancel:N.a.func.isRequired,container:N.a.instanceOf(Element)};var te=ee,ne=function(e){var t=e.option,n=e.setApplicationToRemove,a=e.sourceAppsNames,i=e.app,r=e.appType,o=Object(q.a)();return s.a.createElement("div",{className:"pf-c-radio pf-u-mb-md"},s.a.createElement(z.Button,{id:"remove-app-".concat(t.value),variant:"plain","aria-label":o.formatMessage({id:"source.removeAppAria",defaultMessage:"Remove application {app} from this source"},{app:t.label}),className:"pf-u-p-0",onClick:function(){return n({id:null==i?void 0:i.id,display_name:null==r?void 0:r.display_name,dependent_applications:null==r?void 0:r.dependent_applications,sourceAppsNames:a})}},s.a.createElement(L.a,{variant:"small"})),s.a.createElement("label",{className:"pf-c-radio__label",htmlFor:"remove-app-".concat(t.value)},t.label))};ne.propTypes={option:N.a.shape({label:N.a.string.isRequired,value:N.a.string.isRequired}),setApplicationToRemove:N.a.func.isRequired,sourceAppsNames:N.a.arrayOf(N.a.string),appType:N.a.shape({display_name:N.a.string.isRequired,dependent_applications:N.a.arrayOf(N.a.string)}),app:N.a.shape({id:N.a.string.isRequired,application_type_id:N.a.string.isRequired})};var ae=function(e){var t=W()(e),n=t.options,a=t.input,i=a.onChange,r=a.value,o=a.name,u=t.container,p=Object(c.useState)({}),l=v()(p,2),d=l[0],f=l[1],m=Object(F.useSelector)((function(e){return e.sources.appTypes})),h=Object(Q.a)(),g=h.applications.map((function(e){var t,n=e.application_type_id;return null===(t=m.find((function(e){return e.id===n})))||void 0===t?void 0:t.display_name})),y=function(e){return null==m?void 0:m.find((function(t){return t.id===e}))},b=function(e){return h.applications.find((function(t){return t.application_type_id===e}))},O=function(e){var t;return null===(t=b(e))||void 0===t?void 0:t.isDeleting},j=h.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(R()(e),[t.application_type_id])}),[]);return s.a.createElement("div",null,d.id&&s.a.createElement(te,{app:d,onCancel:function(){return u&&(u.hidden=!1),f({})},container:u}),n.map((function(e){return j.includes(e.value)?s.a.createElement(ne,{key:e.value,option:e,setApplicationToRemove:f,sourceAppsNames:g,app:b(e.value),appType:y(e.value)}):s.a.createElement(B.Radio,{className:"pf-u-mb-md",key:e.value,onChange:function(){return i(e.value)},label:e.label,id:"".concat(o,"-").concat(e.value),name:o,isChecked:r===e.value,isDisabled:O(e.value)})})))};function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return s.a.createElement(p.a,i()({FormTemplate:d.a,componentMapper:re(re(re({},m.a),h.mapperExtension),{},{authentication:C,"application-select":ae})},e))}},590:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return l}));var a=n(3),i=n.n(a),r=n(458),o=n(39),c=n(15);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=function(e){return e.url||null===e.url?function(e){if(null===e)return{scheme:null,host:null,port:null,path:null};if(!e)return{};try{var t=new URL(e),n=t.protocol.replace(/:$/,"");return{scheme:n,host:t.hostname,port:""===t.port?Object(r.b)(n):t.port,path:t.pathname}}catch(e){return{}}}(e.url):e.endpoint?e.endpoint:e},l=function(e,t){var n,a,i=[];if(t.source&&i.push(Object(o.k)().updateSource(e.source.id,t.source)),t.endpoint||t.url||null===t.url){var r=p(t),s=r.scheme,l=r.host,d=r.port,f=r.path,m=null===d?null:parseInt(d,10),h=u({scheme:s,host:l,path:f,port:null===m?null:isNaN(m)?void 0:m},t.endpoint);i.push(Object(o.k)().updateEndpoint(e.endpoints[0].id,h))}if(t.authentications&&Object.keys(t.authentications).forEach((function(e){var n=e.replace("a","");i.push(Object(o.k)().updateAuthentication(n,t.authentications[e]))})),t.billing_source||t.credentials){var g={};t.credentials&&(g={authentication:{credentials:t.credentials}}),t.billing_source&&(g=u(u({},g),{},{billing_source:t.billing_source})),i.push((n=e.source.id,a=g,o.a.patch("".concat(c.a,"/sources/").concat(n,"/"),a)))}return Promise.all(i)}},930:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return Ge}));var a=n(56),i=n.n(a),r=n(131),o=n.n(r),c=n(103),s=n.n(c),u=n(133),p=n.n(u),l=n(0),d=n.n(l),f=n(13),m=n(97),h=n(48),g=n(252),v=n(577),y=n.n(v),b=n(578),O=n.n(b),j=n(575),_=n.n(j),A=n(576),M=n.n(A),E=n(579),T=n.n(E),w=n(580),S=n.n(w),k=n(449),x=n.n(k),P=n(129),C=n(589),D=n(49),R=n.n(D),V=n(406),N=n.n(V),F=n(405),q=n.n(F),B=n(208),z=n(209),I=n(673),L=n(410),U=n.n(L),W=n(404),Q=n.n(W),J=function(){var e=Q()(),t=U()(e.getState().values,"application.application_type_id",""),n=Object(l.useState)(t),a=i()(n,2),r=a[0],o=a[1];return Object(l.useEffect)((function(){r!==t&&(e.batch((function(){e.change("authentication",void 0),e.change("selectedAuthentication",void 0)})),o(void 0))}),[t]),null},Y=n(433),G=function(){var e=Object(g.a)(),t=Object(h.useSelector)((function(e){return e.sources.sourceTypes})),n=Object(Y.a)(),a=t.find((function(e){return e.id===n.source_type_id})),i=n.applications.filter((function(e){return!e.isDeleting})),r=n.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(R()(e),[t.application_type_id])}),[]),o=i.filter((function(e){var t=e.id;return!r.includes(t)})).length>0?d.a.createElement(d.a.Fragment,null,d.a.createElement(B.Text,{component:B.TextVariants.h4,id:"add-application-header"},e.formatMessage({id:"sources.apps",defaultMessage:"Applications"})),d.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-description"},e.formatMessage({id:"sources.addAppMultipleAppDesc",defaultMessage:"Select a radio button to add an application. Click trash icon to remove an application."}))):d.a.createElement(d.a.Fragment,null,d.a.createElement(B.Text,{component:B.TextVariants.h4,id:"add-application-header"},e.formatMessage({id:"sources.addApp",defaultMessage:"Add an application"})),d.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-description"},e.formatMessage({id:"sources.addAppNoAppsDesc",defaultMessage:"There are currently no applications connected to this source. Select from available applications below."})));return d.a.createElement(d.a.Fragment,null,d.a.createElement(z.TextContent,null,d.a.createElement(B.Text,{component:B.TextVariants.h4},e.formatMessage({id:"sources.type",defaultMessage:"Source type"})),d.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-desc-type"},a?a.product_name:e.formatMessage({id:"sources.typeNotFound",defaultMessage:"Type not found"})),o))},K=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:N.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:q.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,r=n.authtype;if(r)return a.find((function(e){return e.authtype===r}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(r)}}},Z=n(3),$=n.n(Z);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){$()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ee=function(e,t,n,a,i){var r=R()(n);I.shouldUseAppAuth(e.name,a,t.name)&&(r=[]);var o,c=e.schema.authentication.find((function(e){return e.type===a})),s="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),u=I.shouldSkipEndpoint(e.name,a,t.name),p=I.hasCustomSteps(e.name,a,t.name);o=I.getAdditionalSteps(e.name,a,t.name).length>0?s:0!==n.length||u?"summary":"".concat(e.name,"-endpoint");var l=I.getAdditionalStepKeys(e.name,a,t.name),d={};if(I.shouldSkipSelection(e.name,a,t.name)){var f=I.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),m=I.getAdditionalStepFields(c.fields,s);o=f.nextStep?f.nextStep:0!==n.length||u||p?"summary":"".concat(e.name,"-endpoint"),d=X(X({},f),{},{fields:[].concat(R()(r),R()(I.injectAuthFieldsInfo([].concat(R()(f.fields),R()(m)),e.name,a,t.name)))})}return X({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:i.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(R()(r),R()(I.getAdditionalAuthFields(e.name,a,t.name)),R()(I.injectAuthFieldsInfo(I.getNoStepsFields(c.fields,l),e.name,a,t.name))),nextStep:o},d)},te=n(12),ne=n.n(te),ae=function(e){var t=e.authenticationValues,n=Q()(),a=n.getState().values.selectedAuthentication,r=Object(l.useState)(a),o=i()(r,2),c=o[0],s=o[1];return Object(l.useEffect)((function(){c!==a&&(!function(e){var t=e.formOptions,n=e.authenticationValues,a=e.selectedAuthentication;if(a.startsWith("new-")){var i=a.replace("new-","");t.change("authentication",{authtype:i})}else{var r=n.find((function(e){return e.id===a}));t.change("authentication",r)}}({formOptions:n,authenticationValues:t,selectedAuthentication:a}),s(void 0))}),[a]),null};ae.propTypes={authenticationValues:ne.a.arrayOf(ne.a.object)};var ie=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName,a=Object(g.a)();return d.a.createElement(z.TextContent,null,d.a.createElement(B.Text,{component:B.TextVariants.p},a.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:n})))};ie.propTypes={applicationTypeName:ne.a.string,authenticationTypeName:ne.a.string};var re=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,r=e.supportedAuthType;return n.filter((function(e){return e.authtype===r})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),r=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",o=e.username?"-".concat(e.username):"",c=r?"-".concat(r.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(o).concat(c),value:e.id}}))},oe=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,i=e.sourceType,r=e.applicationTypes,o=[{component:"description",name:"authtypesetter",Content:ae,authenticationValues:a,hideField:!0}];return r.forEach((function(e){var c,s=e.supported_source_types.includes(i.name),u=!(null===(c=n.applications)||void 0===c?void 0:c.find((function(t){return t.application_type_id===e.id})));if(s&&u){var p=U()(e,"supported_authentication_types[".concat(i.name,"]"),[]);p.forEach((function(c){if(a.find((function(e){return e.authtype===c}))){var s=U()(i,"schema.authentication",{}).find((function(e){return e.type===c})).name;o.push({component:N.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(R()(p.length>1?[{when:"authtype",is:c}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:ie,applicationTypeName:e.display_name,authenticationTypeName:s},{component:N.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:q.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:s}),value:"new-".concat(c)}].concat(R()(re({authenticationValues:a,source:n,applicationTypes:r,supportedAuthTypeName:s,supportedAuthType:c})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:o,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,r=t.authentication,o=n||{},c=o.application_type_id?o.application_type_id:"";return"".concat(i.name,"-").concat(c,"-").concat(a||(null==r?void 0:r.authtype))}}},ce=function(){var e=Object(g.a)();return d.a.createElement(z.TextContent,null,d.a.createElement(B.Text,{component:B.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===U()(t,"supported_authentication_types.".concat(n,"[0]"))}))},ue=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=e.length>0,s=c?"summary":void 0,u=[],p=n.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&c){var l=p.schema.endpoint.hidden?p.schema.endpoint.fields:[],d=0===l.length;a.forEach((function(e){e.supported_source_types.includes(p.name)&&e.supported_authentication_types[p.name].forEach((function(n){u.push(ee(p,e,l,n,t))}))})),p.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(p.name)){var n=I.getAdditionalSteps(p.name,e.type,t.name);n.length>0&&u.push.apply(u,R()(I.createAdditionalSteps(n,p.name,e.type,d,e.fields,t.name)))}}))})),d&&u.push(I.createEndpointStep(p.schema.endpoint,p.name)),s=function(e){var t=e.values.application;if(t){var n,r=a.find((function(e){return e.id===t.application_type_id}));if((null==r||null===(n=r.supported_authentication_types[p.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(se(i,a.find((function(e){return e.id===t.application_type_id})),p.name))return"selectAuthentication";var o=null==r?void 0:r.supported_authentication_types[p.name][0];return"".concat(p.name,"-").concat(t&&t.application_type_id,"-").concat(o)}}}var f={component:"application-select",name:"application.application_type_id",options:e,container:o,validate:[{type:q.a.REQUIRED}]},m=a.filter((function(e){return ue(e,p)})).map((function(e){return K(p,e,t,i)}));return!r.imported&&c&&m.push(oe({intl:t,source:r,authenticationValues:i,sourceType:p,applicationTypes:a})),{fields:[{component:N.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:o,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"Add or remove applications from {name}."},{name:r.name}),buttonLabels:{submit:t.formatMessage({id:"sources.add",defaultMessage:"Add"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:s,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Add / remove applications"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:G,container:o},f,{component:"description",name:"authtypesetter",Content:J,hideField:!0}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:ce},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(R()(m),u)}]}},le=n(581),de=function(e){var t=e.step,n=e.goToSources,a=e.name,i=Object(g.a)();return d.a.createElement(le.Wizard,{isOpen:!0,onClose:n,title:i.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:i.formatMessage({id:"sources.addAppDescription",defaultMessage:"Add or remove applications from {name}."},{name:a}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};de.propTypes={step:te.PropTypes.node.isRequired,goToSources:te.PropTypes.func.isRequired,name:te.PropTypes.string};var fe=de,me=n(39),he=n(481),ge=n(458),ve=n(130),ye=n(102),be=n.n(ye),Oe=n(255),je=n.n(Oe),_e=n(898),Ae=n(527),Me=n(476),Ee=n(526),Te=n(411),we=n(585),Se=n.n(we),ke=n(901),xe=n.n(ke),Pe=n(902),Ce=n.n(Pe),De=n(590);function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){$()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ne=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===je()(t[n])?Se()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},Fe=function(){var e=p()(s.a.mark((function e(t,n,a,r){var o,c,u,p,l,d,f,m,h,g,v,y,b,O,j,_,A,M,E,T,w,S,k,x,P,C,D,R,V,N,F,q,B,z,I,L,U,W,Q,J,Y,G,K,Z,$=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=$.length>4&&void 0!==$[4]?$[4]:[],p=n.getState(),l=p.values,d=null===(o=l.authentication)||void 0===o?void 0:o.id,f=d&&a.find((function(e){return e.id===d})),m=t.authentication,h=be()(t,["authentication"]),g=Object(_e.addedDiff)(r,h),v=Object(_e.updatedDiff)(r,h),y=Object(_e.addedDiff)(f,m),b=Object(_e.updatedDiff)(f,m),O=Ne(Ve(Ve({},xe()(Ce()(g),v)),{},{authentication:Ve({},xe()(Ce()(y),b))})),e.prev=11,null==l||null===(j=l.source)||void 0===j?void 0:j.id){e.next=14;break}throw"Missing source id";case 14:return E=l.source.id,T=null==l||null===(_=l.endpoint)||void 0===_?void 0:_.id,w=[],O.source&&!Se()(O.source)?w.push(Object(me.k)().updateSource(E,O.source)):w.push(Promise.resolve(void 0)),S=O.endpoint&&!Se()(O.endpoint),k=O.url&&!Se()(O.url),S||k?(x=Object(De.b)(O),P=x.scheme,C=x.host,D=x.port,R=x.path,V=parseInt(D,10),N=Ne(Ve(Ve({},O.endpoint),{},{scheme:P,host:C,port:isNaN(V)?void 0:V,path:R})),T?w.push(Object(me.k)().updateEndpoint(T,N)):(F=Ve(Ve({},N),{},{default:!0,source_id:E}),w.push(Object(me.k)().createEndpoint(F)))):w.push(Promise.resolve(void 0)),(null===(A=O.application)||void 0===A?void 0:A.application_type_id)?w.push(Object(me.b)(E,O.application.application_type_id)):w.push(Promise.resolve(void 0)),e.next=24,Promise.all(w);case 24:if(q=e.sent,B=i()(q,3),B[0],z=B[1],I=B[2],!O.authentication||Se()(O.authentication)){e.next=40;break}if(!d){e.next=36;break}return e.next=33,Object(me.k)().updateAuthentication(d,O.authentication);case 33:L=e.sent,e.next=40;break;case 36:return U=Ve(Ve({},O.authentication),{},{resource_id:(null==z?void 0:z.id)||(null==I?void 0:I.id),resource_type:(null==z?void 0:z.id)?"Endpoint":"Application"}),e.next=39,Object(me.k)().createAuthentication(U);case 39:L=e.sent;case 40:return u=null==I?void 0:I.id,W=d||(null===(M=L)||void 0===M?void 0:M.id),Q=[],(null==I?void 0:I.id)&&W&&(J={application_id:I.id,authentication_id:W},Q.push(Object(me.k)().createAuthApp(J))),(O.credentials||O.billing_source)&&(Y=O.credentials,G=O.billing_source,K={},K=Y?{authentication:{credentials:Y}}:{},K=G?Ve(Ve({},K),{},{billing_source:G}):K,Q.push(Object(Ae.patchSource)(Ve({id:E},K)))),e.next=48,Promise.all(Q);case 48:if(!I){e.next=53;break}return Z=Object(Te.timeoutedApps)(c).includes(I.application_type_id)?1e4:0,e.next=52,Object(Ee.checkAppAvailability)(I.id,Z);case 52:return e.abrupt("return",e.sent);case 53:return e.abrupt("return",{});case 56:if(e.prev=56,e.t0=e.catch(11),console.error(e.t0),!u){e.next=62;break}return e.next=62,Object(me.k)().deleteApplication(u);case 62:return e.next=64,Object(Me.handleError)(e.t0);case 64:throw e.sent;case 66:case"end":return e.stop()}}),e,null,[[11,56]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),qe=n(556);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){$()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},Le=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,r=t.initialValues,o=t.error,c=t.values,s=t.data,u=t.formApi;switch(n){case"setSourceAppslength":return ze(ze({},e),{},{sourceAppsLength:a});case"loadAuthentications":return ze(ze({},e),{},{authenticationsValues:i,initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return ze(ze({},e),{},{initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return ze(ze({},e),{},{state:"wizard"});case"submit":return ze(ze({},e),{},{values:c,formApi:u,state:"submitting"});case"finish":return ze(ze({},e),{},{state:"finished",data:s});case"error":return ze(ze({},e),{},{state:"errored",error:o});case"toggleCancelling":return ze(ze({},e),{},{isCancelling:!e.isCancelling},c&&{values:c});default:return e}},Ue=n(128),We=n(919),Qe=n(524),Je=void 0,Ye=function(e){var t=e.values.application;return Je=t},Ge=function(e,t,n,a,i,r,o){return i({type:"submit",values:e,formApi:t}),Fe(e,t,n,r,o).then(function(){var e=p()(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(qe.a)(r.source.id),e.next=3,a(Object(P.f)());case 3:return Je=void 0,e.abrupt("return",i({type:"finish",data:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i({type:"error",error:e})}))},Ke=function(e){return d.a.createElement(x.a,o()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(g.a)(),t=Object(f.k)(),n=Object(he.a)(),a=Object(h.useSelector)((function(e){return e.sources}),h.shallowEqual),r=a.appTypes,o=a.sourceTypesLoaded,c=a.appTypesLoaded,s=a.sourceTypes,u=Object(Y.a)(),p=Object(h.useDispatch)(),v=Object(l.useReducer)(Le,Ie),b=i()(v,2),j=b[0],A=b[1],E=Object(l.useRef)(document.createElement("div"));Object(l.useEffect)((function(){Je=void 0}),[]),Object(l.useEffect)((function(){if(u){var e=j.sourceAppsLength>=u.applications.length&&j.sourceAppsLength>0;A({type:"setSourceAppslength",length:u.applications.length}),e||(u.endpoints&&u.endpoints[0]?Object(me.k)().listEndpointAuthentications(u.endpoints[0].id).then((function(e){var t=e.data;return A({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:u,endpoint:u.endpoints[0],url:Object(ge.c)(u.endpoints[0]),application:Je},values:{}})})):A({type:"loadWithoutAuthentications",initialValues:{source:u,application:Je},values:{}}))}}),[u]);var w=function(){return t.push(ve.c.sources.path)};if(!(c&&o&&n&&"loading"!==j.state||"submitting"===j.state))return d.a.createElement(fe,{goToSources:w,step:d.a.createElement(_.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w})});var k=function(e,t){return Ge(e,t,j.authenticationsValues,p,A,j.initialValues,r)};if("submitting"===j.state)return d.a.createElement(fe,{name:u.name,goToSources:w,step:d.a.createElement(_.a,{cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w,customText:e.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var x=function(){return A({type:"reset"})};if("wizard"!==j.state){var P;if("finished"!==j.state)P=d.a.createElement(M.a,{onRetry:x,onClose:w,returnButtonTitle:e.formatMessage({id:"sources.retry",defaultMessage:"Retry"}),primaryAction:function(){return k(j.values,j.formApi)},secondaryActions:d.a.createElement(We.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},e.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"}))});else switch(j.data.availability_status){case"available":P=d.a.createElement(T.a,{title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),hideSourcesButton:!0,onReset:x,onClose:w,secondaryActions:d.a.createElement(Ue.Button,{variant:"link",onClick:x},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:e.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application was successfully added."})});break;case"unavailable":P=d.a.createElement(M.a,{onRetry:x,onClose:w,message:j.data.availability_status_error||e.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),secondaryActions:d.a.createElement(Ue.Button,{variant:"link",onClick:function(){var t,n;return A({type:"reset"}),Object(Qe.a)({id:null===(t=j.data)||void 0===t?void 0:t.id,display_name:null===(n=r.find((function(e){var t;return e.id===(null===(t=j.data)||void 0===t?void 0:t.application_type_id)})))||void 0===n?void 0:n.display_name},e,void 0,p,u)}},e.formatMessage({id:"wizard.removeApp",defaultMessage:"Remove application"})),Component:function(){return d.a.createElement(m.Link,{to:Object(ve.b)(ve.c.sourcesEdit.path,u.id)},d.a.createElement(Ue.Button,{variant:"primary",className:"pf-u-mt-xl"},e.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))}});break;default:P=d.a.createElement(S.a,{returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),onClose:w,secondaryActions:d.a.createElement(Ue.Button,{variant:"link",onClick:x},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"}))})}return d.a.createElement(fe,{name:u.name,goToSources:w,step:P})}var D=s.find((function(e){return e.id===u.source_type_id})),R=D&&D.name,V=r.filter((function(e){return e.supported_source_types.includes(R)})).filter(y.a).map((function(e){return{value:e.id,label:e.display_name}})),N=pe(V,e,s,r,j.authenticationsValues,u,E.current),F=V.length>0?k:w;return d.a.createElement(d.a.Fragment,null,d.a.createElement(O.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:j.isCancelling,onStay:function(){E.current.hidden=!1,A({type:"toggleCancelling"})},onExit:w}),d.a.createElement(C.a,{schema:N,showFormControls:!1,onSubmit:F,onCancel:function(e){(null==e?void 0:e.application)?(E.current.hidden=!0,A({type:"toggleCancelling",values:e})):w()},initialValues:j.initialValues,subscription:{values:!0},debug:Ye,clearedValue:null,FormTemplate:Ke}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map