(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{542:function(e,t,n){"use strict";var a=n(113);t.a=function(e,t,n,i,r){var o=t.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:e.display_name}),c=t.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:e.display_name});return n&&n(),i(Object(a.i)(e.id,r.id,o,c))}},605:function(e,t,n){"use strict";var a=n(115),i=n.n(a),r=n(2),o=n.n(r),c=n(0),s=n.n(c),u=n(489),p=n.n(u),l=n(431),d=n.n(l),f=n(430),m=n.n(f),h=n(477),g=n.n(h),v=n(470),y=n.n(v),b=n(494),O=n.n(b),j=n(586),_=n(47),E=n.n(_),A=n(435),M=n.n(A),T=n(434),w=n(454),S=n(583),k=n.n(S),P=n(429),x=n.n(P),C=n(497),R=n.n(C);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=function(e){var t,n,a=x()(),r=a.getState().values,o=(null==e||null===(t=e.name)||void 0===t?void 0:t.match(/\d+/))||[],u=E()(o,1)[0]||(null===(n=r.authentication)||void 0===n?void 0:n.id),p=M()(r,e.name),l=Object(c.useState)(!u||p),d=E()(l,2),f=d[0],h=d[1],g=Object(c.useRef)(!0),v=Object(c.useRef)(!1);Object(c.useEffect)((function(){v.current&&(!g.current&&a.getState().pristine&&(h(!1),g.current=!0),f&&(g.current=!1))})),Object(c.useEffect)((function(){v.current=!0}),[]);var y=e.validate&&e.validate.filter((function(e){return e.type!==m.a.REQUIRED})),b=N(N({},e),u?{validate:y,resolveProps:R.a}:{});return f?s.a.createElement(k.a,i()({},b,{autoFocus:!0})):s.a.createElement(T.FormGroup,{helperText:b.helperText,label:b.label,onFocus:function(){return h(!0)},isRequired:!0},s.a.createElement(w.TextInput,{"aria-label":"pre-filled-authentication",value:"•••••••••••••"}))},F=n(43),q=n.n(F),B=n(9),I=n.n(B),L=n(37),z=n(235),U=n(456),W=n(112),Q=n(543),G=n.n(Q),H=n(433),J=n.n(H),Y=n(453),K=n(196),Z=n(197),$=n(111),X=n(498),ee=n(199),te=n(204),ne=n.n(te),ae=n(542),ie=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(z.a)(),r=Object(L.useSelector)((function(e){return e.sources.appTypes})),o=Object(Y.a)(),u=Object(L.useDispatch)();Object(c.useEffect)((function(){a&&(a.hidden=!0)}),[]);var p=t.dependent_applications.map((function(e){var n=r.find((function(t){return t.name===e}));return n&&t.sourceAppsNames.includes(n.display_name)?n.display_name:void 0})).filter((function(e){return e}));return s.a.createElement(X.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:s.a.createElement(ee.Title,{headingLevel:"h1",size:"2xl"},s.a.createElement(ne.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[s.a.createElement($.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){return Object(ae.a)(t,i,n,u,o)}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove"})),s.a.createElement($.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},i.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},s.a.createElement(Z.TextContent,null,s.a.createElement(K.Text,{component:K.TextVariants.p},i.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"{ appName } will be disconnected from this source."},{appName:s.a.createElement("b",{key:"b"},t.display_name)})),p.length>0&&s.a.createElement(K.Text,{component:K.TextVariants.p},i.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:p}))))};ie.propTypes={app:I.a.shape({id:I.a.string.isRequired,display_name:I.a.string.isRequired,dependent_applications:I.a.arrayOf(I.a.string),sourceAppsNames:I.a.arrayOf(I.a.string)}).isRequired,onCancel:I.a.func.isRequired,container:I.a.instanceOf(Element)};var re=ie,oe=function(e){var t=e.option,n=e.setApplicationToRemove,a=e.sourceAppsNames,i=e.app,r=e.appType,o=Object(z.a)();return s.a.createElement("div",{className:"pf-c-radio pf-u-mb-md"},s.a.createElement(W.Button,{id:"remove-app-".concat(t.value),variant:"plain","aria-label":o.formatMessage({id:"source.removeAppAria",defaultMessage:"Remove application {app} from this source"},{app:t.label}),className:"pf-u-p-0",onClick:function(){return n({id:null==i?void 0:i.id,display_name:null==r?void 0:r.display_name,dependent_applications:null==r?void 0:r.dependent_applications,sourceAppsNames:a})}},s.a.createElement(G.a,{variant:"small"})),s.a.createElement("label",{className:"pf-c-radio__label",htmlFor:"remove-app-".concat(t.value)},t.label))};oe.propTypes={option:I.a.shape({label:I.a.string.isRequired,value:I.a.string.isRequired}),setApplicationToRemove:I.a.func.isRequired,sourceAppsNames:I.a.arrayOf(I.a.string),appType:I.a.shape({display_name:I.a.string.isRequired,dependent_applications:I.a.arrayOf(I.a.string)}),app:I.a.shape({id:I.a.string.isRequired,application_type_id:I.a.string.isRequired})};var ce=function(e){var t=J()(e),n=t.options,a=t.input,i=a.onChange,r=a.value,o=a.name,u=t.container,p=Object(c.useState)({}),l=E()(p,2),d=l[0],f=l[1],m=Object(L.useSelector)((function(e){return e.sources.appTypes})),h=Object(Y.a)(),g=h.applications.map((function(e){var t=e.application_type_id,n=m.find((function(e){return e.id===t}));return n?n.display_name:void 0})),v=function(e){return null==m?void 0:m.find((function(t){return t.id===e}))},y=function(e){return h.applications.find((function(t){return t.application_type_id===e}))},b=function(e){var t;return null===(t=y(e))||void 0===t?void 0:t.isDeleting},O=h.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(q()(e),[t.application_type_id])}),[]);return s.a.createElement("div",null,d.id&&s.a.createElement(re,{app:d,onCancel:function(){return u&&(u.hidden=!1),f({})},container:u}),n.map((function(e){return O.includes(e.value)?s.a.createElement(oe,{key:e.value,option:e,setApplicationToRemove:f,sourceAppsNames:g,app:y(e.value),appType:v(e.value)}):s.a.createElement(U.Radio,{className:"pf-u-mb-md",key:e.value,onChange:function(){return i(e.value)},label:e.label,id:"".concat(o,"-").concat(e.value),name:o,isChecked:r===e.value,isDisabled:b(e.value)})})))};function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return s.a.createElement(p.a,i()({FormTemplate:y.a,componentMapper:ue(ue(ue({},O.a),j.mapperExtension),{},{authentication:V,"switch-field":O.a[d.a.SWITCH],"application-select":ce}),validatorMapper:{"required-validator":g.a[m.a.REQUIRED],"pattern-validator":g.a[m.a.PATTERN],"min-length-validator":g.a[m.a.MIN_LENGTH],"url-validator":g.a[m.a.URL]}},e))}},606:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return l}));var a=n(2),i=n.n(a),r=n(481),o=n(26),c=n(12);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=function(e){return e.url||null===e.url?function(e){if(null===e)return{scheme:null,host:null,port:null,path:null};if(!e)return{};try{var t=new URL(e),n=t.protocol.replace(/:$/,"");return{scheme:n,host:t.hostname,port:""===t.port?Object(r.b)(n):t.port,path:t.pathname}}catch(e){return{}}}(e.url):e.endpoint?e.endpoint:e},l=function(e,t){var n,a,i=[];if(t.source&&i.push(Object(o.k)().updateSource(e.source.id,t.source)),t.endpoint||t.url||null===t.url){var r=p(t),s=r.scheme,l=r.host,d=r.port,f=r.path,m=null===d?null:parseInt(d,10),h=u({scheme:s,host:l,path:f,port:null===m?null:isNaN(m)?void 0:m},t.endpoint);i.push(Object(o.k)().updateEndpoint(e.endpoints[0].id,h))}if(t.authentications&&Object.keys(t.authentications).forEach((function(e){var n=e.replace("a","");i.push(Object(o.k)().updateAuthentication(n,t.authentications[e]))})),t.billing_source||t.credentials){var g={};t.credentials&&(g={authentication:{credentials:t.credentials}}),t.billing_source&&(g=u(u({},g),{},{billing_source:t.billing_source})),i.push((n=e.source.id,a=g,o.a.patch("".concat(c.a,"/sources/").concat(n,"/"),a)))}return Promise.all(i)}},952:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return Je}));var a=n(47),i=n.n(a),r=n(115),o=n.n(r),c=n(87),s=n.n(c),u=n(119),p=n.n(u),l=n(0),d=n.n(l),f=n(10),m=n(81),h=n(37),g=n(235),v=n(673),y=n.n(v),b=n(674),O=n.n(b),j=n(593),_=n.n(j),E=n(594),A=n.n(E),M=n(675),T=n.n(M),w=n(676),S=n.n(w),k=n(470),P=n.n(k),x=n(113),C=n(605),R=n(43),D=n.n(R),N=n(431),V=n.n(N),F=n(430),q=n.n(F),B=n(196),I=n(197),L=n(677),z=n(435),U=n.n(z),W=n(429),Q=n.n(W),G=function(){var e=Q()(),t=U()(e.getState().values,"application.application_type_id",""),n=Object(l.useState)(t),a=i()(n,2),r=a[0],o=a[1];return Object(l.useEffect)((function(){r!==t&&(e.batch((function(){e.change("authentication",void 0),e.change("selectedAuthentication",void 0)})),o(void 0))}),[t]),null},H=n(453),J=function(){var e=Object(g.a)(),t=Object(h.useSelector)((function(e){return e.sources.sourceTypes})),n=Object(H.a)(),a=t.find((function(e){return e.id===n.source_type_id})),i=n.applications.filter((function(e){return!e.isDeleting})),r=n.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(D()(e),[t.application_type_id])}),[]),o=i.filter((function(e){var t=e.id;return!r.includes(t)})).length>0?d.a.createElement(d.a.Fragment,null,d.a.createElement(B.Text,{component:B.TextVariants.h4,id:"add-application-header"},e.formatMessage({id:"sources.apps",defaultMessage:"Applications"})),d.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-description"},e.formatMessage({id:"sources.addAppMultipleAppDesc",defaultMessage:"Select a radio button to add an application. Click trash icon to remove an application."}))):d.a.createElement(d.a.Fragment,null,d.a.createElement(B.Text,{component:B.TextVariants.h4,id:"add-application-header"},e.formatMessage({id:"sources.addApp",defaultMessage:"Add an application"})),d.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-description"},e.formatMessage({id:"sources.addAppNoAppsDesc",defaultMessage:"There are currently no applications connected to this source. Select from available applications below."})));return d.a.createElement(d.a.Fragment,null,d.a.createElement(I.TextContent,null,d.a.createElement(B.Text,{component:B.TextVariants.h4},e.formatMessage({id:"sources.type",defaultMessage:"Source type"})),d.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-desc-type"},a?a.product_name:e.formatMessage({id:"sources.typeNotFound",defaultMessage:"Type not found"})),o))},Y=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:V.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:q.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,r=n.authtype;if(r)return a.find((function(e){return e.authtype===r}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(r)}}},K=n(2),Z=n.n(K);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){Z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ee=function(e,t,n,a,i){var r=D()(n);L.shouldUseAppAuth(e.name,a,t.name)&&(r=[]);var o,c=e.schema.authentication.find((function(e){return e.type===a})),s="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),u=L.shouldSkipEndpoint(e.name,a,t.name),p=L.hasCustomSteps(e.name,a,t.name);o=L.getAdditionalSteps(e.name,a,t.name).length>0?s:0!==n.length||u?"summary":"".concat(e.name,"-endpoint");var l=L.getAdditionalStepKeys(e.name,a,t.name),d={};if(L.shouldSkipSelection(e.name,a,t.name)){var f=L.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),m=L.getAdditionalStepFields(c.fields,s);o=f.nextStep?f.nextStep:0!==n.length||u||p?"summary":"".concat(e.name,"-endpoint"),d=X(X({},f),{},{fields:[].concat(D()(r),D()(L.injectAuthFieldsInfo([].concat(D()(f.fields),D()(m)),e.name,a,t.name)))})}return X({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:i.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(D()(r),D()(L.getAdditionalAuthFields(e.name,a,t.name)),D()(L.injectAuthFieldsInfo(L.getNoStepsFields(c.fields,l),e.name,a,t.name))),nextStep:o},d)},te=n(9),ne=n.n(te),ae=function(e){var t=e.authenticationValues,n=Q()(),a=n.getState().values.selectedAuthentication,r=Object(l.useState)(a),o=i()(r,2),c=o[0],s=o[1];return Object(l.useEffect)((function(){c!==a&&(!function(e){var t=e.formOptions,n=e.authenticationValues,a=e.selectedAuthentication;if(a.startsWith("new-")){var i=a.replace("new-","");t.change("authentication",{authtype:i})}else{var r=n.find((function(e){return e.id===a}));t.change("authentication",r)}}({formOptions:n,authenticationValues:t,selectedAuthentication:a}),s(void 0))}),[a]),null};ae.propTypes={authenticationValues:ne.a.arrayOf(ne.a.object)};var ie=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName,a=Object(g.a)();return d.a.createElement(I.TextContent,null,d.a.createElement(B.Text,{component:B.TextVariants.p},a.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:n})))};ie.propTypes={applicationTypeName:ne.a.string,authenticationTypeName:ne.a.string};var re=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,r=e.supportedAuthType;return n.filter((function(e){return e.authtype===r})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),r=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",o=e.username?"-".concat(e.username):"",c=r?"-".concat(r.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(o).concat(c),value:e.id}}))},oe=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,i=e.sourceType,r=e.applicationTypes,o=[{component:"description",name:"authtypesetter",Content:ae,authenticationValues:a,hideField:!0}];return r.forEach((function(e){var c,s=e.supported_source_types.includes(i.name),u=!(null===(c=n.applications)||void 0===c?void 0:c.find((function(t){return t.application_type_id===e.id})));if(s&&u){var p=U()(e,"supported_authentication_types[".concat(i.name,"]"),[]);p.forEach((function(c){if(a.find((function(e){return e.authtype===c}))){var s=U()(i,"schema.authentication",{}).find((function(e){return e.type===c})).name;o.push({component:V.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(D()(p.length>1?[{when:"authtype",is:c}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:ie,applicationTypeName:e.display_name,authenticationTypeName:s},{component:V.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:q.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:s}),value:"new-".concat(c)}].concat(D()(re({authenticationValues:a,source:n,applicationTypes:r,supportedAuthTypeName:s,supportedAuthType:c})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:o,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,r=t.authentication,o=n||{},c=o.application_type_id?o.application_type_id:"";return"".concat(i.name,"-").concat(c,"-").concat(a||(null==r?void 0:r.authtype))}}},ce=function(){var e=Object(g.a)();return d.a.createElement(I.TextContent,null,d.a.createElement(B.Text,{component:B.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===U()(t,"supported_authentication_types.".concat(n,"[0]"))}))},ue=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=e.length>0,s=c?"summary":void 0,u=[],p=n.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&c){var l=p.schema.endpoint.hidden?p.schema.endpoint.fields:[],d=0===l.length;a.forEach((function(e){e.supported_source_types.includes(p.name)&&e.supported_authentication_types[p.name].forEach((function(n){u.push(ee(p,e,l,n,t))}))})),p.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(p.name)){var n=L.getAdditionalSteps(p.name,e.type,t.name);n.length>0&&u.push.apply(u,D()(L.createAdditionalSteps(n,p.name,e.type,d,e.fields,t.name)))}}))})),d&&u.push(L.createEndpointStep(p.schema.endpoint,p.name)),s=function(e){var t=e.values.application;if(t){var n,r=a.find((function(e){return e.id===t.application_type_id}));if((null==r||null===(n=r.supported_authentication_types[p.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(se(i,a.find((function(e){return e.id===t.application_type_id})),p.name))return"selectAuthentication";var o=null==r?void 0:r.supported_authentication_types[p.name][0];return"".concat(p.name,"-").concat(t&&t.application_type_id,"-").concat(o)}}}var f={component:"application-select",name:"application.application_type_id",options:e,container:o,validate:[{type:q.a.REQUIRED}]},m=a.filter((function(e){return ue(e,p)})).map((function(e){return Y(p,e,t,i)}));return!r.imported&&c&&m.push(oe({intl:t,source:r,authenticationValues:i,sourceType:p,applicationTypes:a})),{fields:[{component:V.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:o,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"Add or remove applications from {name}."},{name:r.name}),buttonLabels:{submit:t.formatMessage({id:"sources.add",defaultMessage:"Add"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:s,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Add / remove applications"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:J,container:o},f,{component:"description",name:"authtypesetter",Content:G,hideField:!0}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:ce},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(D()(m),u)}]}},le=n(678),de=function(e){var t=e.step,n=e.goToSources,a=e.name,i=Object(g.a)();return d.a.createElement(le.Wizard,{isOpen:!0,onClose:n,title:i.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:i.formatMessage({id:"sources.addAppDescription",defaultMessage:"Add or remove applications from {name}."},{name:a}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};de.propTypes={step:te.PropTypes.node.isRequired,goToSources:te.PropTypes.func.isRequired,name:te.PropTypes.string};var fe=de,me=n(26),he=n(505),ge=n(481),ve=n(114),ye=n(86),be=n.n(ye),Oe=n(242),je=n.n(Oe),_e=n(881),Ee=n(545),Ae=n(500),Me=n(544),Te=n(436),we=n(682),Se=n.n(we),ke=n(892),Pe=n.n(ke),xe=n(919),Ce=n.n(xe),Re=n(606);function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){Z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===je()(t[n])?Se()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},Fe=function(){var e=p()(s.a.mark((function e(t,n,a,r){var o,c,u,p,l,d,f,m,h,g,v,y,b,O,j,_,E,A,M,T,w,S,k,P,x,C,R,D,N,V,F,q,B,I,L,z,U,W,Q,G,H,J,Y,K=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=K.length>4&&void 0!==K[4]?K[4]:[],u=n.getState(),p=u.values,l=p.authentication?p.authentication.id:void 0,d=l?a.find((function(e){return e.id===l})):void 0,f=t.authentication,m=be()(t,["authentication"]),h=Object(_e.addedDiff)(r,m),g=Object(_e.updatedDiff)(r,m),v=Object(_e.addedDiff)(d,f),y=Object(_e.updatedDiff)(d,f),b=Ve(Ne(Ne({},Pe()(Ce()(h),g)),{},{authentication:Ne({},Pe()(Ce()(v),y))})),e.prev=11,null==p||null===(O=p.source)||void 0===O?void 0:O.id){e.next=14;break}throw"Missing source id";case 14:return A=p.source.id,M=null==p||null===(j=p.endpoint)||void 0===j?void 0:j.id,T=[],b.source&&!Se()(b.source)?T.push(Object(me.k)().updateSource(A,b.source)):T.push(Promise.resolve(void 0)),w=b.endpoint&&!Se()(b.endpoint),S=b.url&&!Se()(b.url),w||S?(k=Object(Re.b)(b),P=k.scheme,x=k.host,C=k.port,R=k.path,D=parseInt(C,10),N=Ve(Ne(Ne({},b.endpoint),{},{scheme:P,host:x,port:isNaN(D)?void 0:D,path:R})),M?T.push(Object(me.k)().updateEndpoint(M,N)):(V=Ne(Ne({},N),{},{default:!0,source_id:A}),T.push(Object(me.k)().createEndpoint(V)))):T.push(Promise.resolve(void 0)),(null===(_=b.application)||void 0===_?void 0:_.application_type_id)?T.push(Object(me.b)(A,b.application.application_type_id)):T.push(Promise.resolve(void 0)),e.next=24,Promise.all(T);case 24:if(F=e.sent,q=i()(F,3),q[0],B=q[1],I=q[2],!b.authentication||Se()(b.authentication)){e.next=40;break}if(!l){e.next=36;break}return e.next=33,Object(me.k)().updateAuthentication(l,b.authentication);case 33:L=e.sent,e.next=40;break;case 36:return z=Ne(Ne({},b.authentication),{},{resource_id:(null==B?void 0:B.id)||(null==I?void 0:I.id),resource_type:(null==B?void 0:B.id)?"Endpoint":"Application"}),e.next=39,Object(me.k)().createAuthentication(z);case 39:L=e.sent;case 40:return c=null==I?void 0:I.id,U=l||(null===(E=L)||void 0===E?void 0:E.id),W=[],(null==I?void 0:I.id)&&U&&(Q={application_id:I.id,authentication_id:U},W.push(Object(me.k)().createAuthApp(Q))),(b.credentials||b.billing_source)&&(G=b.credentials,H=b.billing_source,J={},J=G?{authentication:{credentials:G}}:{},J=H?Ne(Ne({},J),{},{billing_source:H}):J,W.push(Object(Ee.patchSource)(Ne({id:A},J)))),e.next=48,Promise.all(W);case 48:if(!I){e.next=53;break}return Y=Object(Te.timeoutedApps)(o).includes(I.application_type_id)?1e4:0,e.next=52,Object(Me.checkAppAvailability)(I.id,Y);case 52:return e.abrupt("return",e.sent);case 53:return e.abrupt("return",{});case 56:if(e.prev=56,e.t0=e.catch(11),console.error(e.t0),!c){e.next=62;break}return e.next=62,Object(me.k)().deleteApplication(c);case 62:return e.next=64,Object(Ae.handleError)(e.t0);case 64:throw e.sent;case 66:case"end":return e.stop()}}),e,null,[[11,56]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),qe=n(568);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){Z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Le={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},ze=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,r=t.initialValues,o=t.error,c=t.values,s=t.data,u=t.formApi;switch(n){case"setSourceAppslength":return Ie(Ie({},e),{},{sourceAppsLength:a});case"loadAuthentications":return Ie(Ie({},e),{},{authenticationsValues:i,initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return Ie(Ie({},e),{},{initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return Ie(Ie({},e),{},{state:"wizard"});case"submit":return Ie(Ie({},e),{},{values:c,formApi:u,state:"submitting"});case"finish":return Ie(Ie({},e),{},{state:"finished",data:s});case"error":return Ie(Ie({},e),{},{state:"errored",error:o});case"toggleCancelling":return Ie(Ie({},e),{},{isCancelling:!e.isCancelling},c&&{values:c});default:return e}},Ue=n(112),We=n(938),Qe=n(542),Ge=void 0,He=function(e){var t=e.values.application;return Ge=t},Je=function(e,t,n,a,i,r,o){return i({type:"submit",values:e,formApi:t}),Fe(e,t,n,r,o).then(function(){var e=p()(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(qe.a)(r.source.id),e.next=3,a(Object(x.f)());case 3:return Ge=void 0,e.abrupt("return",i({type:"finish",data:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i({type:"error",error:e})}))},Ye=function(e){return d.a.createElement(P.a,o()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(g.a)(),t=Object(f.k)(),n=Object(he.a)(),a=Object(h.useSelector)((function(e){return e.sources}),h.shallowEqual),r=a.appTypes,o=a.sourceTypesLoaded,c=a.appTypesLoaded,s=a.sourceTypes,u=Object(H.a)(),p=Object(h.useDispatch)(),v=Object(l.useReducer)(ze,Le),b=i()(v,2),j=b[0],E=b[1],M=Object(l.useRef)(document.createElement("div"));Object(l.useEffect)((function(){Ge=void 0}),[]),Object(l.useEffect)((function(){if(u){var e=j.sourceAppsLength>=u.applications.length&&j.sourceAppsLength>0;E({type:"setSourceAppslength",length:u.applications.length}),e||(u.endpoints&&u.endpoints[0]?Object(me.k)().listEndpointAuthentications(u.endpoints[0].id).then((function(e){var t=e.data;return E({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:u,endpoint:u.endpoints[0],url:Object(ge.c)(u.endpoints[0]),application:Ge},values:{}})})):E({type:"loadWithoutAuthentications",initialValues:{source:u,application:Ge},values:{}}))}}),[u]);var w=function(){return t.push(ve.c.sources.path)};if(!(c&&o&&n&&"loading"!==j.state||"submitting"===j.state))return d.a.createElement(fe,{goToSources:w,step:d.a.createElement(_.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w})});var k=function(e,t){return Je(e,t,j.authenticationsValues,p,E,j.initialValues,r)};if("submitting"===j.state)return d.a.createElement(fe,{name:u.name,goToSources:w,step:d.a.createElement(_.a,{cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w,customText:e.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var P=function(){return E({type:"reset"})};if("wizard"!==j.state){var x;if("finished"!==j.state)x=d.a.createElement(A.a,{onRetry:P,onClose:w,returnButtonTitle:e.formatMessage({id:"sources.retry",defaultMessage:"Retry"}),primaryAction:function(){return k(j.values,j.formApi)},secondaryActions:d.a.createElement(We.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},e.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"}))});else switch(j.data.availability_status){case"available":x=d.a.createElement(T.a,{title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),hideSourcesButton:!0,onReset:P,onClose:w,secondaryActions:d.a.createElement(Ue.Button,{variant:"link",onClick:P},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:e.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application was successfully added."})});break;case"unavailable":x=d.a.createElement(A.a,{onRetry:P,onClose:w,message:j.data.availability_status_error||e.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),secondaryActions:d.a.createElement(Ue.Button,{variant:"link",onClick:function(){var t,n;return E({type:"reset"}),Object(Qe.a)({id:null===(t=j.data)||void 0===t?void 0:t.id,display_name:null===(n=r.find((function(e){var t;return e.id===(null===(t=j.data)||void 0===t?void 0:t.application_type_id)})))||void 0===n?void 0:n.display_name},e,void 0,p,u)}},e.formatMessage({id:"wizard.removeApp",defaultMessage:"Remove application"})),Component:function(){return d.a.createElement(m.Link,{to:Object(ve.b)(ve.c.sourcesEdit.path,u.id)},d.a.createElement(Ue.Button,{variant:"primary",className:"pf-u-mt-xl"},e.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))}});break;default:x=d.a.createElement(S.a,{returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),onClose:w,secondaryActions:d.a.createElement(Ue.Button,{variant:"link",onClick:P},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"}))})}return d.a.createElement(fe,{name:u.name,goToSources:w,step:x})}var R=s.find((function(e){return e.id===u.source_type_id})),D=R&&R.name,N=r.filter((function(e){return e.supported_source_types.includes(D)})).filter(y.a).map((function(e){return{value:e.id,label:e.display_name}})),V=pe(N,e,s,r,j.authenticationsValues,u,M.current),F=N.length>0?k:w;return d.a.createElement(d.a.Fragment,null,d.a.createElement(O.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:j.isCancelling,onStay:function(){M.current.hidden=!1,E({type:"toggleCancelling"})},onExit:w}),d.a.createElement(C.a,{schema:V,showFormControls:!1,onSubmit:F,onCancel:function(e){(null==e?void 0:e.application)?(M.current.hidden=!0,E({type:"toggleCancelling",values:e})):w()},initialValues:j.initialValues,subscription:{values:!0},debug:He,clearedValue:null,FormTemplate:Ye}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map