(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{350:function(e,t,n){"use strict";var a=n(0),i=Object(a.createContext)();t.a=i},371:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(89),i=n.n(a),r=n(0),o=n.n(r),s=n(11),c=n.n(s),u=n(319),p=n.n(u),l=n(435),d=n.n(l),m=n(45),f=n(321),h=n(350),g=n(316),y=n.n(g),v="edit-field",b=function(e){var t=e.isRequired,n=e.label,a=e.helperText,s=e.hideLabel,c=e.name,u=e.type,l=e.isEditable,g=y()(),v=g.getFieldState,b=g.getState,O=Object(r.useContext)(h.a).setState,E=v(c)||{value:p()(b().initialValues,c)},T=E.error,_=E.touched,j=E.value,S=_&&T,M="password"===u||c.includes("password")?"Click to edit":"Click to add";return o.a.createElement(f.FormGroup,i()({isRequired:t,label:!s&&n,fieldId:c,validated:S?"error":"default",helperText:a,helperTextInvalid:T,tabIndex:0,onKeyPress:function(e){32===e.charCode&&l&&(e.preventDefault(),O({type:"setEdit",name:c}))}},l&&{onClick:function(){return O({type:"setEdit",name:c})}}),o.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(l?"clickable":"")},o.a.createElement(m.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(l?"clickable":"")},o.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},j||(l?M:"")),l&&o.a.createElement(d.a,null))))};b.propTypes={label:c.a.node,isRequired:c.a.bool,helperText:c.a.node,hideLabel:c.a.bool,isEditable:c.a.bool,type:c.a.string,name:c.a.string},t.b=b},488:function(e,t,n){"use strict";var a=n(89),i=n.n(a),r=n(2),o=n.n(r),s=n(0),c=n.n(s),u=n(366),p=n.n(u),l=n(315),d=n.n(l),m=n(317),f=n.n(m),h=n(353),g=n.n(h),y=n(345),v=n.n(y),b=n(368),O=n.n(b),E=n(461),T=n(66),_=n.n(T),j=n(11),S=n.n(j),M=n(380),A=n.n(M),x=n(350),w=n(371),C=[d.a.CHECKBOX,d.a.SWITCH],P=function(e){var t=e.originalComponent,n=e.isEditable,a=void 0===n||n,r=_()(e,["originalComponent","isEditable"]),o=w.b,u={},p=Object(s.useContext)(A.a).componentMapper;return Object(s.useContext)(x.a).editing[r.name]||C.includes(t)?o=p[t]:a&&(u={isEditable:!0}),c.a.createElement(o,i()({},r,u))};P.propTypes={originalComponent:S.a.string,name:S.a.string,isEditable:S.a.bool};var V=P;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return c.a.createElement(p.a,i()({FormTemplate:v.a,componentMapper:D(D(D({},O.a),E.mapperExtension),{},{"edit-field":V,"switch-field":O.a[d.a.SWITCH]}),validatorMapper:{"required-validator":g.a[f.a.REQUIRED],"pattern-validator":g.a[f.a.PATTERN],"min-length-validator":g.a[f.a.MIN_LENGTH],"url-validator":g.a[f.a.URL]}},e))}},757:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return rt}));var a=n(28),i=n.n(a),r=n(40),o=n.n(r),s=n(89),c=n.n(s),u=n(73),p=n.n(u),l=n(104),d=n.n(l),m=n(0),f=n.n(m),h=n(13),g=n(31),y=n(184),v=n(15),b=n(474),O=n.n(b),E=n(481),T=n.n(E),_=n(543),j=n.n(_),S=n(544),M=n.n(S),A=n(545),x=n.n(A),w=n(546),C=n.n(w),P=n(547),V=n.n(P),k=n(345),D=n.n(k),R=n(86),N=n(488),I=n(315),F=n.n(I),q=n(317),B=n.n(q),L=n(29),G=n(45),z=n(548),U=n(319),W=n.n(U),Q=n(11),Y=n.n(Q),H=n(316),K=n.n(H),J=function(e){var t=e.modifiedValues,n=K()(),a=W()(n.getState().values,"application.application_type_id",""),i=Object(m.useState)(a),r=o()(i,2),s=r[0],c=r[1];return Object(m.useEffect)((function(){if(s!==a){var e=t&&t.authentication?t.authentication:void 0;n.batch((function(){n.change("authentication",e),n.change("selectedAuthentication",void 0)})),c(void 0)}}),[a]),null};J.propTypes={modifiedValues:Y.a.object};var X=n(417),Z=n(84),$=n(375),ee=n(85),te=n(65),ne=n.n(te),ae=n(351),ie=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(y.a)(),r=Object(g.useSelector)((function(e){return e.sources.appTypes})),o=Object(ae.a)(),s=Object(g.useDispatch)();Object(m.useEffect)((function(){a&&(a.hidden=!0)}),[]);var c=t.dependent_applications.map((function(e){var n=r.find((function(t){return t.name===e}));return n&&t.sourceAppsNames.includes(n.display_name)?n.display_name:void 0})).filter((function(e){return e}));return f.a.createElement($.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:f.a.createElement(ee.Title,{headingLevel:"h1",size:"2xl"},f.a.createElement(ne.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[f.a.createElement(Z.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){var e=i.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:t.display_name}),a=i.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:t.display_name});return n(),s(Object(R.i)(t.id,o.id,e,a))}},f.a.createElement(v.a,{id:"sources.remove",defaultMessage:"Remove application"})),f.a.createElement(Z.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},f.a.createElement(v.a,{id:"sources.cancel",defaultMessage:"Cancel"}))]},f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?",values:{appName:f.a.createElement("b",null,t.display_name)}})),c.length>0&&f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }.",values:{apps:c}}))))};ie.propTypes={app:Y.a.shape({id:Y.a.string.isRequired,display_name:Y.a.string.isRequired,dependent_applications:Y.a.arrayOf(Y.a.string),sourceAppsNames:Y.a.arrayOf(Y.a.string)}).isRequired,onCancel:Y.a.func.isRequired,container:Y.a.instanceOf(Element)};var re=ie,oe=n(323),se=n(324),ce=function(e){var t=e.setApplicationToRemove,n=e.breakpoints,a=e.namePrefix,i=Object(g.useSelector)((function(e){return e.sources.appTypes})),r=Object(ae.a)(),o=r.applications.map((function(e){var t=e.application_type_id,n=i.find((function(e){return e.id===t}));return n?n.display_name:void 0}));return r.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=i.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var i=e.display_name,r=e.id,s=e.dependent_applications;return f.a.createElement(G.TextContent,{key:r},f.a.createElement(oe.Grid,null,f.a.createElement(se.GridItem,{md:n.display_name||4},f.a.createElement(L.Text,{component:L.TextVariants.p,style:{marginBottom:0}},a,i)),f.a.createElement(se.GridItem,{md:n.remove||8,className:"ins-c-sources__remove-app"},f.a.createElement(Z.Button,{variant:Z.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:r,display_name:i,dependent_applications:s,sourceAppsNames:o})}},f.a.createElement(v.a,{id:"sources.remove",defaultMessage:"Remove"})))))}))};ce.propTypes={setApplicationToRemove:Y.a.func.isRequired,breakpoints:Y.a.shape({display_name:Y.a.number,remove:Y.a.number}),namePrefix:Y.a.node},ce.defaultProps={breakpoints:{}};var ue=ce,pe=function(e){var t=e.container,n=Object(m.useState)({}),a=o()(n,2),i=a[0],r=a[1],s=Object(g.useSelector)((function(e){return e.sources.sourceTypes})),c=Object(ae.a)(),u=s.find((function(e){return e.id===c.source_type_id})),p=c.applications.filter((function(e){return!e.isDeleting}));return f.a.createElement(f.a.Fragment,null,i.id&&f.a.createElement(re,{app:i,onCancel:function(){return t&&(t.hidden=!1),r({})},container:t}),f.a.createElement(G.TextContent,null,f.a.createElement(X.Grid,{hasGutter:!0},f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.h4},f.a.createElement(v.a,{id:"sources.sourceName",defaultMessage:"Source name"}))),f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.h4},f.a.createElement(v.a,{id:"sources.type",defaultMessage:"Type"}))),f.a.createElement(X.GridItem,{md:8},f.a.createElement(L.Text,{component:L.TextVariants.h4},f.a.createElement(v.a,{id:"sources.apps",defaultMessage:"Applications"}))),f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.p},c.name)),f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.p},u?u.product_name:f.a.createElement(v.a,{id:"sources.typeNotFound",defaultMessage:"Type not found"}))),f.a.createElement(X.GridItem,{md:8},p.length>0?f.a.createElement(ue,{setApplicationToRemove:r}):f.a.createElement(v.a,{id:"sources.noApps",defaultMessage:"No applications"})))))};pe.propTypes={container:Y.a.instanceOf(Element)};var le=pe,de=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:F.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:B.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,r=n.authtype;if(r)return a.find((function(e){return e.authtype===r}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(r)}}},me=n(2),fe=n.n(me);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=function(e,t,n,a,r){var o,s=i()(n),c=e.schema.authentication.find((function(e){return e.type===a})),u="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),p=z.shouldSkipEndpoint(e.name,a,t.name),l=z.hasCustomSteps(e.name,a,t.name);o=z.getAdditionalSteps(e.name,a,t.name).length>0?u:0!==n.length||p?"summary":"".concat(e.name,"-endpoint");var d=z.getAdditionalStepKeys(e.name,a,t.name),m={};if(z.shouldSkipSelection(e.name,a,t.name)){var f=z.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),h=z.getAdditionalStepFields(c.fields,u);o=f.nextStep?f.nextStep:0!==n.length||p||l?"summary":"".concat(e.name,"-endpoint"),m=ge(ge({},f),{},{fields:[].concat(i()(s),i()(z.injectAuthFieldsInfo([].concat(i()(f.fields),i()(h)),e.name,a,t.name)))})}return ge({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:r.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(i()(s),i()(z.getAdditionalAuthFields(e.name,a,t.name)),i()(z.injectAuthFieldsInfo(z.getNoStepsFields(c.fields,d),e.name,a,t.name))),nextStep:o},m)};function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oe=function(e){var t=e.authenticationValues,n=e.modifiedValues,a=K()(),i=a.getState().values.selectedAuthentication,r=Object(m.useState)(i),s=o()(r,2),c=s[0],u=s[1];return Object(m.useEffect)((function(){c!==i&&(!function(e){var t=e.formOptions,n=e.modifiedValues,a=e.authenticationValues,i=e.selectedAuthentication;if(i.startsWith("new-")){var r=i.replace("new-","");n&&n.authentication?t.change("authentication",be(be({},n.authentication),{},{authtype:r})):t.change("authentication",{authtype:r})}else{var o=a.find((function(e){return e.id===i}));if(n&&n.authentication){var s=O()(T()(o),n.authentication);t.change("authentication",s)}else t.change("authentication",o)}}({formOptions:a,authenticationValues:t,modifiedValues:n,selectedAuthentication:i}),u(void 0))}),[i]),null};Oe.propTypes={authenticationValues:Y.a.arrayOf(Y.a.object),modifiedValues:Y.a.object};var Ee=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName;return f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new.",values:{applicationTypeName:t,authenticationTypeName:n}})))};Ee.propTypes={applicationTypeName:Y.a.string,authenticationTypeName:Y.a.string};var Te=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,r=e.supportedAuthType;return n.filter((function(e){return e.authtype===r})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),r=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",o=e.username?"-".concat(e.username):"",s=r?"-".concat(r.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(o).concat(s),value:e.id}}))},_e=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,r=e.sourceType,o=e.applicationTypes,s=e.modifiedValues,c=[{component:"description",name:"authtypesetter",Content:Oe,authenticationValues:a,hideField:!0,modifiedValues:s}];return o.forEach((function(e){var s,u=e.supported_source_types.includes(r.name),p=!(null===(s=n.applications)||void 0===s?void 0:s.find((function(t){return t.application_type_id===e.id})));if(u&&p){var l=W()(e,"supported_authentication_types[".concat(r.name,"]"),[]);l.forEach((function(s){if(a.find((function(e){return e.authtype===s}))){var u=W()(r,"schema.authentication",{}).find((function(e){return e.type===s})).name;c.push({component:F.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(i()(l.length>1?[{when:"authtype",is:s}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:Ee,applicationTypeName:e.display_name,authenticationTypeName:u},{component:F.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:B.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new-".concat(s)}].concat(i()(Te({authenticationValues:a,source:n,applicationTypes:o,supportedAuthTypeName:u,supportedAuthType:s})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:c,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,i=t.authentication,o=n||{},s=o.application_type_id?o.application_type_id:"";return"".concat(r.name,"-").concat(s,"-").concat(a||(null==i?void 0:i.authtype))}}},je=function(){return f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source."})))},Se=function(){return f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===W()(t,"supported_authentication_types.".concat(n,"[0]"))}))},Ae=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,u=e.length>0,p=u?"summary":void 0,l=[],d=n.find((function(e){return e.id===o.source_type_id}));if(!o.imported&&u){var m=d.schema.endpoint.hidden?d.schema.endpoint.fields:[],f=0===m.length;a.forEach((function(e){e.supported_source_types.includes(d.name)&&e.supported_authentication_types[d.name].forEach((function(n){l.push(ye(d,e,m,n,t))}))})),d.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(d.name)){var n=z.getAdditionalSteps(d.name,e.type,t.name);n.length>0&&l.push.apply(l,i()(z.createAdditionalSteps(n,d.name,e.type,f,e.fields,t.name)))}}))})),f&&l.push(z.createEndpointStep(d.schema.endpoint,d.name)),p=function(e){var t=e.values.application;if(t){var n,i=a.find((function(e){return e.id===t.application_type_id}));if((null==i||null===(n=i.supported_authentication_types[d.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(Me(r,a.find((function(e){return e.id===t.application_type_id})),d.name))return"selectAuthentication";var o=null==i?void 0:i.supported_authentication_types[d.name][0];return"".concat(d.name,"-").concat(t&&t.application_type_id,"-").concat(o)}}}var h=u?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:B.a.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:B.a.REQUIRED}],Content:je},g=a.filter((function(e){return Ae(e,d)})).map((function(e){return de(d,e,t,r)}));return!o.imported&&u&&g.push(_e({intl:t,source:o,authenticationValues:r,sourceType:d,applicationTypes:a,modifiedValues:s})),{fields:[{component:F.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:c,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:u?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:p,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:le,container:c},h,{component:"description",name:"authtypesetter",Content:J,hideField:!0,modifiedValues:s}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:Se},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(i()(g),l)}]}},we=n(549),Ce=function(e){var t=e.step,n=e.goToSources,a=Object(y.a)();return f.a.createElement(we.Wizard,{isOpen:!0,onClose:n,title:a.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:a.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};Ce.propTypes={step:Q.PropTypes.node.isRequired,goToSources:Q.PropTypes.func.isRequired};var Pe=Ce,Ve=n(17),ke=n(377),De=n(97),Re=n(87),Ne=n(66),Ie=n.n(Ne),Fe=n(185),qe=n.n(Fe),Be=n(748),Le=n(485),Ge=n(374),ze=n(486),Ue=n.n(ze),We=n(135),Qe=function(e,t,n){var a=[],i=0;return!e.endpoint||Ue()(e.endpoint)||W()(t,"endpoint.id",!1)||a.push(n.formatMessage({id:"sources.authProgressEndpoint",defaultMessage:"Step { step }: creating endpoint"},{step:++i})),a.push(n.formatMessage({id:"sources.authProgressValues",defaultMessage:"Step { step }: updating values and creating application"},{step:++i})),a.push(n.formatMessage({id:"sources.authConnectingApplication",defaultMessage:"Step { step }: connecting application and authentication"},{step:++i})),a.push(n.formatMessage({id:"sources.authReloadData",defaultMessage:"Step { step }: reloading data"},{step:++i})),a.push(n.formatMessage({id:"sources.authCompleted",defaultMessage:"Completed"})),a};function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ke=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===qe()(t[n])?Ue()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},Je=function(){var e=d()(p.a.mark((function e(t,n,a,i){var r,s,c,u,l,d,m,f,h,g,y,v,b,E,_,j,S,M,A,x,w,C,P,V,k,D,R,N,I,F,q,B,L,G,z,U,W,Q,Y=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Y.length>4&&void 0!==Y[4]?Y[4]:function(){},s=Y.length>5&&void 0!==Y[5]?Y[5]:function(){},c=n.getState(),u=c.values,l=u.authentication?u.authentication.id:void 0,d=l?a.find((function(e){return e.id===l})):void 0,m=t.authentication,f=Ie()(t,["authentication"]),h=Object(Be.addedDiff)(i,f),g=Object(Be.updatedDiff)(i,f),y=Object(Be.addedDiff)(d,m),v=Object(Be.updatedDiff)(d,m),b=Ke(He(He({},O()(T()(h),g)),{},{authentication:He({},O()(T()(y),v))})),r({type:"setProgressTexts",progressTexts:Qe(b,u,s)}),e.prev=13,u.source&&u.source.id){e.next=16;break}throw"Missing source id";case 16:if(E=u.source.id,_=u.endpoint?u.endpoint.id:void 0,j=[],b.source&&!Ue()(b.source)?j.push(Object(Ve.j)().updateSource(E,b.source)):j.push(Promise.resolve(void 0)),S=b.endpoint&&!Ue()(b.endpoint),M=b.url&&!Ue()(b.url),!S&&!M){e.next=39;break}if(A=Object(We.b)(b),x=A.scheme,w=A.host,C=A.port,P=A.path,V=parseInt(C,10),k=Ke(He(He({},b.endpoint),{},{scheme:x,host:w,port:isNaN(V)?void 0:V,path:P})),!_){e.next=30;break}j.push(Object(Ve.j)().updateEndpoint(_,k)),e.next=37;break;case 30:return j.push(Promise.resolve(void 0)),D=He(He({},k),{},{default:!0,source_id:E}),e.next=34,Object(Ve.j)().createEndpoint(D);case 34:R=e.sent,r({type:"increaseProgressStep"}),_=R.id;case 37:e.next=40;break;case 39:j.push(Promise.resolve(void 0));case 40:return b.authentication&&!Ue()(b.authentication)?l?j.push(Object(Ve.j)().updateAuthentication(l,b.authentication)):_&&(N=He(He({},b.authentication),{},{resource_id:_,resource_type:"Endpoint"}),j.push(Object(Ve.j)().createAuthentication(N))):j.push(Promise.resolve(void 0)),b.application&&b.application.application_type_id?j.push(Object(Ve.b)(E,b.application.application_type_id)):j.push(Promise.resolve(void 0)),e.next=44,Promise.all(j);case 44:return I=e.sent,F=o()(I,4),F[0],F[1],q=F[2],B=F[3],r({type:"increaseProgressStep"}),L=l||(q?q.id:void 0),G=[],B&&B.id&&L&&(z={application_id:B.id,authentication_id:L},G.push(Object(Ve.j)().createAuthApp(z))),(b.credentials||b.billing_source)&&(U=b.credentials,W=b.billing_source,Q={},Q=U?{authentication:{credentials:U}}:{},Q=W?He(He({},Q),{},{billing_source:W}):Q,G.push(Object(Le.patchSource)(He({id:E},Q)))),e.next=58,Promise.all(G);case 58:r({type:"increaseProgressStep"}),e.next=67;break;case 61:return e.prev=61,e.t0=e.catch(13),e.next=65,Object(Ge.handleError)(e.t0);case 65:throw e.sent;case 67:case"end":return e.stop()}}),e,null,[[13,61]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),Xe=n(444);function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var et={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},progressStep:0,progressTexts:[],isCancelling:!1},tt=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,r=t.initialValues,o=t.error,s=t.values,c=t.progressTexts;switch(n){case"setSourceAppslength":return $e($e({},e),{},{sourceAppsLength:a});case"loadAuthentications":return $e($e({},e),{},{authenticationsValues:i,initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return $e($e({},e),{},{initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return $e($e({},e),{},{state:"wizard"});case"submit":return $e($e({},e),{},{state:"submitting",progressStep:0,progressTexts:["Preparing"]});case"finish":return $e($e({},e),{},{state:"finished",progressStep:++e.progressStep});case"error":return $e($e({},e),{},{state:"errored",error:o,values:s});case"setProgressTexts":return $e($e({},e),{},{progressTexts:c});case"increaseProgressStep":return $e($e({},e),{},{progressStep:++e.progressStep});case"toggleCancelling":return $e($e({},e),{},{isCancelling:!e.isCancelling},s&&{values:s});default:return e}},nt=n(61),at=void 0,it=function(e){var t=e.values.application;return at=t},rt=function(e,t,n,a,i,r,o){return i({type:"submit"}),Je(e,t,n,r,i,o).then(d()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Xe.a)(r.source.id),e.next=3,a(Object(R.f)());case 3:return at=void 0,e.abrupt("return",i({type:"finish"}));case 5:case"end":return e.stop()}}),e)})))).catch((function(t){return i({type:"error",error:t,values:e})}))},ot=function(e){return f.a.createElement(D.a,c()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(y.a)(),t=Object(h.f)(),n=Object(ke.a)(),a=Object(g.useSelector)((function(e){return e.sources}),g.shallowEqual),r=a.appTypes,s=a.sourceTypesLoaded,c=a.appTypesLoaded,u=a.sourceTypes,p=Object(ae.a)(),l=Object(g.useDispatch)(),d=Object(m.useReducer)(tt,et),b=o()(d,2),E=b[0],_=b[1],S=Object(m.useRef)(document.createElement("div"));Object(m.useEffect)((function(){at=void 0}),[]),Object(m.useEffect)((function(){if(p){var e=E.sourceAppsLength>=p.applications.length&&E.sourceAppsLength>0;_({type:"setSourceAppslength",length:p.applications.length}),e||(p.endpoints&&p.endpoints[0]?Object(Ve.j)().listEndpointAuthentications(p.endpoints[0].id).then((function(e){var t=e.data;return _({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:p,endpoint:p.endpoints[0],url:Object(De.b)(p.endpoints[0]),application:at},values:{}})})):_({type:"loadWithoutAuthentications",initialValues:{source:p,application:at},values:{}}))}}),[p]);var A=function(){return t.push(Re.c.sources.path)};if(!(c&&s&&n&&"loading"!==E.state||"submitting"===E.state))return f.a.createElement(Pe,{goToSources:A,step:f.a.createElement(x.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:f.a.createElement(v.a,{id:"sources.cancel",defaultMessage:"Cancel"})})});if("submitting"===E.state)return f.a.createElement(Pe,{goToSources:A,step:f.a.createElement(x.a,{progressStep:E.progressStep,progressTexts:E.progressTexts,cancelTitle:f.a.createElement(v.a,{id:"sources.cancel",defaultMessage:"Cancel"})})});var w=function(){return _({type:"reset"})};if("wizard"!==E.state){var P="finished"===E.state?f.a.createElement(V.a,{title:f.a.createElement(v.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),onReset:w,onClose:A,progressStep:E.progressStep,progressTexts:E.progressTexts,hideSourcesButton:!0,secondaryActions:f.a.createElement(nt.Button,{variant:"link",onClick:w},f.a.createElement(v.a,{id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:f.a.createElement(v.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:f.a.createElement(v.a,{id:"sources.successAddApp",defaultMessage:"Your application has been successfully added."})}):f.a.createElement(C.a,{onRetry:w,onClose:A,message:E.error,progressStep:E.progressStep,progressTexts:E.progressTexts,customText:f.a.createElement(v.a,{id:"sources.successAddApp",defaultMessage:"Your application has not been successfully added:"}),title:f.a.createElement(v.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),returnButtonTitle:f.a.createElement(v.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"}),retryText:f.a.createElement(v.a,{id:"sources.retry",defaultMessage:"Retry"})});return f.a.createElement(Pe,{goToSources:A,step:P})}var k=p.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),D=u.find((function(e){return e.id===p.source_type_id})),R=D&&D.name,I=r.filter((function(e){return!k.includes(e.id)&&e.supported_source_types.includes(R)})).filter(j.a),F=I.map((function(t){var n=p.applications.find((function(e){return e.application_type_id===t.id})),a="".concat(t.display_name," ").concat(n?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:a,isDisabled:!!n}})),q=xe(F,e,u,r,E.authenticationsValues,p,E.values,S.current),B=I.length>0?function(t,n){return rt(t,n,E.authenticationsValues,l,_,E.initialValues,e)}:A,L=O()(T()(E.initialValues),E.values);return f.a.createElement(f.a.Fragment,null,f.a.createElement(M.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:E.isCancelling,onStay:function(){S.current.hidden=!1,_({type:"toggleCancelling"})},onExit:A}),f.a.createElement(N.a,{schema:q,showFormControls:!1,onSubmit:B,onCancel:function(e){(null==e?void 0:e.application)?(S.current.hidden=!0,_({type:"toggleCancelling",values:e})):A()},initialValues:L,subscription:{values:!0},debug:it,clearedValue:null,FormTemplate:ot}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map