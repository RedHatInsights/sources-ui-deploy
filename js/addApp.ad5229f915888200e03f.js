(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{511:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return l}));var a=n(2),i=n.n(a),r=n(388),o=n(22),s=n(11);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=function(e){return e.url||null===e.url?function(e){if(null===e)return{scheme:null,host:null,port:null,path:null};if(!e)return{};try{var t=new URL(e),n=t.protocol.replace(/:$/,"");return{scheme:n,host:t.hostname,port:""===t.port?Object(r.b)(n):t.port,path:t.pathname}}catch(e){return{}}}(e.url):e.endpoint?e.endpoint:e},l=function(e,t){var n,a,i=[];if(t.source&&i.push(Object(o.k)().updateSource(e.source.id,t.source)),t.endpoint||t.url||null===t.url){var r=p(t),c=r.scheme,l=r.host,d=r.port,f=r.path,m=null===d?null:parseInt(d,10),h=u({scheme:c,host:l,path:f,port:null===m?null:isNaN(m)?void 0:m},t.endpoint);i.push(Object(o.k)().updateEndpoint(e.endpoints[0].id,h))}if(t.authentications&&Object.keys(t.authentications).forEach((function(e){var n=e.replace("a","");i.push(Object(o.k)().updateAuthentication(n,t.authentications[e]))})),t.billing_source||t.credentials){var g={};t.credentials&&(g={authentication:{credentials:t.credentials}}),t.billing_source&&(g=u(u({},g),{},{billing_source:t.billing_source})),i.push((n=e.source.id,a=g,o.a.patch("".concat(s.a,"/sources/").concat(n,"/"),a)))}return Promise.all(i)}},512:function(e,t,n){"use strict";var a=n(91),i=n.n(a),r=n(2),o=n.n(r),s=n(0),c=n.n(s),u=n(395),p=n.n(u),l=n(340),d=n.n(l),f=n(339),m=n.n(f),h=n(385),g=n.n(h),y=n(379),v=n.n(y),b=n(400),O=n.n(b),j=n(493),_=n(38),E=n.n(_),M=n(344),T=n.n(M),A=n(342),w=n(362),S=n(490),k=n.n(S),x=n(338),P=n.n(x),C=n(403),D=n.n(C);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=function(e){var t,n,a=P()(),r=a.getState().values,o=(null==e||null===(t=e.name)||void 0===t?void 0:t.match(/\d+/))||[],u=E()(o,1)[0]||(null===(n=r.authentication)||void 0===n?void 0:n.id),p=T()(r,e.name),l=Object(s.useState)(!u||p),d=E()(l,2),f=d[0],h=d[1],g=Object(s.useRef)(!0),y=Object(s.useRef)(!1);Object(s.useEffect)((function(){y.current&&(!g.current&&a.getState().pristine&&(h(!1),g.current=!0),f&&(g.current=!1))})),Object(s.useEffect)((function(){y.current=!0}),[]);var v=e.validate&&e.validate.filter((function(e){return e.type!==m.a.REQUIRED})),b=V(V({},e),u?{validate:v,resolveProps:D.a}:{});return f?c.a.createElement(k.a,i()({},b,{autoFocus:!0})):c.a.createElement(A.FormGroup,{helperText:b.helperText,label:b.label,onFocus:function(){return h(!0)},isRequired:!0},c.a.createElement(w.TextInput,{"aria-label":"pre-filled-authentication",value:"•••••••••••••"}))};function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return c.a.createElement(p.a,i()({FormTemplate:v.a,componentMapper:F(F(F({},O.a),j.mapperExtension),{},{authentication:N,"switch-field":O.a[d.a.SWITCH]}),validatorMapper:{"required-validator":g.a[m.a.REQUIRED],"pattern-validator":g.a[m.a.PATTERN],"min-length-validator":g.a[m.a.MIN_LENGTH],"url-validator":g.a[m.a.URL]}},e))}},843:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return ct}));var a=n(36),i=n.n(a),r=n(38),o=n.n(r),s=n(91),c=n.n(s),u=n(70),p=n.n(u),l=n(94),d=n.n(l),f=n(0),m=n.n(f),h=n(10),g=n(63),y=n(30),v=n(194),b=n(569),O=n.n(b),j=n(570),_=n.n(j),E=n(500),M=n.n(E),T=n(501),A=n.n(T),w=n(571),S=n.n(w),k=n(572),x=n.n(k),P=n(379),C=n.n(P),D=n(89),R=n(512),V=n(340),N=n.n(V),I=n(339),F=n.n(I),B=n(152),L=n(153),q=n(573),z=n(344),U=n.n(z),G=n(338),W=n.n(G),Q=function(){var e=W()(),t=U()(e.getState().values,"application.application_type_id",""),n=Object(f.useState)(t),a=o()(n,2),i=a[0],r=a[1];return Object(f.useEffect)((function(){i!==t&&(e.batch((function(){e.change("authentication",void 0),e.change("selectedAuthentication",void 0)})),r(void 0))}),[t]),null},Y=n(9),H=n.n(Y),J=n(455),K=n(87),Z=n(421),$=n(155),X=n(159),ee=n.n(X),te=n(375),ne=function(e,t,n,a,i){var r=t.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:e.display_name}),o=t.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:e.display_name});return n&&n(),a(Object(D.i)(e.id,i.id,r,o))},ae=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(v.a)(),r=Object(y.useSelector)((function(e){return e.sources.appTypes})),o=Object(te.a)(),s=Object(y.useDispatch)();Object(f.useEffect)((function(){a&&(a.hidden=!0)}),[]);var c=t.dependent_applications.map((function(e){var n=r.find((function(t){return t.name===e}));return n&&t.sourceAppsNames.includes(n.display_name)?n.display_name:void 0})).filter((function(e){return e}));return m.a.createElement(Z.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:m.a.createElement($.Title,{headingLevel:"h1",size:"2xl"},m.a.createElement(ee.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[m.a.createElement(K.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){return ne(t,i,n,s,o)}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove application"})),m.a.createElement(K.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},i.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},i.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?"},{appName:m.a.createElement("b",{key:"b"},t.display_name)})),c.length>0&&m.a.createElement(B.Text,{component:B.TextVariants.p},i.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:c}))))};ae.propTypes={app:H.a.shape({id:H.a.string.isRequired,display_name:H.a.string.isRequired,dependent_applications:H.a.arrayOf(H.a.string),sourceAppsNames:H.a.arrayOf(H.a.string)}).isRequired,onCancel:H.a.func.isRequired,container:H.a.instanceOf(Element)};var ie=ae,re=n(346),oe=n(347),se=function(e){var t=e.setApplicationToRemove,n=Object(v.a)(),a=Object(y.useSelector)((function(e){return e.sources.appTypes})),i=Object(te.a)(),r=i.applications.map((function(e){var t=e.application_type_id,n=a.find((function(e){return e.id===t}));return n?n.display_name:void 0}));return i.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=a.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var a=e.display_name,i=e.id,o=e.dependent_applications;return m.a.createElement(L.TextContent,{key:i},m.a.createElement(re.Grid,null,m.a.createElement(oe.GridItem,{md:4,sm:6},m.a.createElement(B.Text,{component:B.TextVariants.p,style:{marginBottom:0}},a)),m.a.createElement(oe.GridItem,{md:8,sm:6,className:"ins-c-sources__remove-app"},m.a.createElement(K.Button,{variant:K.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:i,display_name:a,dependent_applications:o,sourceAppsNames:r})}},n.formatMessage({id:"sources.remove",defaultMessage:"Remove"})))))}))};se.propTypes={setApplicationToRemove:H.a.func.isRequired};var ce=se,ue=function(e){var t=e.container,n=Object(f.useState)({}),a=o()(n,2),i=a[0],r=a[1],s=Object(v.a)(),c=Object(y.useSelector)((function(e){return e.sources.sourceTypes})),u=Object(te.a)(),p=c.find((function(e){return e.id===u.source_type_id})),l=u.applications.filter((function(e){return!e.isDeleting}));return m.a.createElement(m.a.Fragment,null,i.id&&m.a.createElement(ie,{app:i,onCancel:function(){return t&&(t.hidden=!1),r({})},container:t}),m.a.createElement(L.TextContent,null,m.a.createElement(J.Grid,{hasGutter:!0},m.a.createElement(J.GridItem,{md:2},m.a.createElement(B.Text,{component:B.TextVariants.h4},s.formatMessage({id:"sources.sourceName",defaultMessage:"Source name"})),m.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-desc-name"},u.name)),m.a.createElement(J.GridItem,{md:2},m.a.createElement(B.Text,{component:B.TextVariants.h4},s.formatMessage({id:"sources.type",defaultMessage:"Type"})),m.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-desc-type"},p?p.product_name:s.formatMessage({id:"sources.typeNotFound",defaultMessage:"Type not found"}))),m.a.createElement(J.GridItem,{md:8},m.a.createElement(B.Text,{component:B.TextVariants.h4},s.formatMessage({id:"sources.apps",defaultMessage:"Applications"})),l.length>0?m.a.createElement(ce,{setApplicationToRemove:r}):m.a.createElement(B.Text,{component:B.TextVariants.p,id:"add-application-desc-no-app"},s.formatMessage({id:"sources.noApps",defaultMessage:"No applications"}))))))};ue.propTypes={container:H.a.instanceOf(Element)};var pe=ue,le=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:N.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:F.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,r=n.authtype;if(r)return a.find((function(e){return e.authtype===r}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(r)}}},de=n(2),fe=n.n(de);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge=function(e,t,n,a,r){var o,s=i()(n),c=e.schema.authentication.find((function(e){return e.type===a})),u="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),p=q.shouldSkipEndpoint(e.name,a,t.name),l=q.hasCustomSteps(e.name,a,t.name);o=q.getAdditionalSteps(e.name,a,t.name).length>0?u:0!==n.length||p?"summary":"".concat(e.name,"-endpoint");var d=q.getAdditionalStepKeys(e.name,a,t.name),f={};if(q.shouldSkipSelection(e.name,a,t.name)){var m=q.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),h=q.getAdditionalStepFields(c.fields,u);o=m.nextStep?m.nextStep:0!==n.length||p||l?"summary":"".concat(e.name,"-endpoint"),f=he(he({},m),{},{fields:[].concat(i()(s),i()(q.injectAuthFieldsInfo([].concat(i()(m.fields),i()(h)),e.name,a,t.name)))})}return he({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:r.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(i()(s),i()(q.getAdditionalAuthFields(e.name,a,t.name)),i()(q.injectAuthFieldsInfo(q.getNoStepsFields(c.fields,d),e.name,a,t.name))),nextStep:o},f)},ye=function(e){var t=e.authenticationValues,n=W()(),a=n.getState().values.selectedAuthentication,i=Object(f.useState)(a),r=o()(i,2),s=r[0],c=r[1];return Object(f.useEffect)((function(){s!==a&&(!function(e){var t=e.formOptions,n=e.authenticationValues,a=e.selectedAuthentication;if(a.startsWith("new-")){var i=a.replace("new-","");t.change("authentication",{authtype:i})}else{var r=n.find((function(e){return e.id===a}));t.change("authentication",r)}}({formOptions:n,authenticationValues:t,selectedAuthentication:a}),c(void 0))}),[a]),null};ye.propTypes={authenticationValues:H.a.arrayOf(H.a.object)};var ve=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName,a=Object(v.a)();return m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},a.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:n})))};ve.propTypes={applicationTypeName:H.a.string,authenticationTypeName:H.a.string};var be=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,r=e.supportedAuthType;return n.filter((function(e){return e.authtype===r})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),r=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",o=e.username?"-".concat(e.username):"",s=r?"-".concat(r.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(o).concat(s),value:e.id}}))},Oe=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,r=e.sourceType,o=e.applicationTypes,s=[{component:"description",name:"authtypesetter",Content:ye,authenticationValues:a,hideField:!0}];return o.forEach((function(e){var c,u=e.supported_source_types.includes(r.name),p=!(null===(c=n.applications)||void 0===c?void 0:c.find((function(t){return t.application_type_id===e.id})));if(u&&p){var l=U()(e,"supported_authentication_types[".concat(r.name,"]"),[]);l.forEach((function(c){if(a.find((function(e){return e.authtype===c}))){var u=U()(r,"schema.authentication",{}).find((function(e){return e.type===c})).name;s.push({component:N.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(i()(l.length>1?[{when:"authtype",is:c}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:ve,applicationTypeName:e.display_name,authenticationTypeName:u},{component:N.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:F.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new-".concat(c)}].concat(i()(be({authenticationValues:a,source:n,applicationTypes:o,supportedAuthTypeName:u,supportedAuthType:c})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:s,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,i=t.authentication,o=n||{},s=o.application_type_id?o.application_type_id:"";return"".concat(r.name,"-").concat(s,"-").concat(a||(null==i?void 0:i.authtype))}}},je=function(){var e=Object(v.a)();return m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},e.formatMessage({id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source."})))},_e=function(){var e=Object(v.a)();return m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},Ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===U()(t,"supported_authentication_types.".concat(n,"[0]"))}))},Me=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=e.length>0,u=c?"summary":void 0,p=[],l=n.find((function(e){return e.id===o.source_type_id}));if(!o.imported&&c){var d=l.schema.endpoint.hidden?l.schema.endpoint.fields:[],f=0===d.length;a.forEach((function(e){e.supported_source_types.includes(l.name)&&e.supported_authentication_types[l.name].forEach((function(n){p.push(ge(l,e,d,n,t))}))})),l.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(l.name)){var n=q.getAdditionalSteps(l.name,e.type,t.name);n.length>0&&p.push.apply(p,i()(q.createAdditionalSteps(n,l.name,e.type,f,e.fields,t.name)))}}))})),f&&p.push(q.createEndpointStep(l.schema.endpoint,l.name)),u=function(e){var t=e.values.application;if(t){var n,i=a.find((function(e){return e.id===t.application_type_id}));if((null==i||null===(n=i.supported_authentication_types[l.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(Ee(r,a.find((function(e){return e.id===t.application_type_id})),l.name))return"selectAuthentication";var o=null==i?void 0:i.supported_authentication_types[l.name][0];return"".concat(l.name,"-").concat(t&&t.application_type_id,"-").concat(o)}}}var m=c?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:F.a.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:F.a.REQUIRED}],Content:je},h=a.filter((function(e){return Me(e,l)})).map((function(e){return le(l,e,t,r)}));return!o.imported&&c&&h.push(Oe({intl:t,source:o,authenticationValues:r,sourceType:l,applicationTypes:a})),{fields:[{component:N.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:s,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:c?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:u,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:pe,container:s},m,{component:"description",name:"authtypesetter",Content:Q,hideField:!0}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:_e},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(i()(h),p)}]}},Ae=n(574),we=function(e){var t=e.step,n=e.goToSources,a=Object(v.a)();return m.a.createElement(Ae.Wizard,{isOpen:!0,onClose:n,title:a.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:a.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};we.propTypes={step:Y.PropTypes.node.isRequired,goToSources:Y.PropTypes.func.isRequired};var Se=we,ke=n(22),xe=n(411),Pe=n(388),Ce=n(90),De=n(69),Re=n.n(De),Ve=n(196),Ne=n.n(Ve),Ie=n(776),Fe=n(451),Be=n(404),Le=n(450),qe=n(345),ze=n(578),Ue=n.n(ze),Ge=n(787),We=n.n(Ge),Qe=n(814),Ye=n.n(Qe),He=n(511);function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ze=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===Ne()(t[n])?Ue()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},$e=function(){var e=d()(p.a.mark((function e(t,n,a,i){var r,s,c,u,l,d,f,m,h,g,y,v,b,O,j,_,E,M,T,A,w,S,k,x,P,C,D,R,V,N,I,F,B,L,q,z,U,G,W,Q=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Q.length>4&&void 0!==Q[4]?Q[4]:[],c=n.getState(),u=c.values,l=u.authentication?u.authentication.id:void 0,d=l?a.find((function(e){return e.id===l})):void 0,f=t.authentication,m=Re()(t,["authentication"]),h=Object(Ie.addedDiff)(i,m),g=Object(Ie.updatedDiff)(i,m),y=Object(Ie.addedDiff)(d,f),v=Object(Ie.updatedDiff)(d,f),b=Ze(Ke(Ke({},We()(Ye()(h),g)),{},{authentication:Ke({},We()(Ye()(y),v))})),e.prev=11,u.source&&u.source.id){e.next=14;break}throw"Missing source id";case 14:if(O=u.source.id,j=u.endpoint?u.endpoint.id:void 0,_=[],b.source&&!Ue()(b.source)?_.push(Object(ke.k)().updateSource(O,b.source)):_.push(Promise.resolve(void 0)),E=b.endpoint&&!Ue()(b.endpoint),M=b.url&&!Ue()(b.url),!E&&!M){e.next=36;break}if(T=Object(He.b)(b),A=T.scheme,w=T.host,S=T.port,k=T.path,x=parseInt(S,10),P=Ze(Ke(Ke({},b.endpoint),{},{scheme:A,host:w,port:isNaN(x)?void 0:x,path:k})),!j){e.next=28;break}_.push(Object(ke.k)().updateEndpoint(j,P)),e.next=34;break;case 28:return _.push(Promise.resolve(void 0)),C=Ke(Ke({},P),{},{default:!0,source_id:O}),e.next=32,Object(ke.k)().createEndpoint(C);case 32:D=e.sent,j=D.id;case 34:e.next=37;break;case 36:_.push(Promise.resolve(void 0));case 37:return b.authentication&&!Ue()(b.authentication)?l?_.push(Object(ke.k)().updateAuthentication(l,b.authentication)):j&&(R=Ke(Ke({},b.authentication),{},{resource_id:j,resource_type:"Endpoint"}),_.push(Object(ke.k)().createAuthentication(R))):_.push(Promise.resolve(void 0)),b.application&&b.application.application_type_id?_.push(Object(ke.b)(O,b.application.application_type_id)):_.push(Promise.resolve(void 0)),e.next=41,Promise.all(_);case 41:return V=e.sent,N=o()(V,4),N[0],N[1],I=N[2],F=N[3],s=null==F?void 0:F.id,B=l||(I?I.id:void 0),L=[],F&&F.id&&B&&(q={application_id:F.id,authentication_id:B},L.push(Object(ke.k)().createAuthApp(q))),(b.credentials||b.billing_source)&&(z=b.credentials,U=b.billing_source,G={},G=z?{authentication:{credentials:z}}:{},G=U?Ke(Ke({},G),{},{billing_source:U}):G,L.push(Object(Fe.patchSource)(Ke({id:O},G)))),e.next=55,Promise.all(L);case 55:if(!F){e.next=60;break}return W=Object(qe.timeoutedApps)(r).includes(F.application_type_id)?1e4:0,e.next=59,Object(Le.checkAppAvailability)(F.id,W);case 59:return e.abrupt("return",e.sent);case 60:return e.abrupt("return",{});case 63:if(e.prev=63,e.t0=e.catch(11),console.error(e.t0),!s){e.next=69;break}return e.next=69,Object(ke.k)().deleteApplication(s);case 69:return e.next=71,Object(Be.handleError)(e.t0);case 71:throw e.sent;case 73:case"end":return e.stop()}}),e,null,[[11,63]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),Xe=n(474);function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},at=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,r=t.initialValues,o=t.error,s=t.values,c=t.data,u=t.formApi;switch(n){case"setSourceAppslength":return tt(tt({},e),{},{sourceAppsLength:a});case"loadAuthentications":return tt(tt({},e),{},{authenticationsValues:i,initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return tt(tt({},e),{},{initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return tt(tt({},e),{},{state:"wizard"});case"submit":return tt(tt({},e),{},{values:s,formApi:u,state:"submitting"});case"finish":return tt(tt({},e),{},{state:"finished",data:c});case"error":return tt(tt({},e),{},{state:"errored",error:o});case"toggleCancelling":return tt(tt({},e),{},{isCancelling:!e.isCancelling},s&&{values:s});default:return e}},it=n(88),rt=n(833),ot=void 0,st=function(e){var t=e.values.application;return ot=t},ct=function(e,t,n,a,i,r,o){return i({type:"submit",values:e,formApi:t}),$e(e,t,n,r,o).then(function(){var e=d()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Xe.a)(r.source.id),e.next=3,a(Object(D.f)());case 3:return ot=void 0,e.abrupt("return",i({type:"finish",data:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i({type:"error",error:e})}))},ut=function(e){return m.a.createElement(C.a,c()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(v.a)(),t=Object(h.k)(),n=Object(xe.a)(),a=Object(y.useSelector)((function(e){return e.sources}),y.shallowEqual),r=a.appTypes,s=a.sourceTypesLoaded,c=a.appTypesLoaded,u=a.sourceTypes,p=Object(te.a)(),l=Object(y.useDispatch)(),d=Object(f.useReducer)(at,nt),b=o()(d,2),j=b[0],E=b[1],T=Object(f.useRef)(document.createElement("div"));Object(f.useEffect)((function(){ot=void 0}),[]),Object(f.useEffect)((function(){if(p){var e=j.sourceAppsLength>=p.applications.length&&j.sourceAppsLength>0;E({type:"setSourceAppslength",length:p.applications.length}),e||(p.endpoints&&p.endpoints[0]?Object(ke.k)().listEndpointAuthentications(p.endpoints[0].id).then((function(e){var t=e.data;return E({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:p,endpoint:p.endpoints[0],url:Object(Pe.c)(p.endpoints[0]),application:ot},values:{}})})):E({type:"loadWithoutAuthentications",initialValues:{source:p,application:ot},values:{}}))}}),[p]);var w=function(){return t.push(Ce.c.sources.path)};if(!(c&&s&&n&&"loading"!==j.state||"submitting"===j.state))return m.a.createElement(Se,{goToSources:w,step:m.a.createElement(M.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w})});var k=function(e,t){return ct(e,t,j.authenticationsValues,l,E,j.initialValues,r)};if("submitting"===j.state)return m.a.createElement(Se,{goToSources:w,step:m.a.createElement(M.a,{cancelTitle:e.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:w,customText:e.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var P=function(){return E({type:"reset"})};if("wizard"!==j.state){var C;if("finished"!==j.state)C=m.a.createElement(A.a,{onRetry:P,onClose:w,returnButtonTitle:e.formatMessage({id:"sources.retry",defaultMessage:"Retry"}),primaryAction:function(){return k(j.values,j.formApi)},secondaryActions:m.a.createElement(rt.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},e.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"}))});else switch(j.data.availability_status){case"available":C=m.a.createElement(S.a,{title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),hideSourcesButton:!0,onReset:P,onClose:w,secondaryActions:m.a.createElement(it.Button,{variant:"link",onClick:P},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:e.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application was successfully added."})});break;case"unavailable":C=m.a.createElement(A.a,{onRetry:P,onClose:w,message:j.data.availability_status_error||e.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),secondaryActions:m.a.createElement(it.Button,{variant:"link",onClick:function(){var t,n;return E({type:"reset"}),ne({id:null===(t=j.data)||void 0===t?void 0:t.id,display_name:null===(n=r.find((function(e){var t;return e.id===(null===(t=j.data)||void 0===t?void 0:t.application_type_id)})))||void 0===n?void 0:n.display_name},e,void 0,l,p)}},e.formatMessage({id:"wizard.removeApp",defaultMessage:"Remove application"})),Component:function(){return m.a.createElement(g.Link,{to:Object(Ce.b)(Ce.c.sourcesEdit.path,p.id)},m.a.createElement(it.Button,{variant:"primary",className:"pf-u-mt-xl"},e.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))}});break;default:C=m.a.createElement(x.a,{returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),onClose:w,secondaryActions:m.a.createElement(it.Button,{variant:"link",onClick:P},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"}))})}return m.a.createElement(Se,{goToSources:w,step:C})}var D=p.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),V=u.find((function(e){return e.id===p.source_type_id})),N=V&&V.name,I=r.filter((function(e){return!D.includes(e.id)&&e.supported_source_types.includes(N)})).filter(O.a),F=I.map((function(t){var n=p.applications.find((function(e){return e.application_type_id===t.id})),a="".concat(t.display_name," ").concat(n?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:a,isDisabled:!!n}})),B=Te(F,e,u,r,j.authenticationsValues,p,T.current),L=I.length>0?k:w;return m.a.createElement(m.a.Fragment,null,m.a.createElement(_.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:j.isCancelling,onStay:function(){T.current.hidden=!1,E({type:"toggleCancelling"})},onExit:w}),m.a.createElement(R.a,{schema:B,showFormControls:!1,onSubmit:L,onCancel:function(e){(null==e?void 0:e.application)?(T.current.hidden=!0,E({type:"toggleCancelling",values:e})):w()},initialValues:j.initialValues,subscription:{values:!0},debug:st,clearedValue:null,FormTemplate:ut}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map