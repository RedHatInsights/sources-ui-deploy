(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{352:function(e,t,n){"use strict";var a=n(0),i=Object(a.createContext)();t.a=i},372:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(89),i=n.n(a),o=n(0),r=n.n(o),s=n(11),c=n.n(s),u=n(319),p=n.n(u),l=n(434),d=n.n(l),f=n(45),m=n(321),h=n(352),g=n(316),y=n.n(g),v="edit-field",b=function(e){var t=e.isRequired,n=e.label,a=e.helperText,s=e.hideLabel,c=e.name,u=e.type,l=e.isEditable,g=y()(),v=g.getFieldState,b=g.getState,O=Object(o.useContext)(h.a).setState,j=v(c)||{value:p()(b().initialValues,c)},_=j.error,E=j.touched,T=j.value,M=E&&_,A="password"===u||c.includes("password")?"Click to edit":"Click to add";return r.a.createElement(m.FormGroup,i()({isRequired:t,label:!s&&n,fieldId:c,validated:M?"error":"default",helperText:a,helperTextInvalid:_,tabIndex:0,onKeyPress:function(e){32===e.charCode&&l&&(e.preventDefault(),O({type:"setEdit",name:c}))}},l&&{onClick:function(){return O({type:"setEdit",name:c})}}),r.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(l?"clickable":"")},r.a.createElement(f.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(l?"clickable":"")},r.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},T||(l?A:"")),l&&r.a.createElement(d.a,null))))};b.propTypes={label:c.a.node,isRequired:c.a.bool,helperText:c.a.node,hideLabel:c.a.bool,isEditable:c.a.bool,type:c.a.string,name:c.a.string},t.b=b},485:function(e,t,n){"use strict";var a=n(89),i=n.n(a),o=n(2),r=n.n(o),s=n(0),c=n.n(s),u=n(367),p=n.n(u),l=n(315),d=n.n(l),f=n(317),m=n.n(f),h=n(355),g=n.n(h),y=n(347),v=n.n(y),b=n(369),O=n.n(b),j=n(460),_=n(66),E=n.n(_),T=n(11),M=n.n(T),A=n(380),w=n.n(A),S=n(352),x=n(372),C=[d.a.CHECKBOX,d.a.SWITCH],P=function(e){var t=e.originalComponent,n=e.isEditable,a=void 0===n||n,o=E()(e,["originalComponent","isEditable"]),r=x.b,u={},p=Object(s.useContext)(w.a).componentMapper;return Object(s.useContext)(S.a).editing[o.name]||C.includes(t)?r=p[t]:a&&(u={isEditable:!0}),c.a.createElement(r,i()({},o,u))};P.propTypes={originalComponent:M.a.string,name:M.a.string,isEditable:M.a.bool};var V=P;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return c.a.createElement(p.a,i()({FormTemplate:v.a,componentMapper:D(D(D({},O.a),j.mapperExtension),{},{"edit-field":V,"switch-field":O.a[d.a.SWITCH]}),validatorMapper:{"required-validator":g.a[m.a.REQUIRED],"pattern-validator":g.a[m.a.PATTERN],"min-length-validator":g.a[m.a.MIN_LENGTH],"url-validator":g.a[m.a.URL]}},e))}},751:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return at}));var a=n(28),i=n.n(a),o=n(40),r=n.n(o),s=n(89),c=n.n(s),u=n(73),p=n.n(u),l=n(104),d=n.n(l),f=n(0),m=n.n(f),h=n(13),g=n(31),y=n(185),v=n(473),b=n.n(v),O=n(480),j=n.n(O),_=n(540),E=n.n(_),T=n(541),M=n.n(T),A=n(542),w=n.n(A),S=n(543),x=n.n(S),C=n(544),P=n.n(C),V=n(347),k=n.n(V),D=n(86),R=n(485),N=n(315),I=n.n(N),F=n(317),q=n.n(F),B=n(29),L=n(45),G=n(545),z=n(319),U=n.n(z),W=n(11),Q=n.n(W),Y=n(316),H=n.n(Y),K=function(e){var t=e.modifiedValues,n=H()(),a=U()(n.getState().values,"application.application_type_id",""),i=Object(f.useState)(a),o=r()(i,2),s=o[0],c=o[1];return Object(f.useEffect)((function(){if(s!==a){var e=t&&t.authentication?t.authentication:void 0;n.batch((function(){n.change("authentication",e),n.change("selectedAuthentication",void 0)})),c(void 0)}}),[a]),null};K.propTypes={modifiedValues:Q.a.object};var J=n(417),X=n(84),Z=n(374),$=n(85),ee=n(65),te=n.n(ee),ne=n(353),ae=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(y.a)(),o=Object(g.useSelector)((function(e){return e.sources.appTypes})),r=Object(ne.a)(),s=Object(g.useDispatch)();Object(f.useEffect)((function(){a&&(a.hidden=!0)}),[]);var c=t.dependent_applications.map((function(e){var n=o.find((function(t){return t.name===e}));return n&&t.sourceAppsNames.includes(n.display_name)?n.display_name:void 0})).filter((function(e){return e}));return m.a.createElement(Z.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:m.a.createElement($.Title,{headingLevel:"h1",size:"2xl"},m.a.createElement(te.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[m.a.createElement(X.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){var e=i.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:t.display_name}),a=i.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:t.display_name});return n(),s(Object(D.i)(t.id,r.id,e,a))}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove application"})),m.a.createElement(X.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},i.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},i.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?"},{appName:m.a.createElement("b",{key:"b"},t.display_name)})),c.length>0&&m.a.createElement(B.Text,{component:B.TextVariants.p},i.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:c}))))};ae.propTypes={app:Q.a.shape({id:Q.a.string.isRequired,display_name:Q.a.string.isRequired,dependent_applications:Q.a.arrayOf(Q.a.string),sourceAppsNames:Q.a.arrayOf(Q.a.string)}).isRequired,onCancel:Q.a.func.isRequired,container:Q.a.instanceOf(Element)};var ie=ae,oe=n(323),re=n(324),se=function(e){var t=e.setApplicationToRemove,n=e.breakpoints,a=e.namePrefix,i=Object(y.a)(),o=Object(g.useSelector)((function(e){return e.sources.appTypes})),r=Object(ne.a)(),s=r.applications.map((function(e){var t=e.application_type_id,n=o.find((function(e){return e.id===t}));return n?n.display_name:void 0}));return r.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=o.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var o=e.display_name,r=e.id,c=e.dependent_applications;return m.a.createElement(L.TextContent,{key:r},m.a.createElement(oe.Grid,null,m.a.createElement(re.GridItem,{md:n.display_name||4},m.a.createElement(B.Text,{component:B.TextVariants.p,style:{marginBottom:0}},a,o)),m.a.createElement(re.GridItem,{md:n.remove||8,className:"ins-c-sources__remove-app"},m.a.createElement(X.Button,{variant:X.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:r,display_name:o,dependent_applications:c,sourceAppsNames:s})}},i.formatMessage({id:"sources.remove",defaultMessage:"Remove"})))))}))};se.propTypes={setApplicationToRemove:Q.a.func.isRequired,breakpoints:Q.a.shape({display_name:Q.a.number,remove:Q.a.number}),namePrefix:Q.a.node},se.defaultProps={breakpoints:{}};var ce=se,ue=function(e){var t=e.container,n=Object(f.useState)({}),a=r()(n,2),i=a[0],o=a[1],s=Object(y.a)(),c=Object(g.useSelector)((function(e){return e.sources.sourceTypes})),u=Object(ne.a)(),p=c.find((function(e){return e.id===u.source_type_id})),l=u.applications.filter((function(e){return!e.isDeleting}));return m.a.createElement(m.a.Fragment,null,i.id&&m.a.createElement(ie,{app:i,onCancel:function(){return t&&(t.hidden=!1),o({})},container:t}),m.a.createElement(L.TextContent,null,m.a.createElement(J.Grid,{hasGutter:!0},m.a.createElement(J.GridItem,{md:2},m.a.createElement(B.Text,{component:B.TextVariants.h4},s.formatMessage({id:"sources.sourceName",defaultMessage:"Source name"}))),m.a.createElement(J.GridItem,{md:2},m.a.createElement(B.Text,{component:B.TextVariants.h4},s.formatMessage({id:"sources.type",defaultMessage:"Type"}))),m.a.createElement(J.GridItem,{md:8},m.a.createElement(B.Text,{component:B.TextVariants.h4},s.formatMessage({id:"sources.apps",defaultMessage:"Applications"}))),m.a.createElement(J.GridItem,{md:2},m.a.createElement(B.Text,{component:B.TextVariants.p},u.name)),m.a.createElement(J.GridItem,{md:2},m.a.createElement(B.Text,{component:B.TextVariants.p},p?p.product_name:s.formatMessage({id:"sources.typeNotFound",defaultMessage:"Type not found"}))),m.a.createElement(J.GridItem,{md:8},l.length>0?m.a.createElement(ce,{setApplicationToRemove:o}):s.formatMessage({id:"sources.noApps",defaultMessage:"No applications"})))))};ue.propTypes={container:Q.a.instanceOf(Element)};var pe=ue,le=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:I.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:q.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,o=n.authtype;if(o)return a.find((function(e){return e.authtype===o}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(o)}}},de=n(2),fe=n.n(de);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge=function(e,t,n,a,o){var r,s=i()(n),c=e.schema.authentication.find((function(e){return e.type===a})),u="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),p=G.shouldSkipEndpoint(e.name,a,t.name),l=G.hasCustomSteps(e.name,a,t.name);r=G.getAdditionalSteps(e.name,a,t.name).length>0?u:0!==n.length||p?"summary":"".concat(e.name,"-endpoint");var d=G.getAdditionalStepKeys(e.name,a,t.name),f={};if(G.shouldSkipSelection(e.name,a,t.name)){var m=G.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),h=G.getAdditionalStepFields(c.fields,u);r=m.nextStep?m.nextStep:0!==n.length||p||l?"summary":"".concat(e.name,"-endpoint"),f=he(he({},m),{},{fields:[].concat(i()(s),i()(G.injectAuthFieldsInfo([].concat(i()(m.fields),i()(h)),e.name,a,t.name)))})}return he({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:o.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(i()(s),i()(G.getAdditionalAuthFields(e.name,a,t.name)),i()(G.injectAuthFieldsInfo(G.getNoStepsFields(c.fields,d),e.name,a,t.name))),nextStep:r},f)};function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be=function(e){var t=e.authenticationValues,n=e.modifiedValues,a=H()(),i=a.getState().values.selectedAuthentication,o=Object(f.useState)(i),s=r()(o,2),c=s[0],u=s[1];return Object(f.useEffect)((function(){c!==i&&(!function(e){var t=e.formOptions,n=e.modifiedValues,a=e.authenticationValues,i=e.selectedAuthentication;if(i.startsWith("new-")){var o=i.replace("new-","");n&&n.authentication?t.change("authentication",ve(ve({},n.authentication),{},{authtype:o})):t.change("authentication",{authtype:o})}else{var r=a.find((function(e){return e.id===i}));if(n&&n.authentication){var s=b()(j()(r),n.authentication);t.change("authentication",s)}else t.change("authentication",r)}}({formOptions:a,authenticationValues:t,modifiedValues:n,selectedAuthentication:i}),u(void 0))}),[i]),null};be.propTypes={authenticationValues:Q.a.arrayOf(Q.a.object),modifiedValues:Q.a.object};var Oe=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName,a=Object(y.a)();return m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},a.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:n})))};Oe.propTypes={applicationTypeName:Q.a.string,authenticationTypeName:Q.a.string};var je=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,o=e.supportedAuthType;return n.filter((function(e){return e.authtype===o})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),o=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",r=e.username?"-".concat(e.username):"",s=o?"-".concat(o.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(r).concat(s),value:e.id}}))},_e=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,o=e.sourceType,r=e.applicationTypes,s=e.modifiedValues,c=[{component:"description",name:"authtypesetter",Content:be,authenticationValues:a,hideField:!0,modifiedValues:s}];return r.forEach((function(e){var s,u=e.supported_source_types.includes(o.name),p=!(null===(s=n.applications)||void 0===s?void 0:s.find((function(t){return t.application_type_id===e.id})));if(u&&p){var l=U()(e,"supported_authentication_types[".concat(o.name,"]"),[]);l.forEach((function(s){if(a.find((function(e){return e.authtype===s}))){var u=U()(o,"schema.authentication",{}).find((function(e){return e.type===s})).name;c.push({component:I.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(i()(l.length>1?[{when:"authtype",is:s}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:Oe,applicationTypeName:e.display_name,authenticationTypeName:u},{component:I.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:q.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new-".concat(s)}].concat(i()(je({authenticationValues:a,source:n,applicationTypes:r,supportedAuthTypeName:u,supportedAuthType:s})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:c,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,i=t.authentication,r=n||{},s=r.application_type_id?r.application_type_id:"";return"".concat(o.name,"-").concat(s,"-").concat(a||(null==i?void 0:i.authtype))}}},Ee=function(){var e=Object(y.a)();return m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},e.formatMessage({id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source."})))},Te=function(){var e=Object(y.a)();return m.a.createElement(L.TextContent,null,m.a.createElement(B.Text,{component:B.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===U()(t,"supported_authentication_types.".concat(n,"[0]"))}))},Ae=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,u=e.length>0,p=u?"summary":void 0,l=[],d=n.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&u){var f=d.schema.endpoint.hidden?d.schema.endpoint.fields:[],m=0===f.length;a.forEach((function(e){e.supported_source_types.includes(d.name)&&e.supported_authentication_types[d.name].forEach((function(n){l.push(ge(d,e,f,n,t))}))})),d.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(d.name)){var n=G.getAdditionalSteps(d.name,e.type,t.name);n.length>0&&l.push.apply(l,i()(G.createAdditionalSteps(n,d.name,e.type,m,e.fields,t.name)))}}))})),m&&l.push(G.createEndpointStep(d.schema.endpoint,d.name)),p=function(e){var t=e.values.application;if(t){var n,i=a.find((function(e){return e.id===t.application_type_id}));if((null==i||null===(n=i.supported_authentication_types[d.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(Me(o,a.find((function(e){return e.id===t.application_type_id})),d.name))return"selectAuthentication";var r=null==i?void 0:i.supported_authentication_types[d.name][0];return"".concat(d.name,"-").concat(t&&t.application_type_id,"-").concat(r)}}}var h=u?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:q.a.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:q.a.REQUIRED}],Content:Ee},g=a.filter((function(e){return Ae(e,d)})).map((function(e){return le(d,e,t,o)}));return!r.imported&&u&&g.push(_e({intl:t,source:r,authenticationValues:o,sourceType:d,applicationTypes:a,modifiedValues:s})),{fields:[{component:I.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:c,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:u?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:p,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:pe,container:c},h,{component:"description",name:"authtypesetter",Content:K,hideField:!0,modifiedValues:s}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:Te},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(i()(g),l)}]}},Se=n(546),xe=function(e){var t=e.step,n=e.goToSources,a=Object(y.a)();return m.a.createElement(Se.Wizard,{isOpen:!0,onClose:n,title:a.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:a.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};xe.propTypes={step:W.PropTypes.node.isRequired,goToSources:W.PropTypes.func.isRequired};var Ce=xe,Pe=n(17),Ve=n(377),ke=n(97),De=n(87),Re=n(66),Ne=n.n(Re),Ie=n(186),Fe=n.n(Ie),qe=n(742),Be=n(483),Le=n(373),Ge=n(550),ze=n.n(Ge),Ue=n(135);function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ye=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===Fe()(t[n])?ze()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},He=function(){var e=d()(p.a.mark((function e(t,n,a,i){var o,s,c,u,l,d,f,m,h,g,y,v,O,_,E,T,M,A,w,S,x,C,P,V,k,D,R,N,I,F,q,B,L,G,z,U;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.getState(),s=o.values,c=s.authentication?s.authentication.id:void 0,u=c?a.find((function(e){return e.id===c})):void 0,l=t.authentication,d=Ne()(t,["authentication"]),f=Object(qe.addedDiff)(i,d),m=Object(qe.updatedDiff)(i,d),h=Object(qe.addedDiff)(u,l),g=Object(qe.updatedDiff)(u,l),y=Ye(Qe(Qe({},b()(j()(f),m)),{},{authentication:Qe({},b()(j()(h),g))})),e.prev=10,s.source&&s.source.id){e.next=13;break}throw"Missing source id";case 13:if(v=s.source.id,O=s.endpoint?s.endpoint.id:void 0,_=[],y.source&&!ze()(y.source)?_.push(Object(Pe.j)().updateSource(v,y.source)):_.push(Promise.resolve(void 0)),E=y.endpoint&&!ze()(y.endpoint),T=y.url&&!ze()(y.url),!E&&!T){e.next=35;break}if(M=Object(Ue.b)(y),A=M.scheme,w=M.host,S=M.port,x=M.path,C=parseInt(S,10),P=Ye(Qe(Qe({},y.endpoint),{},{scheme:A,host:w,port:isNaN(C)?void 0:C,path:x})),!O){e.next=27;break}_.push(Object(Pe.j)().updateEndpoint(O,P)),e.next=33;break;case 27:return _.push(Promise.resolve(void 0)),V=Qe(Qe({},P),{},{default:!0,source_id:v}),e.next=31,Object(Pe.j)().createEndpoint(V);case 31:k=e.sent,O=k.id;case 33:e.next=36;break;case 35:_.push(Promise.resolve(void 0));case 36:return y.authentication&&!ze()(y.authentication)?c?_.push(Object(Pe.j)().updateAuthentication(c,y.authentication)):O&&(D=Qe(Qe({},y.authentication),{},{resource_id:O,resource_type:"Endpoint"}),_.push(Object(Pe.j)().createAuthentication(D))):_.push(Promise.resolve(void 0)),y.application&&y.application.application_type_id?_.push(Object(Pe.b)(v,y.application.application_type_id)):_.push(Promise.resolve(void 0)),e.next=40,Promise.all(_);case 40:return R=e.sent,N=r()(R,4),N[0],N[1],I=N[2],F=N[3],q=c||(I?I.id:void 0),B=[],F&&F.id&&q&&(L={application_id:F.id,authentication_id:q},B.push(Object(Pe.j)().createAuthApp(L))),(y.credentials||y.billing_source)&&(G=y.credentials,z=y.billing_source,U={},U=G?{authentication:{credentials:G}}:{},U=z?Qe(Qe({},U),{},{billing_source:z}):U,B.push(Object(Be.patchSource)(Qe({id:v},U)))),e.next=53,Promise.all(B);case 53:e.next=61;break;case 55:return e.prev=55,e.t0=e.catch(10),e.next=59,Object(Le.handleError)(e.t0);case 59:throw e.sent;case 61:case"end":return e.stop()}}),e,null,[[10,55]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),Ke=n(443);function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ze={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},$e=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,o=t.initialValues,r=t.error,s=t.values;switch(n){case"setSourceAppslength":return Xe(Xe({},e),{},{sourceAppsLength:a});case"loadAuthentications":return Xe(Xe({},e),{},{authenticationsValues:i,initialValues:o,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return Xe(Xe({},e),{},{initialValues:o,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return Xe(Xe({},e),{},{state:"wizard"});case"submit":return Xe(Xe({},e),{},{state:"submitting"});case"finish":return Xe(Xe({},e),{},{state:"finished"});case"error":return Xe(Xe({},e),{},{state:"errored",error:r,values:s});case"toggleCancelling":return Xe(Xe({},e),{},{isCancelling:!e.isCancelling},s&&{values:s});default:return e}},et=n(61),tt=void 0,nt=function(e){var t=e.values.application;return tt=t},at=function(e,t,n,a,i,o,r){return i({type:"submit"}),He(e,t,n,o,i,r).then(d()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Ke.a)(o.source.id),e.next=3,a(Object(D.f)());case 3:return tt=void 0,e.abrupt("return",i({type:"finish"}));case 5:case"end":return e.stop()}}),e)})))).catch((function(t){return i({type:"error",error:t,values:e})}))},it=function(e){return m.a.createElement(k.a,c()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(y.a)(),t=Object(h.f)(),n=Object(Ve.a)(),a=Object(g.useSelector)((function(e){return e.sources}),g.shallowEqual),o=a.appTypes,s=a.sourceTypesLoaded,c=a.appTypesLoaded,u=a.sourceTypes,p=Object(ne.a)(),l=Object(g.useDispatch)(),d=Object(f.useReducer)($e,Ze),v=r()(d,2),O=v[0],_=v[1],T=Object(f.useRef)(document.createElement("div"));Object(f.useEffect)((function(){tt=void 0}),[]),Object(f.useEffect)((function(){if(p){var e=O.sourceAppsLength>=p.applications.length&&O.sourceAppsLength>0;_({type:"setSourceAppslength",length:p.applications.length}),e||(p.endpoints&&p.endpoints[0]?Object(Pe.j)().listEndpointAuthentications(p.endpoints[0].id).then((function(e){var t=e.data;return _({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:p,endpoint:p.endpoints[0],url:Object(ke.b)(p.endpoints[0]),application:tt},values:{}})})):_({type:"loadWithoutAuthentications",initialValues:{source:p,application:tt},values:{}}))}}),[p]);var A=function(){return t.push(De.c.sources.path)};if(!(c&&s&&n&&"loading"!==O.state||"submitting"===O.state))return m.a.createElement(Ce,{goToSources:A,step:m.a.createElement(w.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:e.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"})})});if("submitting"===O.state)return m.a.createElement(Ce,{goToSources:A,step:m.a.createElement(w.a,{cancelTitle:e.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),customText:e.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var S=function(){return _({type:"reset"})};if("wizard"!==O.state){var C="finished"===O.state?m.a.createElement(P.a,{title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),onReset:S,onClose:A,hideSourcesButton:!0,secondaryActions:m.a.createElement(et.Button,{variant:"link",onClick:S},e.formatMessage({id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:e.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application has been successfully added."})}):m.a.createElement(x.a,{onRetry:S,onClose:A,message:O.error,customText:e.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application has not been successfully added:"}),title:e.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),returnButtonTitle:e.formatMessage({id:"sources.backToSources",defaultMessage:"Back to Sources"}),retryText:e.formatMessage({id:"sources.retry",defaultMessage:"Retry"})});return m.a.createElement(Ce,{goToSources:A,step:C})}var V=p.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),k=u.find((function(e){return e.id===p.source_type_id})),D=k&&k.name,N=o.filter((function(e){return!V.includes(e.id)&&e.supported_source_types.includes(D)})).filter(E.a),I=N.map((function(t){var n=p.applications.find((function(e){return e.application_type_id===t.id})),a="".concat(t.display_name," ").concat(n?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:a,isDisabled:!!n}})),F=we(I,e,u,o,O.authenticationsValues,p,O.values,T.current),q=N.length>0?function(t,n){return at(t,n,O.authenticationsValues,l,_,O.initialValues,e)}:A,B=b()(j()(O.initialValues),O.values);return m.a.createElement(m.a.Fragment,null,m.a.createElement(M.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:O.isCancelling,onStay:function(){T.current.hidden=!1,_({type:"toggleCancelling"})},onExit:A}),m.a.createElement(R.a,{schema:F,showFormControls:!1,onSubmit:q,onCancel:function(e){(null==e?void 0:e.application)?(T.current.hidden=!0,_({type:"toggleCancelling",values:e})):A()},initialValues:B,subscription:{values:!0},debug:nt,clearedValue:null,FormTemplate:it}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map