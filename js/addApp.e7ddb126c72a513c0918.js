(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{352:function(e,t,n){"use strict";var a=n(0),i=Object(a.createContext)();t.a=i},372:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(89),i=n.n(a),o=n(0),r=n.n(o),c=n(11),s=n.n(c),u=n(319),l=n.n(u),p=n(434),d=n.n(p),m=n(45),f=n(321),h=n(352),g=n(316),y=n.n(g),v="edit-field",b=function(e){var t=e.isRequired,n=e.label,a=e.helperText,c=e.hideLabel,s=e.name,u=e.type,p=e.isEditable,g=y()(),v=g.getFieldState,b=g.getState,O=Object(o.useContext)(h.a).setState,E=v(s)||{value:l()(b().initialValues,s)},_=E.error,j=E.touched,T=E.value,A=j&&_,M="password"===u||s.includes("password")?"Click to edit":"Click to add";return r.a.createElement(f.FormGroup,i()({isRequired:t,label:!c&&n,fieldId:s,validated:A?"error":"default",helperText:a,helperTextInvalid:_,tabIndex:0,onKeyPress:function(e){32===e.charCode&&p&&(e.preventDefault(),O({type:"setEdit",name:s}))}},p&&{onClick:function(){return O({type:"setEdit",name:s})}}),r.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(p?"clickable":"")},r.a.createElement(m.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(p?"clickable":"")},r.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},T||(p?M:"")),p&&r.a.createElement(d.a,null))))};b.propTypes={label:s.a.node,isRequired:s.a.bool,helperText:s.a.node,hideLabel:s.a.bool,isEditable:s.a.bool,type:s.a.string,name:s.a.string},t.b=b},485:function(e,t,n){"use strict";var a=n(89),i=n.n(a),o=n(2),r=n.n(o),c=n(0),s=n.n(c),u=n(367),l=n.n(u),p=n(315),d=n.n(p),m=n(317),f=n.n(m),h=n(355),g=n.n(h),y=n(347),v=n.n(y),b=n(369),O=n.n(b),E=n(460),_=n(66),j=n.n(_),T=n(11),A=n.n(T),M=n(380),w=n.n(M),S=n(352),x=n(372),C=[d.a.CHECKBOX,d.a.SWITCH],P=function(e){var t=e.originalComponent,n=e.isEditable,a=void 0===n||n,o=j()(e,["originalComponent","isEditable"]),r=x.b,u={},l=Object(c.useContext)(w.a).componentMapper;return Object(c.useContext)(S.a).editing[o.name]||C.includes(t)?r=l[t]:a&&(u={isEditable:!0}),s.a.createElement(r,i()({},o,u))};P.propTypes={originalComponent:A.a.string,name:A.a.string,isEditable:A.a.bool};var V=P;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return s.a.createElement(l.a,i()({FormTemplate:v.a,componentMapper:D(D(D({},O.a),E.mapperExtension),{},{"edit-field":V,"switch-field":O.a[d.a.SWITCH]}),validatorMapper:{"required-validator":g.a[f.a.REQUIRED],"pattern-validator":g.a[f.a.PATTERN],"min-length-validator":g.a[f.a.MIN_LENGTH],"url-validator":g.a[f.a.URL]}},e))}},751:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return it}));var a=n(28),i=n.n(a),o=n(40),r=n.n(o),c=n(89),s=n.n(c),u=n(73),l=n.n(u),p=n(104),d=n.n(p),m=n(0),f=n.n(m),h=n(13),g=n(31),y=n(185),v=n(15),b=n(473),O=n.n(b),E=n(480),_=n.n(E),j=n(540),T=n.n(j),A=n(541),M=n.n(A),w=n(542),S=n.n(w),x=n(543),C=n.n(x),P=n(544),V=n.n(P),k=n(347),D=n.n(k),R=n(86),N=n(485),I=n(315),F=n.n(I),q=n(317),B=n.n(q),L=n(29),G=n(45),z=n(545),U=n(319),W=n.n(U),Q=n(11),Y=n.n(Q),H=n(316),K=n.n(H),J=function(e){var t=e.modifiedValues,n=K()(),a=W()(n.getState().values,"application.application_type_id",""),i=Object(m.useState)(a),o=r()(i,2),c=o[0],s=o[1];return Object(m.useEffect)((function(){if(c!==a){var e=t&&t.authentication?t.authentication:void 0;n.batch((function(){n.change("authentication",e),n.change("selectedAuthentication",void 0)})),s(void 0)}}),[a]),null};J.propTypes={modifiedValues:Y.a.object};var X=n(417),Z=n(84),$=n(374),ee=n(85),te=n(65),ne=n.n(te),ae=n(353),ie=function(e){var t=e.app,n=e.onCancel,a=e.container,i=Object(y.a)(),o=Object(g.useSelector)((function(e){return e.sources.appTypes})),r=Object(ae.a)(),c=Object(g.useDispatch)();Object(m.useEffect)((function(){a&&(a.hidden=!0)}),[]);var s=t.dependent_applications.map((function(e){var n=o.find((function(t){return t.name===e}));return n&&t.sourceAppsNames.includes(n.display_name)?n.display_name:void 0})).filter((function(e){return e}));return f.a.createElement($.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:n,variant:"small","aria-label":i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:f.a.createElement(ee.Title,{headingLevel:"h1",size:"2xl"},f.a.createElement(ne.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),i.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[f.a.createElement(Z.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){var e=i.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:t.display_name}),a=i.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:t.display_name});return n(),c(Object(R.i)(t.id,r.id,e,a))}},f.a.createElement(v.a,{id:"sources.remove",defaultMessage:"Remove application"})),f.a.createElement(Z.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:n},f.a.createElement(v.a,{id:"sources.cancel",defaultMessage:"Cancel"}))]},f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?",values:{appName:f.a.createElement("b",null,t.display_name)}})),s.length>0&&f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }.",values:{apps:s}}))))};ie.propTypes={app:Y.a.shape({id:Y.a.string.isRequired,display_name:Y.a.string.isRequired,dependent_applications:Y.a.arrayOf(Y.a.string),sourceAppsNames:Y.a.arrayOf(Y.a.string)}).isRequired,onCancel:Y.a.func.isRequired,container:Y.a.instanceOf(Element)};var oe=ie,re=n(323),ce=n(324),se=function(e){var t=e.setApplicationToRemove,n=e.breakpoints,a=e.namePrefix,i=Object(g.useSelector)((function(e){return e.sources.appTypes})),o=Object(ae.a)(),r=o.applications.map((function(e){var t=e.application_type_id,n=i.find((function(e){return e.id===t}));return n?n.display_name:void 0}));return o.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=i.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var i=e.display_name,o=e.id,c=e.dependent_applications;return f.a.createElement(G.TextContent,{key:o},f.a.createElement(re.Grid,null,f.a.createElement(ce.GridItem,{md:n.display_name||4},f.a.createElement(L.Text,{component:L.TextVariants.p,style:{marginBottom:0}},a,i)),f.a.createElement(ce.GridItem,{md:n.remove||8,className:"ins-c-sources__remove-app"},f.a.createElement(Z.Button,{variant:Z.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:o,display_name:i,dependent_applications:c,sourceAppsNames:r})}},f.a.createElement(v.a,{id:"sources.remove",defaultMessage:"Remove"})))))}))};se.propTypes={setApplicationToRemove:Y.a.func.isRequired,breakpoints:Y.a.shape({display_name:Y.a.number,remove:Y.a.number}),namePrefix:Y.a.node},se.defaultProps={breakpoints:{}};var ue=se,le=function(e){var t=e.container,n=Object(m.useState)({}),a=r()(n,2),i=a[0],o=a[1],c=Object(g.useSelector)((function(e){return e.sources.sourceTypes})),s=Object(ae.a)(),u=c.find((function(e){return e.id===s.source_type_id})),l=s.applications.filter((function(e){return!e.isDeleting}));return f.a.createElement(f.a.Fragment,null,i.id&&f.a.createElement(oe,{app:i,onCancel:function(){return t&&(t.hidden=!1),o({})},container:t}),f.a.createElement(G.TextContent,null,f.a.createElement(X.Grid,{hasGutter:!0},f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.h4},f.a.createElement(v.a,{id:"sources.sourceName",defaultMessage:"Source name"}))),f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.h4},f.a.createElement(v.a,{id:"sources.type",defaultMessage:"Type"}))),f.a.createElement(X.GridItem,{md:8},f.a.createElement(L.Text,{component:L.TextVariants.h4},f.a.createElement(v.a,{id:"sources.apps",defaultMessage:"Applications"}))),f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.p},s.name)),f.a.createElement(X.GridItem,{md:2},f.a.createElement(L.Text,{component:L.TextVariants.p},u?u.product_name:f.a.createElement(v.a,{id:"sources.typeNotFound",defaultMessage:"Type not found"}))),f.a.createElement(X.GridItem,{md:8},l.length>0?f.a.createElement(ue,{setApplicationToRemove:o}):f.a.createElement(v.a,{id:"sources.noApps",defaultMessage:"No applications"})))))};le.propTypes={container:Y.a.instanceOf(Element)};var pe=le,de=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:F.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:B.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,o=n.authtype;if(o)return a.find((function(e){return e.authtype===o}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(o)}}},me=n(2),fe=n.n(me);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=function(e,t,n,a,o){var r,c=i()(n),s=e.schema.authentication.find((function(e){return e.type===a})),u="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),l=z.shouldSkipEndpoint(e.name,a,t.name),p=z.hasCustomSteps(e.name,a,t.name);r=z.getAdditionalSteps(e.name,a,t.name).length>0?u:0!==n.length||l?"summary":"".concat(e.name,"-endpoint");var d=z.getAdditionalStepKeys(e.name,a,t.name),m={};if(z.shouldSkipSelection(e.name,a,t.name)){var f=z.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),h=z.getAdditionalStepFields(s.fields,u);r=f.nextStep?f.nextStep:0!==n.length||l||p?"summary":"".concat(e.name,"-endpoint"),m=ge(ge({},f),{},{fields:[].concat(i()(c),i()(z.injectAuthFieldsInfo([].concat(i()(f.fields),i()(h)),e.name,a,t.name)))})}return ge({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:o.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(i()(c),i()(z.getAdditionalAuthFields(e.name,a,t.name)),i()(z.injectAuthFieldsInfo(z.getNoStepsFields(s.fields,d),e.name,a,t.name))),nextStep:r},m)};function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oe=function(e){var t=e.authenticationValues,n=e.modifiedValues,a=K()(),i=a.getState().values.selectedAuthentication,o=Object(m.useState)(i),c=r()(o,2),s=c[0],u=c[1];return Object(m.useEffect)((function(){s!==i&&(!function(e){var t=e.formOptions,n=e.modifiedValues,a=e.authenticationValues,i=e.selectedAuthentication;if(i.startsWith("new-")){var o=i.replace("new-","");n&&n.authentication?t.change("authentication",be(be({},n.authentication),{},{authtype:o})):t.change("authentication",{authtype:o})}else{var r=a.find((function(e){return e.id===i}));if(n&&n.authentication){var c=O()(_()(r),n.authentication);t.change("authentication",c)}else t.change("authentication",r)}}({formOptions:a,authenticationValues:t,modifiedValues:n,selectedAuthentication:i}),u(void 0))}),[i]),null};Oe.propTypes={authenticationValues:Y.a.arrayOf(Y.a.object),modifiedValues:Y.a.object};var Ee=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName;return f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new.",values:{applicationTypeName:t,authenticationTypeName:n}})))};Ee.propTypes={applicationTypeName:Y.a.string,authenticationTypeName:Y.a.string};var _e=function(e){var t=e.source,n=e.authenticationValues,a=e.applicationTypes,i=e.supportedAuthTypeName,o=e.supportedAuthType;return n.filter((function(e){return e.authtype===o})).map((function(e){var n=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),o=n&&n.application_type_id?a.find((function(e){return e.id===n.application_type_id})):"",r=e.username?"-".concat(e.username):"",c=o?"-".concat(o.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(r).concat(c),value:e.id}}))},je=function(e){var t=e.intl,n=e.source,a=e.authenticationValues,o=e.sourceType,r=e.applicationTypes,c=e.modifiedValues,s=[{component:"description",name:"authtypesetter",Content:Oe,authenticationValues:a,hideField:!0,modifiedValues:c}];return r.forEach((function(e){var c,u=e.supported_source_types.includes(o.name),l=!(null===(c=n.applications)||void 0===c?void 0:c.find((function(t){return t.application_type_id===e.id})));if(u&&l){var p=W()(e,"supported_authentication_types[".concat(o.name,"]"),[]);p.forEach((function(c){if(a.find((function(e){return e.authtype===c}))){var u=W()(o,"schema.authentication",{}).find((function(e){return e.type===c})).name;s.push({component:F.a.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{and:[{when:"application.application_type_id",is:e.id}].concat(i()(p.length>1?[{when:"authtype",is:c}]:[]))},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:Ee,applicationTypeName:e.display_name,authenticationTypeName:u},{component:F.a.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:B.a.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new-".concat(c)}].concat(i()(_e({authenticationValues:a,source:n,applicationTypes:r,supportedAuthTypeName:u,supportedAuthType:c})))}]})}}))}})),{name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:s,nextStep:function(e){var t=e.values,n=t.application,a=t.authtype,i=t.authentication,r=n||{},c=r.application_type_id?r.application_type_id:"";return"".concat(o.name,"-").concat(c,"-").concat(a||(null==i?void 0:i.authtype))}}},Te=function(){return f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source."})))},Ae=function(){return f.a.createElement(G.TextContent,null,f.a.createElement(L.Text,{component:L.TextVariants.p},f.a.createElement(v.a,{id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===W()(t,"supported_authentication_types.".concat(n,"[0]"))}))},we=function(e,t){var n;return e.supported_source_types.includes(t.name)&&(null===(n=e.supported_authentication_types[t.name])||void 0===n?void 0:n.length)>1},Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=e.length>0,l=u?"summary":void 0,p=[],d=n.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&u){var m=d.schema.endpoint.hidden?d.schema.endpoint.fields:[],f=0===m.length;a.forEach((function(e){e.supported_source_types.includes(d.name)&&e.supported_authentication_types[d.name].forEach((function(n){p.push(ye(d,e,m,n,t))}))})),d.schema.authentication.forEach((function(e){a.forEach((function(t){if(t.supported_source_types.includes(d.name)){var n=z.getAdditionalSteps(d.name,e.type,t.name);n.length>0&&p.push.apply(p,i()(z.createAdditionalSteps(n,d.name,e.type,f,e.fields,t.name)))}}))})),f&&p.push(z.createEndpointStep(d.schema.endpoint,d.name)),l=function(e){var t=e.values.application;if(t){var n,i=a.find((function(e){return e.id===t.application_type_id}));if((null==i||null===(n=i.supported_authentication_types[d.name])||void 0===n?void 0:n.length)>1)return"selectAuthType-".concat(t.application_type_id);if(Me(o,a.find((function(e){return e.id===t.application_type_id})),d.name))return"selectAuthentication";var r=null==i?void 0:i.supported_authentication_types[d.name][0];return"".concat(d.name,"-").concat(t&&t.application_type_id,"-").concat(r)}}}var h=u?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:B.a.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:B.a.REQUIRED}],Content:Te},g=a.filter((function(e){return we(e,d)})).map((function(e){return de(d,e,t,o)}));return!r.imported&&u&&g.push(je({intl:t,source:r,authenticationValues:o,sourceType:d,applicationTypes:a,modifiedValues:c})),{fields:[{component:F.a.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,container:s,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication","authtype"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:u?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:l,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),name:"selectAppStep",fields:[{component:"description",name:"description",Content:pe,container:s},h,{component:"description",name:"authtypesetter",Content:J,hideField:!0,modifiedValues:c}]},{title:t.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:Ae},{component:"summary",name:"summary",sourceTypes:n,applicationTypes:a}]}].concat(i()(g),p)}]}},xe=n(546),Ce=function(e){var t=e.step,n=e.goToSources,a=Object(y.a)();return f.a.createElement(xe.Wizard,{isOpen:!0,onClose:n,title:a.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:a.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};Ce.propTypes={step:Q.PropTypes.node.isRequired,goToSources:Q.PropTypes.func.isRequired};var Pe=Ce,Ve=n(17),ke=n(377),De=n(97),Re=n(87),Ne=n(66),Ie=n.n(Ne),Fe=n(186),qe=n.n(Fe),Be=n(742),Le=n(483),Ge=n(373),ze=n(550),Ue=n.n(ze),We=n(135);function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var He=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===qe()(t[n])?Ue()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},Ke=function(){var e=d()(l.a.mark((function e(t,n,a,i){var o,c,s,u,p,d,m,f,h,g,y,v,b,E,j,T,A,M,w,S,x,C,P,V,k,D,R,N,I,F,q,B,L,G,z,U;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.getState(),c=o.values,s=c.authentication?c.authentication.id:void 0,u=s?a.find((function(e){return e.id===s})):void 0,p=t.authentication,d=Ie()(t,["authentication"]),m=Object(Be.addedDiff)(i,d),f=Object(Be.updatedDiff)(i,d),h=Object(Be.addedDiff)(u,p),g=Object(Be.updatedDiff)(u,p),y=He(Ye(Ye({},O()(_()(m),f)),{},{authentication:Ye({},O()(_()(h),g))})),e.prev=10,c.source&&c.source.id){e.next=13;break}throw"Missing source id";case 13:if(v=c.source.id,b=c.endpoint?c.endpoint.id:void 0,E=[],y.source&&!Ue()(y.source)?E.push(Object(Ve.j)().updateSource(v,y.source)):E.push(Promise.resolve(void 0)),j=y.endpoint&&!Ue()(y.endpoint),T=y.url&&!Ue()(y.url),!j&&!T){e.next=35;break}if(A=Object(We.b)(y),M=A.scheme,w=A.host,S=A.port,x=A.path,C=parseInt(S,10),P=He(Ye(Ye({},y.endpoint),{},{scheme:M,host:w,port:isNaN(C)?void 0:C,path:x})),!b){e.next=27;break}E.push(Object(Ve.j)().updateEndpoint(b,P)),e.next=33;break;case 27:return E.push(Promise.resolve(void 0)),V=Ye(Ye({},P),{},{default:!0,source_id:v}),e.next=31,Object(Ve.j)().createEndpoint(V);case 31:k=e.sent,b=k.id;case 33:e.next=36;break;case 35:E.push(Promise.resolve(void 0));case 36:return y.authentication&&!Ue()(y.authentication)?s?E.push(Object(Ve.j)().updateAuthentication(s,y.authentication)):b&&(D=Ye(Ye({},y.authentication),{},{resource_id:b,resource_type:"Endpoint"}),E.push(Object(Ve.j)().createAuthentication(D))):E.push(Promise.resolve(void 0)),y.application&&y.application.application_type_id?E.push(Object(Ve.b)(v,y.application.application_type_id)):E.push(Promise.resolve(void 0)),e.next=40,Promise.all(E);case 40:return R=e.sent,N=r()(R,4),N[0],N[1],I=N[2],F=N[3],q=s||(I?I.id:void 0),B=[],F&&F.id&&q&&(L={application_id:F.id,authentication_id:q},B.push(Object(Ve.j)().createAuthApp(L))),(y.credentials||y.billing_source)&&(G=y.credentials,z=y.billing_source,U={},U=G?{authentication:{credentials:G}}:{},U=z?Ye(Ye({},U),{},{billing_source:z}):U,B.push(Object(Le.patchSource)(Ye({id:v},U)))),e.next=53,Promise.all(B);case 53:e.next=61;break;case 55:return e.prev=55,e.t0=e.catch(10),e.next=59,Object(Ge.handleError)(e.t0);case 59:throw e.sent;case 61:case"end":return e.stop()}}),e,null,[[10,55]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),Je=n(443);function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){fe()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},et=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,o=t.initialValues,r=t.error,c=t.values;switch(n){case"setSourceAppslength":return Ze(Ze({},e),{},{sourceAppsLength:a});case"loadAuthentications":return Ze(Ze({},e),{},{authenticationsValues:i,initialValues:o,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return Ze(Ze({},e),{},{initialValues:o,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return Ze(Ze({},e),{},{state:"wizard"});case"submit":return Ze(Ze({},e),{},{state:"submitting"});case"finish":return Ze(Ze({},e),{},{state:"finished"});case"error":return Ze(Ze({},e),{},{state:"errored",error:r,values:c});case"toggleCancelling":return Ze(Ze({},e),{},{isCancelling:!e.isCancelling},c&&{values:c});default:return e}},tt=n(61),nt=void 0,at=function(e){var t=e.values.application;return nt=t},it=function(e,t,n,a,i,o,r){return i({type:"submit"}),Ke(e,t,n,o,i,r).then(d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Je.a)(o.source.id),e.next=3,a(Object(R.f)());case 3:return nt=void 0,e.abrupt("return",i({type:"finish"}));case 5:case"end":return e.stop()}}),e)})))).catch((function(t){return i({type:"error",error:t,values:e})}))},ot=function(e){return f.a.createElement(D.a,s()({},e,{showFormControls:!1}))};t.default=function(){var e=Object(y.a)(),t=Object(h.f)(),n=Object(ke.a)(),a=Object(g.useSelector)((function(e){return e.sources}),g.shallowEqual),o=a.appTypes,c=a.sourceTypesLoaded,s=a.appTypesLoaded,u=a.sourceTypes,l=Object(ae.a)(),p=Object(g.useDispatch)(),d=Object(m.useReducer)(et,$e),b=r()(d,2),E=b[0],j=b[1],A=Object(m.useRef)(document.createElement("div"));Object(m.useEffect)((function(){nt=void 0}),[]),Object(m.useEffect)((function(){if(l){var e=E.sourceAppsLength>=l.applications.length&&E.sourceAppsLength>0;j({type:"setSourceAppslength",length:l.applications.length}),e||(l.endpoints&&l.endpoints[0]?Object(Ve.j)().listEndpointAuthentications(l.endpoints[0].id).then((function(e){var t=e.data;return j({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:l,endpoint:l.endpoints[0],url:Object(De.b)(l.endpoints[0]),application:nt},values:{}})})):j({type:"loadWithoutAuthentications",initialValues:{source:l,application:nt},values:{}}))}}),[l]);var w=function(){return t.push(Re.c.sources.path)};if(!(s&&c&&n&&"loading"!==E.state||"submitting"===E.state))return f.a.createElement(Pe,{goToSources:w,step:f.a.createElement(S.a,{customText:e.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:f.a.createElement(v.a,{id:"sources.cancel",defaultMessage:"Cancel"})})});if("submitting"===E.state)return f.a.createElement(Pe,{goToSources:w,step:f.a.createElement(S.a,{cancelTitle:f.a.createElement(v.a,{id:"sources.cancel",defaultMessage:"Cancel"}),customText:f.a.createElement(v.a,{id:"wizard.loadingText",defaultMessage:"Validating source credentials"})})});var x=function(){return j({type:"reset"})};if("wizard"!==E.state){var P="finished"===E.state?f.a.createElement(V.a,{title:f.a.createElement(v.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),onReset:x,onClose:w,hideSourcesButton:!0,secondaryActions:f.a.createElement(tt.Button,{variant:"link",onClick:x},f.a.createElement(v.a,{id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})),returnButtonTitle:f.a.createElement(v.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"}),successfulMessage:f.a.createElement(v.a,{id:"sources.successAddApp",defaultMessage:"Your application has been successfully added."})}):f.a.createElement(C.a,{onRetry:x,onClose:w,message:E.error,customText:f.a.createElement(v.a,{id:"sources.successAddApp",defaultMessage:"Your application has not been successfully added:"}),title:f.a.createElement(v.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),returnButtonTitle:f.a.createElement(v.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"}),retryText:f.a.createElement(v.a,{id:"sources.retry",defaultMessage:"Retry"})});return f.a.createElement(Pe,{goToSources:w,step:P})}var k=l.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),D=u.find((function(e){return e.id===l.source_type_id})),R=D&&D.name,I=o.filter((function(e){return!k.includes(e.id)&&e.supported_source_types.includes(R)})).filter(T.a),F=I.map((function(t){var n=l.applications.find((function(e){return e.application_type_id===t.id})),a="".concat(t.display_name," ").concat(n?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:a,isDisabled:!!n}})),q=Se(F,e,u,o,E.authenticationsValues,l,E.values,A.current),B=I.length>0?function(t,n){return it(t,n,E.authenticationsValues,p,j,E.initialValues,e)}:w,L=O()(_()(E.initialValues),E.values);return f.a.createElement(f.a.Fragment,null,f.a.createElement(M.a,{title:e.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:E.isCancelling,onStay:function(){A.current.hidden=!1,j({type:"toggleCancelling"})},onExit:w}),f.a.createElement(N.a,{schema:q,showFormControls:!1,onSubmit:B,onCancel:function(e){(null==e?void 0:e.application)?(A.current.hidden=!0,j({type:"toggleCancelling",values:e})):w()},initialValues:L,subscription:{values:!0},debug:at,clearedValue:null,FormTemplate:ot}))}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map