(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{300:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(295),i=a.n(n),s=a(0),r=a.n(s),o=a(3),c=a.n(o),u=a(388),p=a.n(u),l=a(44),d=a(340),m="edit-field",f=function(e){var t=e.isRequired,a=e.label,n=e.helperText,i=e.hideLabel,s=e.meta,o=e.input,c=e.type,u=e.setEdit,m=s.error,f=s.touched&&m,g=o.value;"boolean"==typeof g&&(g=g?"True":"False");var h="password"===c||o.name.includes("password")?"Click to edit":"Click to add";return r.a.createElement(d.FormGroup,{isRequired:t,label:!i&&a,fieldId:o.name,isValid:!f,helperText:n,helperTextInvalid:m,onClick:u?function(){return u(o.name)}:void 0,tabIndex:0,onKeyPress:function(e){32===e.charCode&&u&&(e.preventDefault(),u(o.name))}},r.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(u?"clickable":"")},r.a.createElement(l.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(u?"clickable":"")},r.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},g||(u?h:"")),u&&r.a.createElement(p.a,null))))};f.propTypes={label:c.a.node,isRequired:c.a.bool,helperText:c.a.node,meta:c.a.object.isRequired,FieldProvider:c.a.oneOfType([c.a.node,c.a.func]),input:c.a.shape({value:c.a.any,name:c.a.string.isRequired}).isRequired,hideLabel:c.a.bool,setEdit:c.a.func,type:c.a.string};var g=function(e){var t=e.FieldProvider,a=i()(e,["FieldProvider"]);return r.a.createElement(t,a,(function(e){return r.a.createElement(f,e)}))};g.propTypes={FieldProvider:c.a.oneOfType([c.a.node,c.a.func]).isRequired},t.b=g},386:function(e,t,a){"use strict";var n=a(311),i=a.n(n),s=a(1),r=a.n(s),o=a(0),c=a.n(o),u=a(286),p=a.n(u),l=a(338),d=a(287),m=a(300);function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){r()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a=function(e){return c.a.createElement(p.a,i()({layoutMapper:l.layoutMapper,formFieldsMapper:g({},l.formFieldsMapper,{},d.mapperExtension,{"edit-field":m.b})},e))}},414:function(e,t,a){"use strict";var n=a(0),i=a.n(n),s=a(3),r=a.n(s),o=a(30),c=a(11),u=a(26),p=a(44),l=a(78),d=a(323),m=a(324),f=a(291),g=function(e){var t=e.setApplicationToRemove,a=e.breakpoints,n=e.namePrefix,s=Object(o.useSelector)((function(e){return e.sources.appTypes})),r=Object(f.a)(),g=r.applications.map((function(e){var t=e.application_type_id,a=s.find((function(e){return e.id===t}));return a?a.display_name:void 0}));return r.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=s.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var s=e.display_name,r=e.id,o=e.dependent_applications;return i.a.createElement(p.TextContent,{key:r},i.a.createElement(d.Grid,null,i.a.createElement(m.GridItem,{md:a.display_name||4},i.a.createElement(u.Text,{component:u.TextVariants.p,style:{marginBottom:0}},n,s)),i.a.createElement(m.GridItem,{md:a.remove||8,className:"ins-c-sources__remove-app"},i.a.createElement(l.Button,{variant:l.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:r,display_name:s,dependent_applications:o,sourceAppsNames:g})}},i.a.createElement(c.a,{id:"sources.remove",defaultMessage:"Remove"})))))}))};g.propTypes={setApplicationToRemove:r.a.func.isRequired,breakpoints:r.a.shape({display_name:r.a.number,remove:r.a.number}),namePrefix:r.a.node},g.defaultProps={breakpoints:{}},t.a=g},415:function(e,t,a){"use strict";var n=a(0),i=a.n(n),s=a(3),r=a.n(s),o=a(30),c=a(280),u=a(11),p=a(26),l=a(44),d=a(78),m=a(318),f=a(317),g=a(352),h=a(350),y=a(83),v=a.n(y),b=a(45),E=a(291),T=function(e){var t=e.app,a=e.onCancel,n=Object(c.a)(),s=Object(o.useSelector)((function(e){return e.sources.appTypes})),r=Object(E.a)(),y=Object(o.useDispatch)(),T=t.dependent_applications.map((function(e){var a=s.find((function(t){return t.name===e}));return a&&t.sourceAppsNames.includes(a.display_name)?a.display_name:void 0})).filter((function(e){return e}));return i.a.createElement(h.Modal,{className:"ins-c-sources__dialog--warning",title:"Remove ".concat(t.display_name," application"),isOpen:!0,isSmall:!0,onClose:a,isFooterLeftAligned:!0,actions:[i.a.createElement(d.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){var e=n.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:t.display_name}),i=n.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:t.display_name});return a(),y(Object(b.j)(t.id,r.id,e,i))}},i.a.createElement(u.a,{id:"sources.remove",defaultMessage:"Remove"})),i.a.createElement(d.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:a},i.a.createElement(u.a,{id:"sources.cancel",defaultMessage:"Cancel"}))]},i.a.createElement(m.Split,{gutter:"md"},i.a.createElement(f.SplitItem,null,i.a.createElement(v.a,{size:"xl",className:"ins-m-alert ins-c-source__delete-icon"})),i.a.createElement(f.SplitItem,{isFilled:!0},i.a.createElement(g.Stack,{gutter:"md"},i.a.createElement(l.TextContent,null,i.a.createElement(p.Text,{component:p.TextVariants.p},i.a.createElement(u.a,{id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?",values:{appName:t.display_name}})),T.length>0&&i.a.createElement(p.Text,{component:p.TextVariants.p},i.a.createElement(u.a,{id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }.",values:{apps:T}})))))))};T.propTypes={app:r.a.shape({id:r.a.string.isRequired,display_name:r.a.string.isRequired,dependent_applications:r.a.arrayOf(r.a.string),sourceAppsNames:r.a.arrayOf(r.a.string)}).isRequired,onCancel:r.a.func.isRequired},t.a=T},712:function(e,t,a){"use strict";a.r(t),a.d(t,"onSubmit",(function(){return Fe}));var n=a(24),i=a.n(n),s=a(37),r=a.n(s),o=a(68),c=a.n(o),u=a(87),p=a.n(u),l=a(0),d=a.n(l),m=a(29),f=a(30),g=a(280),h=a(416),y=a.n(h),v=a(419),b=a.n(v),E=a(287),T=a(45),O=a(386),S=a(3),_=a.n(S),j=a(286),x=a(26),M=a(44),A=a(11),P=a(296),w=a.n(P),R=a(339),V=a(415),k=a(414),C=a(291),D=function(){var e=Object(l.useState)({}),t=r()(e,2),a=t[0],n=t[1],i=Object(f.useSelector)((function(e){return e.sources.sourceTypes})),s=Object(C.a)(),o=i.find((function(e){return e.id===s.source_type_id})),c=s.applications.filter((function(e){return!e.isDeleting}));return d.a.createElement(d.a.Fragment,null,a.id&&d.a.createElement(V.a,{app:a,onCancel:function(){return n({})}}),d.a.createElement(M.TextContent,null,d.a.createElement(R.Grid,{gutter:"md"},d.a.createElement(R.GridItem,{md:2},d.a.createElement(x.Text,{component:x.TextVariants.h4},d.a.createElement(A.a,{id:"sources.sourceName",defaultMessage:"Source name"}))),d.a.createElement(R.GridItem,{md:2},d.a.createElement(x.Text,{component:x.TextVariants.h4},d.a.createElement(A.a,{id:"sources.type",defaultMessage:"Type"}))),d.a.createElement(R.GridItem,{md:8},d.a.createElement(x.Text,{component:x.TextVariants.h4},d.a.createElement(A.a,{id:"sources.apps",defaultMessage:"Applications"}))),d.a.createElement(R.GridItem,{md:2},d.a.createElement(x.Text,{component:x.TextVariants.p},s.name)),d.a.createElement(R.GridItem,{md:2},d.a.createElement(x.Text,{component:x.TextVariants.p},o?o.product_name:d.a.createElement(A.a,{id:"sources.typeNotFound",defaultMessage:"Type not found"}))),d.a.createElement(R.GridItem,{md:8},c.length>0?d.a.createElement(k.a,{setApplicationToRemove:n}):d.a.createElement(A.a,{id:"sources.noApps",defaultMessage:"No applications"})))))},N=function(e){var t=e.formOptions,a=e.authenticationValues,n=e.modifiedValues,i=t.getState().values.selectedAuthentication,s=Object(l.useState)(i),o=r()(s,2),c=o[0],u=o[1];return Object(l.useEffect)((function(){c!==i&&(!function(e){var t=e.formOptions,a=e.modifiedValues,n=e.authenticationValues,i=e.selectedAuthentication;if("new"!==i){var s=n.find((function(e){return e.id===i}));if(a&&a.authentication){var r=y()(b()(s),a.authentication);t.change("authentication",r)}else t.change("authentication",s)}else a&&a.authentication?t.change("authentication",a.authentication):t.change("authentication",void 0)}({formOptions:t,authenticationValues:a,modifiedValues:n,selectedAuthentication:i}),u(void 0))}),[i]),null};N.propTypes={formOptions:_.a.shape({getState:_.a.func.isRequired,change:_.a.func.isRequired}).isRequired,authenticationValues:_.a.arrayOf(_.a.object),modifiedValues:_.a.object};var q=function(e){var t=e.formOptions,a=e.modifiedValues,n=w()(t.getState().values,"application.application_type_id",""),i=Object(l.useState)(n),s=r()(i,2),o=s[0],c=s[1];return Object(l.useEffect)((function(){if(o!==n){var e=a&&a.authentication?a.authentication:void 0;t.batch((function(){t.change("authentication",e),t.change("selectedAuthentication",void 0)})),c(void 0)}}),[n]),null};q.propTypes={formOptions:_.a.shape({getState:_.a.func.isRequired,change:_.a.func.isRequired}).isRequired,modifiedValues:_.a.object};var I=function(){return d.a.createElement(M.TextContent,null,d.a.createElement(x.Text,{component:x.TextVariants.p},d.a.createElement(A.a,{id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source type."})))},B=function(){return d.a.createElement(M.TextContent,null,d.a.createElement(x.Text,{component:x.TextVariants.p},d.a.createElement(A.a,{id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},F=function(e){var t=e.applicationTypeName,a=e.authenticationTypeName;return d.a.createElement(M.TextContent,null,d.a.createElement(x.Text,{component:x.TextVariants.p},d.a.createElement(A.a,{id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new.",values:{applicationTypeName:t,authenticationTypeName:a}})))};F.propTypes={applicationTypeName:_.a.string,authenticationTypeName:_.a.string};var L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===w()(t,"supported_authentication_types.".concat(a,"[0]"))}))},G=function(e){var t=e.source,a=e.authenticationValues,n=e.applicationTypes,i=e.supportedAuthTypeName,s=e.supportedAuthType;return a.filter((function(e){return e.authtype===s})).map((function(e){var a=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),s=a&&a.application_type_id?n.find((function(e){return e.id===a.application_type_id})):"",r=e.username?"-".concat(e.username):"",o=s?"-".concat(s.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(r).concat(o),value:e.id}}))},z=function(e){var t=e.intl,a=e.source,n=e.authenticationValues,s=e.sourceType,r=e.applicationTypes,o=e.modifiedValues,c=[{component:"description",name:"authtypesetter",Content:N,authenticationValues:n,hideField:!0,modifiedValues:o}];return r.forEach((function(e){var o=w()(e,"supported_authentication_types[".concat(s.name,"][0]"),"");if(o&&L(n,e,s.name)){var u=w()(s,"schema.authentication",{}).find((function(e){return e.type===o})).name;c.push({component:j.componentTypes.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{when:"application.application_type_id",is:e.id},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:F,applicationTypeName:e.display_name,authenticationTypeName:u},{component:j.componentTypes.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:j.validatorTypes.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new"}].concat(i()(G({authenticationValues:n,source:a,applicationTypes:r,supportedAuthTypeName:u,supportedAuthType:o})))}]})}})),{stepKey:"selectAuthentication",name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:c,nextStep:function(e){var t=e.values.application,a=t||{},n=a.application_type_id?a.application_type_id:"";return"".concat(s.name,"-").concat(n)}}},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,c=e.length>0,u=c?"summary":void 0,p=[],l=a.find((function(e){return e.id===r.source_type_id}));if(!r.imported&&c){var d=l.schema.endpoint.hidden?l.schema.endpoint.fields:[],m=0===d.length;n.forEach((function(e){e.supported_source_types.includes(l.name)&&p.push(E.schemaBuilder.createSpecificAuthTypeSelection(l,e,d,!1))})),l.schema.authentication.forEach((function(e){n.forEach((function(t){if(t.supported_source_types.includes(l.name)){var a=E.schemaBuilder.getAdditionalSteps(l.name,e.type,t.name);a.length>0&&p.push.apply(p,i()(E.schemaBuilder.createAdditionalSteps(a,l.name,e.type,m,e.fields,t.name)))}}))})),m&&p.push(E.schemaBuilder.createEndpointStep(l.schema.endpoint,l.name)),u=function(e){var t=e.values.application;if(t)return L(s,n.find((function(e){return e.id===t.application_type_id})),l.name)?"selectAuthentication":"".concat(l.name,"-").concat(t&&t.application_type_id)}}var f=c?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:j.validatorTypes.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:j.validatorTypes.REQUIRED}],Content:I},g=[];return!r.imported&&c&&g.push(z({intl:t,source:r,authenticationValues:s,sourceType:l,applicationTypes:n,modifiedValues:o})),{fields:[{component:j.componentTypes.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,predictSteps:!0,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:c?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:u,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),stepKey:1,name:"selectAppStep",fields:[{component:"description",name:"description",Content:D},f,{component:"description",name:"authtypesetter",Content:q,hideField:!0,modifiedValues:o}]},{title:t.formatMessage({id:"sources.review",defaultMessage:"Review"}),stepKey:"summary",name:"summary",fields:[{component:"description",name:"description-summary",Content:B},{component:"summary",name:"summary",sourceTypes:a,applicationTypes:n}]}].concat(g,p)}]}},W=a(78),Y=a(303),K=a(305),Q=a(342),J=a(80),Z=a(304),H=a(312),X=a(343),$=function(e){var t=e.onClose,a=e.customText,n=e.progressStep,i=e.progressTexts;return d.a.createElement(J.Bullseye,null,d.a.createElement(Y.EmptyState,{variant:Y.EmptyStateVariant.full,className:"ins-c-sources__empty-state"},d.a.createElement(Z.EmptyStateIcon,{icon:H.Spinner,color:"var(--pf-global--success-color--100)"}),d.a.createElement(K.EmptyStateBody,null,i?d.a.createElement(X.Progress,{value:n,min:0,max:i.length-1,title:" ",label:i[n],valueText:i[n],className:"pf-u-mb-md ins-c-sources__progress"}):a),t&&d.a.createElement(Q.EmptyStateSecondaryActions,null,d.a.createElement(W.Button,{variant:"link",onClick:t},d.a.createElement(A.a,{id:"sources.cancel",defaultMessage:"Cancel"})))))};$.propTypes={onClose:_.a.func,customText:_.a.node,progressStep:_.a.number,progressTexts:_.a.arrayOf(_.a.string)},$.defaultProps={customText:d.a.createElement(A.a,{id:"sources.loading",defaultMessage:"Loading, please wait."})};var ee=$,te=a(129),ae=a(85),ne=a.n(ae),ie=function(e){var t=e.onReset,a=e.goToSources,n=e.error,i=e.progressStep,s=e.progressTexts;return d.a.createElement(J.Bullseye,null,d.a.createElement(Y.EmptyState,{variant:Y.EmptyStateVariant.full,className:"ins-c-sources__empty-state"},d.a.createElement(Z.EmptyStateIcon,{icon:ne.a,color:"var(--pf-global--danger-color--100)"}),d.a.createElement(te.Title,{headingLevel:"h5",size:"lg"},d.a.createElement(A.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"})),d.a.createElement(K.EmptyStateBody,null,d.a.createElement(X.Progress,{className:"pf-u-mb-md ins-c-sources__progress",value:i,min:0,title:" ",max:s.length-1,label:s[i],valueText:s[i],variant:"danger"}),d.a.createElement(d.a.Fragment,null,d.a.createElement(A.a,{id:"sources.successAddApp",defaultMessage:"Your application has not been successfully added:"}),d.a.createElement("br",null),d.a.createElement(M.TextContent,null,d.a.createElement(x.Text,{component:x.TextVariants.h6},n)))),d.a.createElement(W.Button,{variant:"primary",onClick:a},d.a.createElement(A.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"})),d.a.createElement(Q.EmptyStateSecondaryActions,null,d.a.createElement(W.Button,{variant:"link",onClick:t},d.a.createElement(A.a,{id:"sources.retry",defaultMessage:"Retry"})))))};ie.propTypes={onReset:S.PropTypes.func.isRequired,goToSources:S.PropTypes.func.isRequired,error:S.PropTypes.string.isRequired,progressStep:S.PropTypes.number.isRequired,progressTexts:S.PropTypes.arrayOf(S.PropTypes.string).isRequired};var se=ie,re=a(88),oe=a.n(re),ce=function(e){var t=e.goToSources,a=e.onReset,n=e.progressStep,i=e.progressTexts;return d.a.createElement(J.Bullseye,null,d.a.createElement(Y.EmptyState,{variant:Y.EmptyStateVariant.full,className:"ins-c-sources__empty-state"},d.a.createElement(Z.EmptyStateIcon,{icon:oe.a,color:"var(--pf-global--success-color--100)"}),d.a.createElement(te.Title,{headingLevel:"h5",size:"lg"},d.a.createElement(A.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"})),d.a.createElement(K.EmptyStateBody,null,d.a.createElement(X.Progress,{className:"pf-u-mb-md ins-c-sources__progress",value:n,min:0,title:" ",max:i.length-1,label:i[n],valueText:i[n],variant:"success"}),d.a.createElement(A.a,{id:"sources.successAddApp",defaultMessage:"Your application has been successfully added."})),d.a.createElement(W.Button,{variant:"primary",onClick:t},d.a.createElement(A.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"})),d.a.createElement(Q.EmptyStateSecondaryActions,null,d.a.createElement(W.Button,{variant:"link",onClick:a},d.a.createElement(A.a,{id:"sources.continueManageApp",defaultMessage:"Continue managing applications"})))))};ce.propTypes={onReset:S.PropTypes.func.isRequired,goToSources:S.PropTypes.func.isRequired,progressStep:S.PropTypes.number.isRequired,progressTexts:S.PropTypes.arrayOf(S.PropTypes.string).isRequired};var ue=ce,pe=a(459),le=function(e){var t=e.step,a=e.goToSources,n=Object(g.a)();return d.a.createElement(pe.Wizard,{isOpen:!0,onClose:a,title:n.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:n.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};le.propTypes={step:S.PropTypes.node.isRequired,goToSources:S.PropTypes.func.isRequired};var de=le,me=a(13),fe=a(313),ge=a(84),he=a(79),ye=a(1),ve=a.n(ye),be=a(295),Ee=a.n(be),Te=a(154),Oe=a.n(Te),Se=a(703),_e=a(367),je=a.n(_e),xe=a(114),Me=function(e,t,a){var n=[],i=0;return!e.endpoint||je()(e.endpoint)||w()(t,"endpoint.id",!1)||n.push(a.formatMessage({id:"sources.authProgressEndpoint",defaultMessage:"Step { step }: creating endpoint"},{step:++i})),n.push(a.formatMessage({id:"sources.authProgressValues",defaultMessage:"Step { step }: updating values and creating application"},{step:++i})),n.push(a.formatMessage({id:"sources.authConnectingApplication",defaultMessage:"Step { step }: connecting application and authentication"},{step:++i})),n.push(a.formatMessage({id:"sources.authReloadData",defaultMessage:"Step { step }: reloading data"},{step:++i})),n.push(a.formatMessage({id:"sources.authCompleted",defaultMessage:"Completed"})),n};function Ae(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Pe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(a),!0).forEach((function(t){ve()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ae(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var we=function e(t){return Object.keys(t).forEach((function(a){t[a]&&"object"===Oe()(t[a])?je()(t[a])?delete t[a]:e(t[a]):void 0===t[a]&&delete t[a]})),t},Re=function(){var e=p()(c.a.mark((function e(t,a,n,i){var s,o,u,p,l,d,m,f,g,h,v,T,O,S,_,j,x,M,A,P,w,R,V,k,C,D,N,q,I,B,F,L,G,z,U,W,Y,K,Q=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=Q.length>4&&void 0!==Q[4]?Q[4]:function(){},o=Q.length>5&&void 0!==Q[5]?Q[5]:function(){},u=a.getState(),p=u.values,l=p.authentication?p.authentication.id:void 0,d=l?n.find((function(e){return e.id===l})):void 0,m=t.authentication,f=Ee()(t,["authentication"]),g=Object(Se.addedDiff)(i,f),h=Object(Se.updatedDiff)(i,f),v=Object(Se.addedDiff)(d,m),T=Object(Se.updatedDiff)(d,m),O=we(Pe({},y()(b()(g),h),{authentication:Pe({},y()(b()(v),T))})),s({type:"setProgressTexts",progressTexts:Me(O,p,o)}),e.prev=13,p.source&&p.source.id){e.next=16;break}throw"Missing source id";case 16:if(S=p.source.id,_=p.endpoint?p.endpoint.id:void 0,j=[],O.source&&!je()(O.source)?j.push(Object(me.j)().updateSource(S,O.source)):j.push(Promise.resolve(void 0)),x=O.endpoint&&!je()(O.endpoint),M=O.url&&!je()(O.url),!x&&!M){e.next=39;break}if(A=Object(xe.b)(O),P=A.scheme,w=A.host,R=A.port,V=A.path,k=parseInt(R,10),C=we(Pe({},O.endpoint,{scheme:P,host:w,port:isNaN(k)?void 0:k,path:V})),!_){e.next=30;break}j.push(Object(me.j)().updateEndpoint(_,C)),e.next=37;break;case 30:return j.push(Promise.resolve(void 0)),D=Pe({},C,{default:!0,source_id:S}),e.next=34,Object(me.j)().createEndpoint(D);case 34:N=e.sent,s({type:"increaseProgressStep"}),_=N.id;case 37:e.next=40;break;case 39:j.push(Promise.resolve(void 0));case 40:return O.authentication&&!je()(O.authentication)?l?j.push(Object(me.j)().updateAuthentication(l,O.authentication)):_&&(q=Pe({},O.authentication,{resource_id:_,resource_type:"Endpoint"}),j.push(Object(me.j)().createAuthentication(q))):j.push(Promise.resolve(void 0)),O.application&&O.application.application_type_id?j.push(Object(me.b)(S,O.application.application_type_id)):j.push(Promise.resolve(void 0)),e.next=44,Promise.all(j);case 44:return I=e.sent,B=r()(I,4),B[0],B[1],F=B[2],L=B[3],s({type:"increaseProgressStep"}),G=l||(F?F.id:void 0),z=[],L&&L.id&&G&&(U={application_id:L.id,authentication_id:G},z.push(Object(me.j)().createAuthApp(U))),(O.credentials||O.billing_source)&&(W=O.credentials,Y=O.billing_source,K={},K=W?{authentication:{credentials:W}}:{},K=Y?Pe({},K,{billing_source:Y}):K,z.push(Object(E.patchSource)(Pe({id:S},K)))),e.next=58,Promise.all(z);case 58:s({type:"increaseProgressStep"}),e.next=67;break;case 61:return e.prev=61,e.t0=e.catch(13),e.next=65,Object(E.handleError)(e.t0);case 65:throw e.sent;case 67:case"end":return e.stop()}}),e,null,[[13,61]])})));return function(t,a,n,i){return e.apply(this,arguments)}}(),Ve=a(488),ke=a(373);function Ce(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function De(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(a),!0).forEach((function(t){ve()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ce(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ne={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},progressStep:0,progressTexts:[]},qe=function(e,t){var a=t.type,n=t.length,i=t.authenticationsValues,s=t.initialValues,r=t.error,o=t.values,c=t.progressTexts;switch(a){case"setSourceAppslength":return De({},e,{sourceAppsLength:n});case"loadAuthentications":return De({},e,{authenticationsValues:i,initialValues:s,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return De({},e,{initialValues:s,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return De({},e,{state:"wizard"});case"submit":return De({},e,{state:"submitting",progressStep:0,progressTexts:["Preparing"]});case"finish":return De({},e,{state:"finished",progressStep:++e.progressStep});case"error":return De({},e,{state:"errored",error:r,values:o});case"setProgressTexts":return De({},e,{progressTexts:c});case"increaseProgressStep":return De({},e,{progressStep:++e.progressStep});default:return e}},Ie=void 0,Be=function(e){var t=e.values.application;return Ie=t},Fe=function(e,t,a,n,i,s,r){return i({type:"submit"}),Re(e,t,a,s,i,r).then(p()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(ke.a)(s.source.id),e.next=3,n(Object(T.g)());case 3:return Ie=void 0,e.abrupt("return",i({type:"finish"}));case 5:case"end":return e.stop()}}),e)})))).catch((function(t){return i({type:"error",error:t,values:e})}))};t.default=function(){var e=Object(g.a)(),t=Object(m.f)(),a=Object(fe.a)(),n=Object(f.useSelector)((function(e){return e.sources}),f.shallowEqual),s=n.appTypes,o=n.sourceTypesLoaded,c=n.appTypesLoaded,u=n.sourceTypes,p=n.undoValues,h=Object(C.a)(),v=Object(f.useDispatch)(),S=Object(l.useReducer)(qe,Ne),_=r()(S,2),j=_[0],x=_[1];Object(l.useEffect)((function(){Ie=void 0}),[]),Object(l.useEffect)((function(){if(h){var e=j.sourceAppsLength>=h.applications.length&&j.sourceAppsLength>0;x({type:"setSourceAppslength",length:h.applications.length}),e||(h.endpoints&&h.endpoints[0]?Object(me.j)().listEndpointAuthentications(h.endpoints[0].id).then((function(e){var t=e.data;return x({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:h,endpoint:h.endpoints[0],url:Object(ge.b)(h.endpoints[0]),application:Ie},values:{}})})):x({type:"loadWithoutAuthentications",initialValues:{source:h,application:Ie},values:{}}))}}),[h]);var M=function(){return t.push(he.c.sources.path)};if(!(c&&o&&a&&"loading"!==j.state||"submitting"===j.state))return d.a.createElement(de,{goToSources:M,step:d.a.createElement(ee,null)});if("submitting"===j.state)return d.a.createElement(de,{goToSources:M,step:d.a.createElement(ee,{progressStep:j.progressStep,progressTexts:j.progressTexts})});var P=function(){return x({type:"reset"})};if("wizard"!==j.state){var w="finished"===j.state?d.a.createElement(ue,{onReset:P,goToSources:M,progressStep:j.progressStep,progressTexts:j.progressTexts}):d.a.createElement(se,{onReset:P,goToSources:M,error:j.error,progressStep:j.progressStep,progressTexts:j.progressTexts});return d.a.createElement(de,{goToSources:M,step:w})}var R=h.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),V=u.find((function(e){return e.id===h.source_type_id})),k=V&&V.name,D=s.filter((function(e){return!R.includes(e.id)&&e.supported_source_types.includes(k)})).filter(E.filterApps),N=D.map((function(t){var a=h.applications.find((function(e){return e.application_type_id===t.id})),n="".concat(t.display_name," ").concat(a?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:n,isDisabled:!!a}})),q=y()(b()(p),j.values),I=U(N,e,u,s,j.authenticationsValues,h,q),B=D.length>0?function(t,a){return Fe(t,a,j.authenticationsValues,v,x,j.initialValues,e)}:M,F=y()(b()(j.initialValues),q);return d.a.createElement(O.a,{schema:I,showFormControls:!1,onSubmit:B,onCancel:function(a){return function(e){var t=e.values,a=e.dispatch,n=e.history,i=e.intl,s=e.sourceId;if(t&&t.application){var r=Date.now();a(Object(T.b)(i.formatMessage({id:"sources.addApplicationCanceled",defaultMessage:"Adding an application was cancelled"}),"success",d.a.createElement(A.a,{id:"sources.undoMistake",defaultMessage:"{undo} if this was a mistake.",values:{undo:d.a.createElement(Ve.a,{messageId:r,values:t,path:Object(he.b)(he.c.sourceManageApps.path,s)})}}),r))}a(Object(T.c)()),n.push(he.c.sources.path)}({values:a,dispatch:v,intl:e,sourceId:h.id,history:t})},initialValues:F,subscription:{values:!0},onStateUpdate:Be,clearedValue:null})}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map