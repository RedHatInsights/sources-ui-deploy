(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{299:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(295),i=a.n(n),r=a(0),o=a.n(r),s=a(3),c=a.n(s),u=a(383),l=a.n(u),p=a(44),d=a(338),m="edit-field",f=function(e){var t=e.isRequired,a=e.label,n=e.helperText,i=e.hideLabel,r=e.meta,s=e.input,c=e.type,u=e.setEdit,m=r.error,f=r.touched&&m,h=s.value;"boolean"==typeof h&&(h=h?"True":"False");var y="password"===c||s.name.includes("password")?"Click to edit":"Click to add";return o.a.createElement(d.FormGroup,{isRequired:t,label:!i&&a,fieldId:s.name,isValid:!f,helperText:n,helperTextInvalid:m,onClick:u?function(){return u(s.name)}:void 0,tabIndex:0,onKeyPress:function(e){32===e.charCode&&u&&(e.preventDefault(),u(s.name))}},o.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(u?"clickable":"")},o.a.createElement(p.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(u?"clickable":"")},o.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},h||(u?y:"")),u&&o.a.createElement(l.a,null))))};f.propTypes={label:c.a.node,isRequired:c.a.bool,helperText:c.a.string,meta:c.a.object.isRequired,FieldProvider:c.a.oneOfType([c.a.node,c.a.func]),input:c.a.shape({value:c.a.any,name:c.a.string.isRequired}).isRequired,hideLabel:c.a.bool,setEdit:c.a.func,type:c.a.string};var h=function(e){var t=e.FieldProvider,a=i()(e,["FieldProvider"]);return o.a.createElement(t,a,(function(e){return o.a.createElement(f,e)}))};h.propTypes={FieldProvider:c.a.oneOfType([c.a.node,c.a.func]).isRequired},t.b=h},382:function(e,t,a){"use strict";var n=a(310),i=a.n(n),r=a(1),o=a.n(r),s=a(0),c=a.n(s),u=a(286),l=a.n(u),p=a(337),d=a(290),m=a(299);function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.a=function(e){return c.a.createElement(l.a,i()({layoutMapper:p.layoutMapper,formFieldsMapper:h({},p.formFieldsMapper,{},d.mapperExtension,{"edit-field":m.b})},e))}},409:function(e,t,a){"use strict";var n=a(0),i=a.n(n),r=a(3),o=a.n(r),s=a(30),c=a(11),u=a(26),l=a(44),p=a(78),d=a(319),m=a(320),f=a(294),h=function(e){var t=e.setApplicationToRemove,a=e.breakpoints,n=e.namePrefix,r=Object(s.useSelector)((function(e){return e.sources.appTypes})),o=Object(f.a)(),h=o.applications.map((function(e){var t=e.application_type_id,a=r.find((function(e){return e.id===t}));return a?a.display_name:void 0}));return o.applications.filter((function(e){return!e.isDeleting})).map((function(e){var t=r.find((function(t){return t.id===e.application_type_id}));if(t)return{display_name:t.display_name,id:e.id,dependent_applications:t.dependent_applications}})).sort((function(e,t){return e.display_name.localeCompare(t.display_name)})).map((function(e){var r=e.display_name,o=e.id,s=e.dependent_applications;return i.a.createElement(l.TextContent,{key:o},i.a.createElement(d.Grid,null,i.a.createElement(m.GridItem,{md:a.display_name||4},i.a.createElement(u.Text,{component:u.TextVariants.p,style:{marginBottom:0}},n,r)),i.a.createElement(m.GridItem,{md:a.remove||8,className:"ins-c-sources__remove-app"},i.a.createElement(p.Button,{variant:p.ButtonVariant.link,isInline:!0,onClick:function(){return t({id:o,display_name:r,dependent_applications:s,sourceAppsNames:h})}},i.a.createElement(c.a,{id:"sources.remove",defaultMessage:"Remove"})))))}))};h.propTypes={setApplicationToRemove:o.a.func.isRequired,breakpoints:o.a.shape({display_name:o.a.number,remove:o.a.number}),namePrefix:o.a.node},h.defaultProps={breakpoints:{}},t.a=h},410:function(e,t,a){"use strict";var n=a(0),i=a.n(n),r=a(3),o=a.n(r),s=a(30),c=a(280),u=a(11),l=a(26),p=a(44),d=a(78),m=a(336),f=a(335),h=a(349),y=a(347),g=a(85),v=a.n(g),b=a(45),E=a(294),T=function(e){var t=e.app,a=e.onCancel,n=Object(c.a)(),r=Object(s.useSelector)((function(e){return e.sources.appTypes})),o=Object(E.a)(),g=Object(s.useDispatch)(),T=t.dependent_applications.map((function(e){var a=r.find((function(t){return t.name===e}));return a&&t.sourceAppsNames.includes(a.display_name)?a.display_name:void 0})).filter((function(e){return e}));return i.a.createElement(y.Modal,{className:"ins-c-sources__dialog--warning",title:"Remove ".concat(t.display_name," application"),isOpen:!0,isSmall:!0,onClose:a,isFooterLeftAligned:!0,actions:[i.a.createElement(d.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){var e=n.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:t.display_name}),i=n.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:t.display_name});return a(),g(Object(b.j)(t.id,o.id,e,i))}},i.a.createElement(u.a,{id:"sources.remove",defaultMessage:"Remove"})),i.a.createElement(d.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:a},i.a.createElement(u.a,{id:"sources.cancel",defaultMessage:"Cancel"}))]},i.a.createElement(m.Split,{gutter:"md"},i.a.createElement(f.SplitItem,null,i.a.createElement(v.a,{size:"xl",className:"ins-m-alert ins-c-source__delete-icon"})),i.a.createElement(f.SplitItem,{isFilled:!0},i.a.createElement(h.Stack,{gutter:"md"},i.a.createElement(p.TextContent,null,i.a.createElement(l.Text,{component:l.TextVariants.p},i.a.createElement(u.a,{id:"sources.deleteAppWarning",defaultMessage:"Are you sure to remove { appName } from this source?",values:{appName:t.display_name}})),T.length>0&&i.a.createElement(l.Text,{component:l.TextVariants.p},i.a.createElement(u.a,{id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }.",values:{apps:T}})))))))};T.propTypes={app:o.a.shape({id:o.a.string.isRequired,display_name:o.a.string.isRequired,dependent_applications:o.a.arrayOf(o.a.string),sourceAppsNames:o.a.arrayOf(o.a.string)}).isRequired,onCancel:o.a.func.isRequired},t.a=T},705:function(e,t,a){"use strict";a.r(t),a.d(t,"onSubmit",(function(){return Be}));var n=a(24),i=a.n(n),r=a(37),o=a.n(r),s=a(1),c=a.n(s),u=a(68),l=a.n(u),p=a(87),d=a.n(p),m=a(0),f=a.n(m),h=a(29),y=a(30),g=a(280),v=a(414),b=a.n(v),E=a(417),T=a.n(E),O=a(290),_=a(45),S=a(382),j=a(3),A=a.n(j),M=a(286),x=a(26),w=a(44),R=a(11),C=a(300),k=a.n(C),V=a(449),P=a(410),D=a(409),q=a(294),N=function(){var e=Object(m.useState)({}),t=o()(e,2),a=t[0],n=t[1],i=Object(y.useSelector)((function(e){return e.sources.sourceTypes})),r=Object(q.a)(),s=i.find((function(e){return e.id===r.source_type_id})),c=r.applications.filter((function(e){return!e.isDeleting}));return f.a.createElement(f.a.Fragment,null,a.id&&f.a.createElement(P.a,{app:a,onCancel:function(){return n({})}}),f.a.createElement(w.TextContent,null,f.a.createElement(V.Grid,{gutter:"md"},f.a.createElement(V.GridItem,{md:2},f.a.createElement(x.Text,{component:x.TextVariants.h4},f.a.createElement(R.a,{id:"sources.sourceName",defaultMessage:"Source name"}))),f.a.createElement(V.GridItem,{md:2},f.a.createElement(x.Text,{component:x.TextVariants.h4},f.a.createElement(R.a,{id:"sources.type",defaultMessage:"Type"}))),f.a.createElement(V.GridItem,{md:8},f.a.createElement(x.Text,{component:x.TextVariants.h4},f.a.createElement(R.a,{id:"sources.apps",defaultMessage:"Applications"}))),f.a.createElement(V.GridItem,{md:2},f.a.createElement(x.Text,{component:x.TextVariants.p},r.name)),f.a.createElement(V.GridItem,{md:2},f.a.createElement(x.Text,{component:x.TextVariants.p},s?s.product_name:f.a.createElement(R.a,{id:"sources.typeNotFound",defaultMessage:"Type not found"}))),f.a.createElement(V.GridItem,{md:8},c.length>0?f.a.createElement(D.a,{setApplicationToRemove:n}):f.a.createElement(R.a,{id:"sources.noApps",defaultMessage:"No applications"})))))},I=function(e){var t=e.formOptions,a=e.authenticationValues,n=e.modifiedValues,i=t.getState().values.selectedAuthentication,r=Object(m.useState)(i),s=o()(r,2),c=s[0],u=s[1];return Object(m.useEffect)((function(){c!==i&&(!function(e){var t=e.formOptions,a=e.modifiedValues,n=e.authenticationValues,i=e.selectedAuthentication;if("new"!==i){var r=n.find((function(e){return e.id===i}));if(a&&a.authentication){var o=b()(T()(r),a.authentication);t.change("authentication",o)}else t.change("authentication",r)}else a&&a.authentication?t.change("authentication",a.authentication):t.change("authentication",void 0)}({formOptions:t,authenticationValues:a,modifiedValues:n,selectedAuthentication:i}),u(void 0))}),[i]),null};I.propTypes={formOptions:A.a.shape({getState:A.a.func.isRequired,change:A.a.func.isRequired}).isRequired,authenticationValues:A.a.arrayOf(A.a.object),modifiedValues:A.a.object};var B=function(e){var t=e.formOptions,a=e.modifiedValues,n=k()(t.getState().values,"application.application_type_id",""),i=Object(m.useState)(n),r=o()(i,2),s=r[0],c=r[1];return Object(m.useEffect)((function(){if(s!==n){var e=a&&a.authentication?a.authentication:void 0;t.batch((function(){t.change("authentication",e),t.change("selectedAuthentication",void 0)})),c(void 0)}}),[n]),null};B.propTypes={formOptions:A.a.shape({getState:A.a.func.isRequired,change:A.a.func.isRequired}).isRequired,modifiedValues:A.a.object};var F=function(){return f.a.createElement(w.TextContent,null,f.a.createElement(x.Text,{component:x.TextVariants.p},f.a.createElement(R.a,{id:"sources.allApplicationsAssigned",defaultMessage:"All available applications have already been added to this source or there is no available application for this source type."})))},L=function(){return f.a.createElement(w.TextContent,null,f.a.createElement(x.Text,{component:x.TextVariants.p},f.a.createElement(R.a,{id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},z=function(e){var t=e.applicationTypeName,a=e.authenticationTypeName;return f.a.createElement(w.TextContent,null,f.a.createElement(x.Text,{component:x.TextVariants.p},f.a.createElement(R.a,{id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new.",values:{applicationTypeName:t,authenticationTypeName:a}})))};z.propTypes={applicationTypeName:A.a.string,authenticationTypeName:A.a.string};var G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===k()(t,"supported_authentication_types.".concat(a,"[0]"))}))},U=function(e){var t=e.source,a=e.authenticationValues,n=e.applicationTypes,i=e.supportedAuthTypeName,r=e.supportedAuthType;return a.filter((function(e){return e.authtype===r})).map((function(e){var a=t.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),r=a&&a.application_type_id?n.find((function(e){return e.id===a.application_type_id})):"",o=e.username?"-".concat(e.username):"",s=r?"-".concat(r.display_name):"-unused-".concat(e.id);return{label:"".concat(i).concat(o).concat(s),value:e.id}}))},Y=function(e){var t=e.intl,a=e.source,n=e.authenticationValues,r=e.sourceType,o=e.applicationTypes,s=e.modifiedValues,c=[{component:"description",name:"authtypesetter",Content:I,authenticationValues:n,hideField:!0,modifiedValues:s}];return o.forEach((function(e){var s=k()(e,"supported_authentication_types[".concat(r.name,"][0]"),"");if(s&&G(n,e,r.name)){var u=k()(r,"schema.authentication",{}).find((function(e){return e.type===s})).name;c.push({component:M.componentTypes.SUB_FORM,name:"".concat(e.name,"-subform"),condition:{when:"application.application_type_id",is:e.id},fields:[{name:"".concat(e.name,"-select-authentication-summary"),component:"description",Content:z,applicationTypeName:e.display_name,authenticationTypeName:u},{component:M.componentTypes.RADIO,name:"selectedAuthentication",label:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:M.validatorTypes.REQUIRED}],options:[{label:t.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:u}),value:"new"}].concat(i()(U({authenticationValues:n,source:a,applicationTypes:o,supportedAuthTypeName:u,supportedAuthType:s})))}]})}})),{stepKey:"selectAuthentication",name:"selectAuthentication",title:t.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:c,nextStep:function(e){var t=e.values.application,a=t||{},n=a.application_type_id?a.application_type_id:"";return"".concat(r.name,"-").concat(n)}}},K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=e.length>0,u=c?"summary":void 0,l=[],p=a.find((function(e){return e.id===o.source_type_id}));if(!o.imported&&c){var d=p.schema.endpoint.hidden?p.schema.endpoint.fields:[],m=0===d.length;n.forEach((function(e){e.supported_source_types.includes(p.name)&&l.push(O.schemaBuilder.createSpecificAuthTypeSelection(p,e,d,!1))})),p.schema.authentication.forEach((function(e){n.forEach((function(t){if(t.supported_source_types.includes(p.name)){var a=O.schemaBuilder.getAdditionalSteps(p.name,e.type,t.name);a.length>0&&l.push.apply(l,i()(O.schemaBuilder.createAdditionalSteps(a,p.name,e.type,m,e.fields,t.name)))}}))})),m&&l.push(O.schemaBuilder.createEndpointStep(p.schema.endpoint,p.name)),u=function(e){var t=e.values.application;if(t)return G(r,n.find((function(e){return e.id===t.application_type_id})),p.name)?"selectAuthentication":"".concat(p.name,"-").concat(t&&t.application_type_id)}}var f=c?{component:"card-select",name:"application.application_type_id",options:e,label:t.formatMessage({id:"sources.chooseAppToAdd",defaultMessage:"Choose an application to add"}),DefaultIcon:null,isRequired:!0,validate:[{type:M.validatorTypes.REQUIRED}]}:{component:"description",name:"description-no-options",validate:[{type:M.validatorTypes.REQUIRED}],Content:F},h=[];return!o.imported&&c&&h.push(Y({intl:t,source:o,authenticationValues:r,sourceType:p,applicationTypes:n,modifiedValues:s})),{fields:[{component:M.componentTypes.WIZARD,name:"wizard",title:t.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),inModal:!0,predictSteps:!0,showTitles:!0,crossroads:["application.application_type_id","selectedAuthentication"],description:t.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),buttonLabels:{submit:c?t.formatMessage({id:"sources.add",defaultMessage:"Add"}):t.formatMessage({id:"sources.close",defaultMessage:"Close"}),cancel:t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:t.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[{nextStep:u,title:t.formatMessage({id:"sources.selectApp",defaultMessage:"Select application"}),stepKey:1,name:"selectAppStep",fields:[{component:"description",name:"description",Content:N},f,{component:"description",name:"authtypesetter",Content:B,hideField:!0,modifiedValues:s}]},{title:t.formatMessage({id:"sources.review",defaultMessage:"Review"}),stepKey:"summary",name:"summary",fields:[{component:"description",name:"description-summary",Content:L},{component:"summary",name:"summary",sourceTypes:a,applicationTypes:n}]}].concat(h,l)}]}},W=a(78),Q=a(303),J=a(304),Z=a(340),H=a(80),X=a(323),$=function(e){var t=e.onClose,a=e.customText;return f.a.createElement(H.Bullseye,null,f.a.createElement(Q.EmptyState,{variant:Q.EmptyStateVariant.full},f.a.createElement(X.Spinner,null),f.a.createElement(J.EmptyStateBody,null,a),t&&f.a.createElement(Z.EmptyStateSecondaryActions,null,f.a.createElement(W.Button,{variant:"link",onClick:t},f.a.createElement(R.a,{id:"sources.cancel",defaultMessage:"Cancel"})))))};$.propTypes={onClose:A.a.func,customText:A.a.node},$.defaultProps={customText:f.a.createElement(R.a,{id:"sources.loading",defaultMessage:"Loading, please wait."})};var ee=$,te=a(311),ae=a(129),ne=a(84),ie=a.n(ne),re=function(e){var t=e.onClose,a=e.onRetry,n=e.message,i=e.title;return f.a.createElement(H.Bullseye,null,f.a.createElement(Q.EmptyState,{variant:Q.EmptyStateVariant.full},f.a.createElement(te.EmptyStateIcon,{icon:ie.a,color:"var(--pf-global--danger-color--100)"}),f.a.createElement(ae.Title,{headingLevel:"h5",size:"lg"},i),f.a.createElement(J.EmptyStateBody,null,n),f.a.createElement(W.Button,{variant:"primary",onClick:t},f.a.createElement(R.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"})),a&&f.a.createElement(Z.EmptyStateSecondaryActions,null,f.a.createElement(W.Button,{variant:"link",onClick:a},f.a.createElement(R.a,{id:"sources.retry",defaultMessage:"Retry"})))))};re.propTypes={onClose:A.a.func.isRequired,message:A.a.node.isRequired,title:A.a.node.isRequired,onRetry:A.a.func};var oe=re,se=function(e){var t=e.setState,a=e.goToSources,n=e.error;return f.a.createElement(oe,{onClose:a,message:f.a.createElement(f.a.Fragment,null,f.a.createElement(R.a,{id:"sources.successAddApp",defaultMessage:"Your application has not been successfully added:"}),f.a.createElement("br",null),f.a.createElement(w.TextContent,null,f.a.createElement(x.Text,{component:x.TextVariants.h6},n))),title:f.a.createElement(R.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),onRetry:function(){return t({state:"wizard"})}})};se.propTypes={setState:j.PropTypes.func.isRequired,goToSources:j.PropTypes.func.isRequired,error:j.PropTypes.string.isRequired};var ce=se,ue=a(88),le=a.n(ue),pe=function(e){var t=e.onClose,a=e.title,n=e.successfulMessage,i=e.secondaryActions;return f.a.createElement(H.Bullseye,null,f.a.createElement(Q.EmptyState,{variant:Q.EmptyStateVariant.full},f.a.createElement(te.EmptyStateIcon,{icon:le.a,color:"var(--pf-global--success-color--100)"}),f.a.createElement(ae.Title,{headingLevel:"h5",size:"lg"},a),f.a.createElement(J.EmptyStateBody,null,n),f.a.createElement(W.Button,{variant:"primary",onClick:t},f.a.createElement(R.a,{id:"sources.backToSources",defaultMessage:"Back to Sources"})),i&&f.a.createElement(Z.EmptyStateSecondaryActions,null,i)))};pe.propTypes={onClose:A.a.func.isRequired,successfulMessage:A.a.node.isRequired,title:A.a.node.isRequired,secondaryActions:A.a.node};var de=pe,me=function(e){var t=e.setState,a=e.goToSources;return f.a.createElement(de,{onClose:a,successfulMessage:f.a.createElement(R.a,{id:"sources.successAddApp",defaultMessage:"Your application has been successfully added."}),title:f.a.createElement(R.a,{id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),secondaryActions:f.a.createElement(W.Button,{variant:"link",onClick:function(){return t({state:"wizard"})}},f.a.createElement(R.a,{id:"sources.continueManageApp",defaultMessage:"Continue managing applications"}))})};me.propTypes={setState:j.PropTypes.func.isRequired,goToSources:j.PropTypes.func.isRequired};var fe=me,he=a(460),ye=function(e){var t=e.step,a=e.goToSources,n=Object(g.a)();return f.a.createElement(he.Wizard,{isOpen:!0,onClose:a,title:n.formatMessage({id:"sources.manageApps",defaultMessage:"Manage applications"}),description:n.formatMessage({id:"sources.addAppDescription",defaultMessage:"You are managing applications of this source."}),steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};ye.propTypes={step:j.PropTypes.node.isRequired,goToSources:j.PropTypes.func.isRequired};var ge=ye,ve=a(13),be=a(326),Ee=a(83),Te=a(79),Oe=a(295),_e=a.n(Oe),Se=a(153),je=a.n(Se),Ae=a(696),Me=a(430),xe=a.n(Me),we=a(114);function Re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(a),!0).forEach((function(t){c()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Re(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ke=function e(t){return Object.keys(t).forEach((function(a){t[a]&&"object"===je()(t[a])?xe()(t[a])?delete t[a]:e(t[a]):void 0===t[a]&&delete t[a]})),t},Ve=function(){var e=d()(l.a.mark((function e(t,a,n,i){var r,s,c,u,p,d,m,f,h,y,g,v,E,_,S,j,A,M,x,w,R,C,k,V,P,D,q,N,I,B,F,L,z,G,U,Y;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.getState(),s=r.values,c=s.authentication?s.authentication.id:void 0,u=c?n.find((function(e){return e.id===c})):void 0,p=t.authentication,d=_e()(t,["authentication"]),m=Object(Ae.addedDiff)(i,d),f=Object(Ae.updatedDiff)(i,d),h=Object(Ae.addedDiff)(u,p),y=Object(Ae.updatedDiff)(u,p),g=ke(Ce({},b()(T()(m),f),{authentication:Ce({},b()(T()(h),y))})),e.prev=10,s.source&&s.source.id){e.next=13;break}throw"Missing source id";case 13:if(v=s.source.id,E=s.endpoint?s.endpoint.id:void 0,_=[],g.source&&!xe()(g.source)?_.push(Object(ve.i)().updateSource(v,g.source)):_.push(Promise.resolve(void 0)),S=g.endpoint&&!xe()(g.endpoint),j=g.url&&!xe()(g.url),!S&&!j){e.next=35;break}if(A=Object(we.b)(g),M=A.scheme,x=A.host,w=A.port,R=A.path,C=parseInt(w,10),k=ke(Ce({},g.endpoint,{scheme:M,host:x,port:isNaN(C)?void 0:C,path:R})),!E){e.next=27;break}_.push(Object(ve.i)().updateEndpoint(E,k)),e.next=33;break;case 27:return _.push(Promise.resolve(void 0)),V=Ce({},k,{default:!0,source_id:v}),e.next=31,Object(ve.i)().createEndpoint(V);case 31:P=e.sent,E=P.id;case 33:e.next=36;break;case 35:_.push(Promise.resolve(void 0));case 36:return g.authentication&&!xe()(g.authentication)?c?_.push(Object(ve.i)().updateAuthentication(c,g.authentication)):E&&(D=Ce({},g.authentication,{resource_id:E,resource_type:"Endpoint"}),_.push(Object(ve.i)().createAuthentication(D))):_.push(Promise.resolve(void 0)),g.application&&g.application.application_type_id?_.push(Object(ve.b)(v,g.application.application_type_id)):_.push(Promise.resolve(void 0)),e.next=40,Promise.all(_);case 40:return q=e.sent,N=o()(q,4),N[0],N[1],I=N[2],B=N[3],F=c||(I?I.id:void 0),L=[],B&&B.id&&F&&(z={application_id:B.id,authentication_id:F},L.push(Object(ve.i)().createAuthApp(z))),(g.credentials||g.billing_source)&&(G=g.credentials,U=g.billing_source,Y={},Y=G?{authentication:{credentials:G}}:{},Y=U?Ce({},Y,{billing_source:U}):Y,L.push(Object(O.patchSource)(Ce({id:v},Y)))),e.next=53,Promise.all(L);case 53:e.next=61;break;case 55:return e.prev=55,e.t0=e.catch(10),e.next=59,Object(O.handleError)(e.t0);case 59:throw e.sent;case 61:case"end":return e.stop()}}),e,null,[[10,55]])})));return function(t,a,n,i){return e.apply(this,arguments)}}(),Pe=a(488),De=a(370);function qe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var Ne=void 0,Ie=function(e){var t=e.values.application;return Ne=t},Be=function(e,t,a,n,i,r){return i({state:"submitting"}),Ve(e,t,a,r).then(d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(De.a)(r.source.id),e.next=3,n(Object(_.g)());case 3:return Ne=void 0,e.abrupt("return",i({state:"finished"}));case 5:case"end":return e.stop()}}),e)})))).catch((function(t){return i({state:"errored",error:t,values:e})}))},Fe={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{}},Le=function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(a),!0).forEach((function(t){c()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{},t)};t.default=function(){var e=Object(g.a)(),t=Object(h.f)(),a=Object(be.a)(),n=Object(y.useSelector)((function(e){return e.sources}),y.shallowEqual),r=n.appTypes,s=n.sourceTypesLoaded,c=n.appTypesLoaded,u=n.sourceTypes,l=n.undoValues,p=Object(q.a)(),d=Object(y.useDispatch)(),v=Object(m.useReducer)(Le,Fe),E=o()(v,2),j=E[0],A=E[1];Object(m.useEffect)((function(){Ne=void 0}),[]),Object(m.useEffect)((function(){if(p){var e=j.sourceAppsLength>=p.applications.length&&j.sourceAppsLength>0;A({sourceAppsLength:p.applications.length}),e||(p.endpoints&&p.endpoints[0]?Object(ve.i)().listEndpointAuthentications(p.endpoints[0].id).then((function(e){var t=e.data;return A({authenticationsValues:t,initialValues:{source:p,endpoint:p.endpoints[0],url:Object(Ee.b)(p.endpoints[0]),application:Ne},values:{}})})).then((function(){"loading"===j.state&&A({state:"wizard"})})):(A({initialValues:{source:p,application:Ne},values:{}}),"loading"===j.state&&A({state:"wizard"})))}}),[p]);var M=function(){return t.push(Te.c.sources.path)};if(!c||!s||!a)return f.a.createElement(ge,{goToSources:M,step:f.a.createElement(ee,null)});if("loading"===j.state||"submitting"===j.state)return f.a.createElement(ge,{goToSources:M,step:f.a.createElement(ee,null)});if("wizard"!==j.state){var x="finished"===j.state?f.a.createElement(fe,{setState:A,goToSources:M}):f.a.createElement(ce,{setState:A,goToSources:M,error:j.error});return f.a.createElement(ge,{goToSources:M,step:x})}var w=p.applications.filter((function(e){return!e.isDeleting})).reduce((function(e,t){return[].concat(i()(e),[t.application_type_id])}),[]),C=u.find((function(e){return e.id===p.source_type_id})),k=C&&C.name,V=r.filter((function(e){return!w.includes(e.id)&&e.supported_source_types.includes(k)})).filter(O.filterApps),P=V.map((function(t){var a=p.applications.find((function(e){return e.application_type_id===t.id})),n="".concat(t.display_name," ").concat(a?"(".concat(e.formatMessage({id:"sources.currentlyRemoving",defaultMessage:"Currently removing"}),")"):"");return{value:t.id,label:n,isDisabled:!!a}})),D=b()(T()(l),j.values),N=K(P,e,u,r,j.authenticationsValues,p,D),I=V.length>0?function(e,t){return Be(e,t,j.authenticationsValues,d,A,j.initialValues)}:M,B=b()(T()(j.initialValues),D);return f.a.createElement(S.a,{schema:N,showFormControls:!1,onSubmit:I,onCancel:function(a){return function(e){var t=e.values,a=e.dispatch,n=e.history,i=e.intl,r=e.sourceId;if(t&&t.application){var o=Date.now();a(Object(_.b)(i.formatMessage({id:"sources.addApplicationCanceled",defaultMessage:"Adding an application was cancelled"}),"success",f.a.createElement(R.a,{id:"sources.undoMistake",defaultMessage:"{undo} if this was a mistake.",values:{undo:f.a.createElement(Pe.a,{messageId:o,values:t,path:Object(Te.b)(Te.c.sourceManageApps.path,r)})}}),o))}a(Object(_.c)()),n.push(Te.c.sources.path)}({values:a,dispatch:d,intl:e,sourceId:p.id,history:t})},initialValues:B,subscription:{values:!0},onStateUpdate:Ie,clearedValue:null})}}}]);
//# sourceMappingURL=../sourcemaps/addApp.js.map