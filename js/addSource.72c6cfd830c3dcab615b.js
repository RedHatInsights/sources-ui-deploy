(self.webpackChunksources_ui=self.webpackChunksources_ui||[]).push([[2199],{7622:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AddSourceButton:()=>be,AddSourceWizard:()=>ge});var n=r(67154),i=r.n(n),s=r(6479),a=r.n(s),o=r(63038),c=r.n(o),u=r(59713),l=r.n(u),p=r(80150),d=r.n(p),f=r(45697),m=r.n(f),y=r(41609),h=r.n(y),g=r(44012),b=r(47173),v=r(86896),S=r(77583),O=r(34686),w=r(11062),E=r(57061),T=r(97864),j=r(57210),P=r(51863),R=r(86267);function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _={schema:{},sourceTypes:[],isLoading:!0},k=function(e,t){var r=t.type,n=t.sourceTypes,i=t.applicationTypes,s=t.container,a=t.disableAppSelection,o=t.intl,c=t.selectedType,u=t.initialWizardState;switch(r){case"loaded":return C(C({},e),{},{schema:(0,w.ZP)(n.filter(R.Z).filter(R.j),i.filter(P.Z).filter((0,P.W)(n)),a,s,o,c,u),isLoading:!1,sourceTypes:n})}},x=function(e){var t=e.sourceTypes,r=e.applicationTypes,n=e.disableAppSelection,i=e.isCancelling,s=e.onCancel,a=e.values,o=e.onSubmit,u=e.selectedType,l=e.initialWizardState,f=(0,p.useReducer)(k,_),m=c()(f,2),y=m[0],h=y.schema,g=y.sourceTypes,b=y.isLoading,w=m[1],P=(0,p.useRef)(!1),R=(0,p.useRef)(document.createElement("div")),M=(0,v.Z)();return(0,p.useEffect)((function(){P.current=!0;var e=[];return t||e.push((0,E.lH)()),r||e.push((0,E.$l)()),Promise.all(e).then((function(e){var i=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"sourceTypes")})),s=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"applicationTypes")}));P.current&&w({type:"loaded",sourceTypes:t||i.sourceTypes,applicationTypes:r||s.applicationTypes,disableAppSelection:n,container:R.current,intl:M,selectedType:u,initialWizardState:l})})),function(){P.current=!1}}),[]),(0,p.useEffect)((function(){R.current.style.opacity=i?0:1}),[i]),b?d().createElement(S.e,{className:"sources",isOpen:!0,onClose:s,title:(0,j.Z5)(),description:(0,j.A6)(),steps:[{name:"Loading",component:d().createElement(T.Z,{onClose:function(){return s()}}),isFinishedStep:!0}]}):d().createElement(O.Z,{initialValues:C(C({},a),u&&{source_type:u}),schema:h,onSubmit:function(e,t,r){return o(e,g,r)},onCancel:s})};x.propTypes={onCancel:m().func.isRequired,onSubmit:m().func.isRequired,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),values:m().object,disableAppSelection:m().bool,isCancelling:m().bool,selectedType:m().string,initialWizardState:m().object},x.defaultProps={values:{},disableAppSelection:!1};const A=x;var z=r(68340),Z=r(68774),q=r(88925),D=r(76690),B=r(98409),F=r(12064),W=r(93973),V=r(334),N=r(24859),L=function(e){var t=e.id,r=(0,v.Z)().formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"});return"sources"===insights.chrome.getApp()?d().createElement(V.Link,{to:"/sources/detail/".concat(t)},d().createElement(b.zx,{variant:"primary",className:"pf-u-mt-xl"},r)):d().createElement(b.zx,{variant:"primary",className:"pf-u-mt-xl",component:"a",target:"_blank",href:"".concat((0,N.Z)(),"/detail/").concat(t),rel:"noopener noreferrer"},r)};L.propTypes={id:m().string.isRequired};const I=L;var U=r(41686),Y=function(e){var t,r,n=e.afterSubmit,i=e.afterError,s=e.isFinished,a=e.isErrored,o=e.successfulMessage,u=e.hideSourcesButton,l=e.returnButtonTitle,f=e.reset,m=e.createdSource,y=void 0===m?{}:m,h=e.tryAgain,g=e.afterSuccess,O=e.sourceTypes,w=(0,p.useState)(),P=c()(w,2),R=P[0],M=P[1],C=(0,p.useState)(),_=c()(C,2),k=_[0],x=_[1],A=(0,v.Z)(),V=d().createElement(b.zx,{variant:"link",onClick:f},A.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}));if(k)r=d().createElement(q.Z,{onClose:n,title:A.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:A.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Source was successfully removed."}),hideSourcesButton:u,returnButtonTitle:l,secondaryActions:V});else if(R)r=d().createElement(T.Z,{customText:A.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing source"})});else if(s)switch((0,W.Z)(y)){case"unavailable":r=d().createElement(D.Z,{onClose:n,secondaryActions:d().createElement(b.zx,{variant:"link",onClick:function(){return M(!0),(0,E.Rj)().removeSource(y.id).then((function(){g&&g(),x(!0)})).catch((function(){return M(!1)}))}},A.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove source"})),Component:function(){return d().createElement(I,{id:y.id})},message:(0,U.Z)(y,A),title:A.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})});break;case"timeout":r=d().createElement(B.Z,{onClose:n,returnButtonTitle:l,secondaryActions:V});break;default:r=y.source_type_id===(null===(t=O.find((function(e){return"amazon"===e.name})))||void 0===t?void 0:t.id)?d().createElement(F.Z,{onClose:n}):d().createElement(q.Z,{onClose:n,successfulMessage:o,hideSourcesButton:u,returnButtonTitle:l,secondaryActions:V})}else r=a?d().createElement(D.Z,{onClose:i,primaryAction:h,secondaryActions:d().createElement(z.x,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},A.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:A.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):d().createElement(T.Z,{customText:A.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating credentials"}),description:d().createElement(Z.D,null,d().createElement(z.x,{className:"pf-u-mb-md"},A.formatMessage({id:"wizard.loadingDescription-a",defaultMessage:"This might take some time. You'll receive a notification if you are still in the Sources application when the process completes. Otherwise, you can check the status in the main sources table at any time."})),d().createElement(z.x,null,A.formatMessage({id:"wizard.loadingDescription-b",defaultMessage:"In the meantime, you can close this window while the validation process continues."}))),onClose:i,cancelTitle:A.formatMessage({id:"wizard.close",defaultMessage:"Close"})});return d().createElement(S.e,{className:"sources",isOpen:!0,onClose:s?n:i,title:(0,j.Z5)(),description:(0,j.A6)(),steps:[{name:"Finish",component:r,isFinishedStep:!0}]})};Y.propTypes={afterSubmit:m().func.isRequired,afterError:m().func.isRequired,isFinished:m().bool.isRequired,isErrored:m().bool.isRequired,successfulMessage:m().node.isRequired,hideSourcesButton:m().bool,returnButtonTitle:m().node.isRequired,errorMessage:m().node,reset:m().func,createdSource:m().object,tryAgain:m().func,afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired}))};const $=Y;var G=r(87757),H=r.n(G),J=r(48926),K=r.n(J),Q=r(81240),X=r(8772);function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var re=function(e){return e.url?function(e){if(!e)return{};try{var t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}}(e.url):e},ne=function(){var e=K()(H().mark((function e(t,r){var n,i,s,a,o,u,l,p,d,f,m,y,h,g,b,v,S,O,w,T,P,R,M,C,_,k=arguments;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k.length>2&&void 0!==k[2]?k[2]:[],e.prev=1,o=r.find((function(e){return e.name===t.source_type})).id,e.next=5,(0,E.Rj)().createSource(te(te({},t.source),{},{source_type_id:o}));case 5:return i=e.sent,u=[],t.endpoint?(l=re(t),p=l.scheme,d=l.host,f=l.port,m=l.path,y=parseInt(f,10),h=te(te({},t.endpoint),{},{default:!0,source_id:i.id,scheme:p,host:d,port:isNaN(y)?void 0:y,path:m}),u.push((0,E.Rj)().createEndpoint(h))):u.push(Promise.resolve(void 0)),t.application&&t.application.application_type_id&&t.application.application_type_id!==j.Dt?(g=te(te({},t.application),{},{source_id:i.id}),u.push((0,E.Rj)().createApplication(g))):u.push(Promise.resolve(void 0)),e.next=11,Promise.all(u);case 11:if(b=e.sent,v=c()(b,2),S=v[0],O=v[1],!(S||t.authentication&&null!==(s=O)&&void 0!==s&&s.id)){e.next=20;break}return M=te(te({},t.authentication),{},{resource_id:(null===(T=S)||void 0===T?void 0:T.id)||(null===(P=O)||void 0===P?void 0:P.id),resource_type:null!==(R=S)&&void 0!==R&&R.id?"Endpoint":"Application",source_id:i.id}),e.next=19,(0,E.Rj)().createAuthentication(M);case 19:w=e.sent;case 20:if(!w||!O){e.next=24;break}return C={application_id:O.id,authentication_id:w.id},e.next=24,(0,E.Rj)().createAuthApp(C);case 24:if((null===(a=i)||void 0===a?void 0:a.id)&&(0,E.Rj)().checkAvailabilitySource(i.id),!O){e.next=30;break}return _=n.includes(O.application_type_id)?1e4:0,e.next=29,(0,X.h)(O.id,_);case 29:O=e.sent;case 30:if(!S){e.next=34;break}return e.next=33,(0,X.h)(S.id,void 0,void 0,"getEndpoint");case 33:S=e.sent;case 34:return e.abrupt("return",te(te({},i),{},{endpoint:[S],applications:[O]}));case 37:return e.prev=37,e.t0=e.catch(1),e.next=41,(0,Q.S)(e.t0,i?i.id:void 0);case 41:throw e.sent;case 43:case"end":return e.stop()}}),e,null,[[1,37]])})));return function(t,r){return e.apply(this,arguments)}}(),ie=r(73881),se=r(48897),ae=r(68551),oe=r.n(ae),ce=r(93323);function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const pe=function(){var e=K()(H().mark((function e(t,r,n){var i,s,a,o,c,u,l;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=new Date,e.next=4,(0,E.Rj)().bulkCreate({sources:[le(le({},t.source),{},{source_type_name:t.source_type})],authentications:[le(le({},t.authentication),{},{resource_name:t.source.name,resource_type:"source"})],applications:t.applications.map((function(e){return{application_type_id:e,source_name:t.source.name}}))});case 4:return s=e.sent,e.next=7,(0,ce.Z)(s.sources[0].id);case 7:return(a=[]).push((0,X.h)(s.authentications[0].id,void 0,void 0,"getAuthentication",i)),s.applications.forEach((function(e){var t=e.id;return a.push((0,X.h)(t,void 0,void 0,"getApplication",i))})),e.next=12,Promise.all(a);case 12:return o=e.sent,c=oe()(o),u=c[0],l=c.slice(1),e.abrupt("return",le(le(le({},s),s.sources[0]),{},{authentications:[u],applications:l}));case 19:return e.prev=19,e.t0=e.catch(0),e.next=23,(0,Q.Z)(e.t0);case 23:throw e.sent;case 25:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r,n){return e.apply(this,arguments)}}();var de=r(56855);function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ye=function(e){return{isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0}},he=function(e,t){var r=t.type,n=t.values,i=t.data,s=t.error,a=t.initialValues,o=t.sourceTypes;switch(r){case"reset":return ye(a);case"prepareSubmitState":return me(me({},e),{},{isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:n,sourceTypes:o});case"setSubmitted":return me(me({},e),{},{isFinished:!0,createdSource:i});case"setErrored":return me(me({},e),{},{isErrored:!0,error:s.toString()});case"onStay":return me(me({},e),{},{isCancelling:!1});case"showCancelModal":return me(me({},e),{},{isCancelling:!0,values:n})}},ge=function(e){var t=e.successfulMessage,r=e.isOpen,n=e.sourceTypes,i=e.applicationTypes,s=e.disableAppSelection,o=e.hideSourcesButton,u=e.returnButtonTitle,l=e.initialValues,f=e.onClose,m=e.afterSuccess,y=e.selectedType,g=e.initialWizardState,b=e.submitCallback,v=(0,p.useReducer)(he,ye(l)),S=c()(v,2),O=S[0],w=O.isErrored,E=O.isFinished,T=O.isSubmitted,j=O.values,P=O.error,R=O.isCancelling,M=O.createdSource,C=a()(O,["isErrored","isFinished","isSubmitted","values","error","isCancelling","createdSource"]),_=S[1],k=function(e,t,r){return _({type:"prepareSubmitState",values:e,sourceTypes:t}),((0,de.Z)(e.source)?pe:ne)(e,t,(0,se.T2)(i)).then((function(e){m&&m(e),b&&b({isSubmitted:!0,createdSource:e,sourceTypes:t}),_({type:"setSubmitted",data:e})})).catch((function(n){b&&b({isErrored:!0,error:n,values:e,sourceTypes:t,wizardState:r}),_({type:"setErrored",error:n})}))};return r?T?d().createElement($,{afterSubmit:function(){f(void 0,M),_({type:"reset",initialValues:l})},afterError:function(){return f({})},isFinished:E,isErrored:w,successfulMessage:t,hideSourcesButton:o,returnButtonTitle:u,errorMessage:P,reset:function(){return _({type:"reset",initialValues:l})},createdSource:M,tryAgain:function(){return k(j,C.sourceTypes)},afterSuccess:m,sourceTypes:C.sourceTypes}):d().createElement(d().Fragment,null,R&&d().createElement(ie.Z,{onExit:function(){return f(j)},onStay:function(){return _({type:"onStay"})}}),d().createElement(A,{isCancelling:R,values:j,onSubmit:k,onCancel:function(e){return h()(e)?f({}):_({type:"showCancelModal",values:e})},sourceTypes:n,applicationTypes:i,disableAppSelection:s,selectedType:y,initialWizardState:g})):null};ge.propTypes={afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),onClose:m().func.isRequired,isOpen:m().bool.isRequired,successfulMessage:m().node,initialValues:m().shape(l()({},m().string,m().oneOf([m().string,m().array,m().number,m().bool]))),disableAppSelection:m().bool,hideSourcesButton:m().bool,returnButtonTitle:m().node,selectedType:m().string,initialWizardState:m().object,submitCallback:m().func},ge.defaultProps={successfulMessage:d().createElement(g.Z,{id:"wizard.successfulMessage",defaultMessage:"Your source was successfully added."}),initialValues:{},returnButtonTitle:d().createElement(g.Z,{id:"wizard.goBackToSources",defaultMessage:"Go back to Sources"})};var be=function(e){var t=(0,p.useState)(!1),r=c()(t,2),n=r[0],s=r[1];return d().createElement(d().Fragment,null,d().createElement(b.zx,{variant:"primary",onClick:function(){return s(!0)}},(0,j.Z5)()),d().createElement(ge,i()({isOpen:n,onClose:function(){return s(!1)}},e)))}}}]);
//# sourceMappingURL=addSource.72c6cfd830c3dcab615b.js.map