(self.webpackChunksources_ui=self.webpackChunksources_ui||[]).push([[2199],{35577:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AddSourceButton:()=>Me,AddSourceWizard:()=>Re});var n=r(67154),i=r.n(n),s=r(6479),a=r.n(s),o=r(63038),c=r.n(o),u=r(59713),l=r.n(u),p=r(80150),d=r.n(p),f=r(45697),m=r.n(f),y=r(41609),h=r.n(y),b=r(44012),g=r(47173),v=r(86896),O=r(81554),S=r(77583),w=r(41589),j=r(67601),E=r(38307),T=r(72959),P=r(56758),R=r(87242),M=r(83862),C=r(58860),_=r(24154);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const x=function(e){var t=(0,v.Z)(),r=(0,C.Z)().getState().values.authentication,n=e.validate&&e.validate.filter((function(e){return e.type!==_.Z.REQUIRED})),i=Z(Z({},e),r&&r.id?{isRequired:!1,helperText:t.formatMessage({id:"wizard.changeAuthHelper",defaultMessage:"Changing this resets your current {label}."},{label:e.label}),validate:n}:{}),s=M.ZP[R.Z.TEXT_FIELD];return d().createElement(s,i)};var A=r(7505),z=r(14303);function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B={schema:{},sourceTypes:[],isLoading:!0},F=function(e,t){var r=t.type,n=t.sourceTypes,i=t.applicationTypes,s=t.container,a=t.disableAppSelection,o=t.intl,c=t.selectedType,u=t.initialWizardState;switch(r){case"loaded":return q(q({},e),{},{schema:(0,w.ZP)(n.filter(P.Z).filter(P.j),i.filter(T.Z).filter((0,T.W)(n)),a,s,o,c,u),isLoading:!1,sourceTypes:n})}},W=function(e){return d().createElement(O.ZP,i()({},e,{showFormControls:!1}))},V=function(e){var t=e.sourceTypes,r=e.applicationTypes,n=e.disableAppSelection,i=e.isCancelling,s=e.onCancel,a=e.values,o=e.onSubmit,u=e.selectedType,l=e.initialWizardState,f=(0,p.useReducer)(F,B),m=c()(f,2),y=m[0],h=y.schema,b=y.sourceTypes,g=y.isLoading,O=m[1],w=(0,p.useRef)(!1),T=(0,p.useRef)(document.createElement("div")),P=(0,v.Z)();return(0,p.useEffect)((function(){w.current=!0;var e=[];return t||e.push((0,j.lH)()),r||e.push((0,j.$l)()),Promise.all(e).then((function(e){var i=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"sourceTypes")})),s=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"applicationTypes")}));w.current&&O({type:"loaded",sourceTypes:t||i.sourceTypes,applicationTypes:r||s.applicationTypes,disableAppSelection:n,container:T.current,intl:P,selectedType:u,initialWizardState:l})})),function(){w.current=!1}}),[]),(0,p.useEffect)((function(){T.current.style.opacity=i?0:1}),[i]),g?d().createElement(S.e,{className:"sources",isOpen:!0,onClose:s,title:(0,E.Z5)(),description:(0,E.A6)(),steps:[{name:"Loading",component:d().createElement(z.Z,{onClose:function(){return s()}}),isFinishedStep:!0}]}):d().createElement(A.Z,{initialValues:q(q({},a),u&&{source_type:u}),schema:h,onSubmit:function(e,t,r){return o(e,b,r)},onCancel:s,FormTemplate:W,subscription:{values:!0},componentMapper:{authentication:x}})};V.propTypes={onCancel:m().func.isRequired,onSubmit:m().func.isRequired,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),values:m().object,disableAppSelection:m().bool,isCancelling:m().bool,selectedType:m().string,initialWizardState:m().object},V.defaultProps={values:{},disableAppSelection:!1};const L=V;var N=r(68340),I=r(68774),U=r(45857),H=r(46563),Y=r(334),$=r(58331),G=function(e){var t=e.id,r=(0,v.Z)().formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"});return"sources"===insights.chrome.getApp()?d().createElement(Y.Link,{to:"/sources/detail/".concat(t)},d().createElement(g.zx,{variant:"primary",className:"pf-u-mt-xl"},r)):d().createElement(g.zx,{variant:"primary",className:"pf-u-mt-xl",component:"a",target:"_blank",href:"".concat((0,$.Z)(),"/detail/").concat(t),rel:"noopener noreferrer"},r)};G.propTypes={id:m().string.isRequired};const Q=G;var X=r(89764),J=r(8440),K=r(58541),ee=r(93705),te=r(95567),re=function(e){var t,r,n=e.afterSubmit,i=e.afterError,s=e.isFinished,a=e.isErrored,o=e.successfulMessage,u=e.hideSourcesButton,l=e.returnButtonTitle,f=e.reset,m=e.createdSource,y=void 0===m?{}:m,h=e.tryAgain,b=e.afterSuccess,O=e.sourceTypes,w=(0,p.useState)(),j=c()(w,2),T=j[0],P=j[1],R=(0,p.useState)(),M=c()(R,2),C=M[0],_=M[1],k=(0,v.Z)(),Z=d().createElement(g.zx,{variant:"link",onClick:f},k.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}));if(C)r=d().createElement(J.Z,{onClose:n,title:k.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:k.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Source was successfully removed."}),hideSourcesButton:u,returnButtonTitle:l,secondaryActions:Z});else if(T)r=d().createElement(z.Z,{customText:k.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing source"})});else if(s)switch((0,H.Z)(y)){case"unavailable":r=d().createElement(K.Z,{onClose:n,secondaryActions:d().createElement(g.zx,{variant:"link",onClick:function(){return P(!0),(0,U.Rj)().removeSource(y.id).then((function(){b&&b(),_(!0)})).catch((function(){return P(!1)}))}},k.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove source"})),Component:function(){return d().createElement(Q,{id:y.id})},message:(0,X.Z)(y,k),title:k.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})});break;case"timeout":r=d().createElement(ee.Z,{onClose:n,returnButtonTitle:l,secondaryActions:Z});break;default:r=y.source_type_id===(null===(t=O.find((function(e){return"amazon"===e.name})))||void 0===t?void 0:t.id)?d().createElement(te.Z,{onClose:n}):d().createElement(J.Z,{onClose:n,successfulMessage:o,hideSourcesButton:u,returnButtonTitle:l,secondaryActions:Z})}else r=a?d().createElement(K.Z,{onClose:i,primaryAction:h,secondaryActions:d().createElement(N.x,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},k.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:k.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):d().createElement(z.Z,{customText:k.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating credentials"}),description:d().createElement(I.D,null,d().createElement(N.x,{className:"pf-u-mb-md"},k.formatMessage({id:"wizard.loadingDescription-a",defaultMessage:"This might take some time. You'll receive a notification if you are still in the Sources application when the process completes. Otherwise, you can check the status in the main sources table at any time."})),d().createElement(N.x,null,k.formatMessage({id:"wizard.loadingDescription-b",defaultMessage:"In the meantime, you can close this window while the validation process continues."}))),onClose:i,cancelTitle:k.formatMessage({id:"wizard.close",defaultMessage:"Close"})});return d().createElement(S.e,{className:"sources",isOpen:!0,onClose:s?n:i,title:(0,E.Z5)(),description:(0,E.A6)(),steps:[{name:"Finish",component:r,isFinishedStep:!0}]})};re.propTypes={afterSubmit:m().func.isRequired,afterError:m().func.isRequired,isFinished:m().bool.isRequired,isErrored:m().bool.isRequired,successfulMessage:m().node.isRequired,hideSourcesButton:m().bool,returnButtonTitle:m().node.isRequired,errorMessage:m().node,reset:m().func,createdSource:m().object,tryAgain:m().func,afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired}))};const ne=re;var ie=r(56855),se=r(75087),ae=r(87757),oe=r.n(ae),ce=r(68551),ue=r.n(ce),le=r(48926),pe=r.n(le),de=r(93323),fe=r(80582),me=r(76224);function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function he(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const be=function(){var e=pe()(oe().mark((function e(t,r,n){var i,s,a,o,c,u,l;return oe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=new Date,e.next=4,(0,U.Rj)().bulkCreate({sources:[he(he({},t.source),{},{source_type_name:t.source_type})],authentications:[he(he({},t.authentication),{},{resource_name:t.source.name,resource_type:"source"})],applications:t.applications.map((function(e){return{application_type_id:e,source_name:t.source.name}}))});case 4:return s=e.sent,e.next=7,(0,de.Z)(s.sources[0].id);case 7:return(a=[]).push((0,fe.h)(s.authentications[0].id,void 0,void 0,"getAuthentication",i)),s.applications.forEach((function(e){var t=e.id;return a.push((0,fe.h)(t,void 0,void 0,"getApplication",i))})),e.next=12,Promise.all(a);case 12:return o=e.sent,c=ue()(o),u=c[0],l=c.slice(1),e.abrupt("return",he(he(he({},s),s.sources[0]),{},{authentications:[u],applications:l}));case 19:return e.prev=19,e.t0=e.catch(0),e.next=23,(0,me.Z)(e.t0);case 23:throw e.sent;case 25:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r,n){return e.apply(this,arguments)}}();function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Oe=function(e){return e.url?function(e){if(!e)return{};try{var t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}}(e.url):e},Se=function(){var e=pe()(oe().mark((function e(t,r){var n,i,s,a,o,u,l,p,d,f,m,y,h,b,g,v,O,S,w,j,T,P,R,M,C,_=arguments;return oe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_.length>2&&void 0!==_[2]?_[2]:[],e.prev=1,o=r.find((function(e){return e.name===t.source_type})).id,e.next=5,(0,U.Rj)().createSource(ve(ve({},t.source),{},{source_type_id:o}));case 5:return i=e.sent,u=[],t.endpoint?(l=Oe(t),p=l.scheme,d=l.host,f=l.port,m=l.path,y=parseInt(f,10),h=ve(ve({},t.endpoint),{},{default:!0,source_id:i.id,scheme:p,host:d,port:isNaN(y)?void 0:y,path:m}),u.push((0,U.Rj)().createEndpoint(h))):u.push(Promise.resolve(void 0)),t.application&&t.application.application_type_id&&t.application.application_type_id!==E.Dt?(b=ve(ve({},t.application),{},{source_id:i.id}),u.push((0,U.Rj)().createApplication(b))):u.push(Promise.resolve(void 0)),e.next=11,Promise.all(u);case 11:if(g=e.sent,v=c()(g,2),O=v[0],S=v[1],!(O||t.authentication&&null!==(s=S)&&void 0!==s&&s.id)){e.next=20;break}return R=ve(ve({},t.authentication),{},{resource_id:(null===(j=O)||void 0===j?void 0:j.id)||(null===(T=S)||void 0===T?void 0:T.id),resource_type:null!==(P=O)&&void 0!==P&&P.id?"Endpoint":"Application",source_id:i.id}),e.next=19,(0,U.Rj)().createAuthentication(R);case 19:w=e.sent;case 20:if(!w||!S){e.next=24;break}return M={application_id:S.id,authentication_id:w.id},e.next=24,(0,U.Rj)().createAuthApp(M);case 24:if((null===(a=i)||void 0===a?void 0:a.id)&&(0,U.Rj)().checkAvailabilitySource(i.id),!S){e.next=30;break}return C=n.includes(S.application_type_id)?1e4:0,e.next=29,(0,fe.h)(S.id,C);case 29:S=e.sent;case 30:if(!O){e.next=34;break}return e.next=33,(0,fe.h)(O.id,void 0,void 0,"getEndpoint");case 33:O=e.sent;case 34:return e.abrupt("return",ve(ve({},i),{},{endpoint:[O],applications:[S]}));case 37:return e.prev=37,e.t0=e.catch(1),e.next=41,(0,me.S)(e.t0,i?i.id:void 0);case 41:throw e.sent;case 43:case"end":return e.stop()}}),e,null,[[1,37]])})));return function(t,r){return e.apply(this,arguments)}}(),we=r(12754);function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Te=function(e){return{isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0}},Pe=function(e,t){var r=t.type,n=t.values,i=t.data,s=t.error,a=t.initialValues,o=t.sourceTypes;switch(r){case"reset":return Te(a);case"prepareSubmitState":return Ee(Ee({},e),{},{isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:n,sourceTypes:o});case"setSubmitted":return Ee(Ee({},e),{},{isFinished:!0,createdSource:i});case"setErrored":return Ee(Ee({},e),{},{isErrored:!0,error:s.toString()});case"onStay":return Ee(Ee({},e),{},{isCancelling:!1});case"showCancelModal":return Ee(Ee({},e),{},{isCancelling:!0,values:n})}},Re=function(e){var t=e.successfulMessage,r=e.isOpen,n=e.sourceTypes,i=e.applicationTypes,s=e.disableAppSelection,o=e.hideSourcesButton,u=e.returnButtonTitle,l=e.initialValues,f=e.onClose,m=e.afterSuccess,y=e.selectedType,b=e.initialWizardState,g=e.submitCallback,v=(0,p.useReducer)(Pe,Te(l)),O=c()(v,2),S=O[0],w=S.isErrored,j=S.isFinished,E=S.isSubmitted,T=S.values,P=S.error,R=S.isCancelling,M=S.createdSource,C=a()(S,["isErrored","isFinished","isSubmitted","values","error","isCancelling","createdSource"]),_=O[1],k=function(e,t,r){return _({type:"prepareSubmitState",values:e,sourceTypes:t}),((0,ie.Z)(e.source)?be:Se)(e,t,(0,se.T2)(i)).then((function(e){m&&m(e),g&&g({isSubmitted:!0,createdSource:e,sourceTypes:t}),_({type:"setSubmitted",data:e})})).catch((function(n){g&&g({isErrored:!0,error:n,values:e,sourceTypes:t,wizardState:r}),_({type:"setErrored",error:n})}))};return r?E?d().createElement(ne,{afterSubmit:function(){f(void 0,M),_({type:"reset",initialValues:l})},afterError:function(){return f({})},isFinished:j,isErrored:w,successfulMessage:t,hideSourcesButton:o,returnButtonTitle:u,errorMessage:P,reset:function(){return _({type:"reset",initialValues:l})},createdSource:M,tryAgain:function(){return k(T,C.sourceTypes)},afterSuccess:m,sourceTypes:C.sourceTypes}):d().createElement(d().Fragment,null,R&&d().createElement(we.Z,{onExit:function(){return f(T)},onStay:function(){return _({type:"onStay"})}}),d().createElement(L,{isCancelling:R,values:T,onSubmit:k,onCancel:function(e){return h()(e)?f({}):_({type:"showCancelModal",values:e})},sourceTypes:n,applicationTypes:i,disableAppSelection:s,selectedType:y,initialWizardState:b})):null};Re.propTypes={afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),onClose:m().func.isRequired,isOpen:m().bool.isRequired,successfulMessage:m().node,initialValues:m().shape(l()({},m().string,m().oneOf([m().string,m().array,m().number,m().bool]))),disableAppSelection:m().bool,hideSourcesButton:m().bool,returnButtonTitle:m().node,selectedType:m().string,initialWizardState:m().object,submitCallback:m().func},Re.defaultProps={successfulMessage:d().createElement(b.Z,{id:"wizard.successfulMessage",defaultMessage:"Your source was successfully added."}),initialValues:{},returnButtonTitle:d().createElement(b.Z,{id:"wizard.goBackToSources",defaultMessage:"Go back to Sources"})};var Me=function(e){var t=(0,p.useState)(!1),r=c()(t,2),n=r[0],s=r[1];return d().createElement(d().Fragment,null,d().createElement(g.zx,{variant:"primary",onClick:function(){return s(!0)}},(0,E.Z5)()),d().createElement(Re,i()({isOpen:n,onClose:function(){return s(!1)}},e)))}}}]);
//# sourceMappingURL=addSource.a3824d0978f96da9e32b.js.map