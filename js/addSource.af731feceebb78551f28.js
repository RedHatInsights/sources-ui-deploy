(self.webpackChunksources_ui=self.webpackChunksources_ui||[]).push([[2199],{54750:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AddSourceButton:()=>le,AddSourceWizard:()=>ue});var n=r(67154),i=r.n(n),s=r(6479),a=r.n(s),o=r(63038),c=r.n(o),u=r(59713),l=r.n(u),d=r(80150),p=r.n(d),f=r(45697),m=r.n(f),y=r(41609),g=r.n(y),h=r(44012),b=r(47173),v=r(86896),S=r(77583),O=r(42713),T=r(3154),E=r(57061),w=r(97864),j=r(57210),M=r(51863),R=r(86267);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var k={schema:{},sourceTypes:[],isLoading:!0},z=function(e,t){var r=t.type,n=t.sourceTypes,i=t.applicationTypes,s=t.container,a=t.disableAppSelection,o=t.intl,c=t.selectedType,u=t.initialWizardState;switch(r){case"loaded":return P(P({},e),{},{schema:(0,T.ZP)(n.filter(R.Z).filter(R.j),i.filter(M.Z).filter((0,M.W)(n)),a,s,o,c,u),isLoading:!1,sourceTypes:n})}},_=function(e){var t=e.sourceTypes,r=e.applicationTypes,n=e.disableAppSelection,i=e.isCancelling,s=e.onCancel,a=e.values,o=e.onSubmit,u=e.selectedType,l=e.initialWizardState,f=(0,d.useReducer)(z,k),m=c()(f,2),y=m[0],g=y.schema,h=y.sourceTypes,b=y.isLoading,T=m[1],M=(0,d.useRef)(!1),R=(0,d.useRef)(document.createElement("div")),C=(0,v.Z)();return(0,d.useEffect)((function(){M.current=!0;var e=[];return t||e.push((0,E.lH)()),r||e.push((0,E.$l)()),Promise.all(e).then((function(e){var i=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"sourceTypes")})),s=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"applicationTypes")}));M.current&&T({type:"loaded",sourceTypes:t||i.sourceTypes,applicationTypes:r||s.applicationTypes,disableAppSelection:n,container:R.current,intl:C,selectedType:u,initialWizardState:l})})),function(){M.current=!1}}),[]),(0,d.useEffect)((function(){R.current.hidden=i}),[i]),b?p().createElement(S.e,{className:"sources",isOpen:!0,onClose:s,title:(0,j.Z5)(),description:(0,j.A6)(),steps:[{name:"Loading",component:p().createElement(w.Z,{onClose:function(){return s()}}),isFinishedStep:!0}]}):p().createElement(O.Z,{initialValues:P(P({},a),u&&{source_type:u}),schema:g,onSubmit:function(e,t,r){return o(e,h,r)},onCancel:s})};_.propTypes={onCancel:m().func.isRequired,onSubmit:m().func.isRequired,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),values:m().object,disableAppSelection:m().bool,isCancelling:m().bool,selectedType:m().string,initialWizardState:m().object},_.defaultProps={values:{},disableAppSelection:!1};const A=_;var x=r(68340),q=r(68774),Z=r(88925),B=r(76690),D=r(98409),F=r(12064),W=r(93973),V=r(47194),N=r(24859),L=function(e){var t=e.id,r=(0,v.Z)().formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"});return"sources"===insights.chrome.getApp()?p().createElement(V.Link,{to:"/sources/detail/".concat(t)},p().createElement(b.zx,{variant:"primary",className:"pf-u-mt-xl"},r)):p().createElement(b.zx,{variant:"primary",className:"pf-u-mt-xl",component:"a",target:"_blank",href:"".concat((0,N.Z)(),"/detail/").concat(t),rel:"noopener noreferrer"},r)};L.propTypes={id:m().string.isRequired};const U=L;var I=function(e){var t,r,n,i,s,a,o=e.afterSubmit,u=e.afterError,l=e.isFinished,f=e.isErrored,m=e.successfulMessage,y=e.hideSourcesButton,g=e.returnButtonTitle,h=e.reset,O=e.createdSource,T=void 0===O?{}:O,M=e.tryAgain,R=e.afterSuccess,C=e.sourceTypes,P=(0,d.useState)(),k=c()(P,2),z=k[0],_=k[1],A=(0,d.useState)(),V=c()(A,2),N=V[0],L=V[1],I=(0,v.Z)(),Y=p().createElement(b.zx,{variant:"link",onClick:h},I.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}));if(N)a=p().createElement(Z.Z,{onClose:o,title:I.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:I.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Source was successfully removed."}),hideSourcesButton:y,returnButtonTitle:g,secondaryActions:Y});else if(z)a=p().createElement(w.Z,{customText:I.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing source"})});else if(l)switch((0,W.Z)(T)){case"unavailable":a=p().createElement(B.Z,{onClose:o,secondaryActions:p().createElement(b.zx,{variant:"link",onClick:function(){return _(!0),(0,E.Rj)().removeSource(T.id).then((function(){R&&R(),L(!0)})).catch((function(){return _(!1)}))}},I.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove source"})),Component:function(){return p().createElement(U,{id:T.id})},message:(null===(t=T.applications)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.availability_status_error)||(null===(n=T.endpoint)||void 0===n||null===(i=n[0])||void 0===i?void 0:i.availability_status_error)||I.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:I.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})});break;case"timeout":a=p().createElement(D.Z,{onClose:o,returnButtonTitle:g,secondaryActions:Y});break;default:a=T.source_type_id===(null===(s=C.find((function(e){return"amazon"===e.name})))||void 0===s?void 0:s.id)?p().createElement(F.Z,{onClose:o}):p().createElement(Z.Z,{onClose:o,successfulMessage:m,hideSourcesButton:y,returnButtonTitle:g,secondaryActions:Y})}else a=f?p().createElement(B.Z,{onClose:u,primaryAction:M,secondaryActions:p().createElement(x.x,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},I.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:I.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):p().createElement(w.Z,{customText:I.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating credentials"}),description:p().createElement(q.D,null,p().createElement(x.x,{className:"pf-u-mb-md"},I.formatMessage({id:"wizard.loadingDescription-a",defaultMessage:"This might take some time. You'll receive a notification if you are still in the Sources application when the process completes. Otherwise, you can check the status in the main sources table at any time."})),p().createElement(x.x,null,I.formatMessage({id:"wizard.loadingDescription-b",defaultMessage:"In the meantime, you can close this window while the validation process continues."}))),onClose:u,cancelTitle:I.formatMessage({id:"wizard.close",defaultMessage:"Close"})});return p().createElement(S.e,{className:"sources",isOpen:!0,onClose:l?o:u,title:(0,j.Z5)(),description:(0,j.A6)(),steps:[{name:"Finish",component:a,isFinishedStep:!0}]})};I.propTypes={afterSubmit:m().func.isRequired,afterError:m().func.isRequired,isFinished:m().bool.isRequired,isErrored:m().bool.isRequired,successfulMessage:m().node.isRequired,hideSourcesButton:m().bool,returnButtonTitle:m().node.isRequired,errorMessage:m().node,reset:m().func,createdSource:m().object,tryAgain:m().func,afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired}))};const Y=I;var $=r(87757),G=r.n($),H=r(48926),J=r.n(H),K=r(81240),Q=r(8772);function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var te=function(e){return e.url?function(e){if(!e)return{};try{var t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}}(e.url):e},re=function(){var e=J()(G().mark((function e(t,r){var n,i,s,a,o,u,l,d,p,f,m,y,g,h,b,v,S,O,T,w,M,R,C,P,k,z=arguments;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=z.length>2&&void 0!==z[2]?z[2]:[],e.prev=1,o=r.find((function(e){return e.name===t.source_type})).id,e.next=5,(0,E.Rj)().createSource(ee(ee({},t.source),{},{source_type_id:o}));case 5:return i=e.sent,u=[],t.endpoint?(l=te(t),d=l.scheme,p=l.host,f=l.port,m=l.path,y=parseInt(f,10),g=ee(ee({},t.endpoint),{},{default:!0,source_id:i.id,scheme:d,host:p,port:isNaN(y)?void 0:y,path:m}),u.push((0,E.Rj)().createEndpoint(g))):u.push(Promise.resolve(void 0)),t.application&&t.application.application_type_id&&t.application.application_type_id!==j.Dt?(h=ee(ee({},t.application),{},{source_id:i.id}),u.push((0,E.Rj)().createApplication(h))):u.push(Promise.resolve(void 0)),e.next=11,Promise.all(u);case 11:if(b=e.sent,v=c()(b,2),S=v[0],O=v[1],!(S||t.authentication&&null!==(s=O)&&void 0!==s&&s.id)){e.next=20;break}return C=ee(ee({},t.authentication),{},{resource_id:(null===(w=S)||void 0===w?void 0:w.id)||(null===(M=O)||void 0===M?void 0:M.id),resource_type:null!==(R=S)&&void 0!==R&&R.id?"Endpoint":"Application",source_id:i.id}),e.next=19,(0,E.Rj)().createAuthentication(C);case 19:T=e.sent;case 20:if(!T||!O){e.next=24;break}return P={application_id:O.id,authentication_id:T.id},e.next=24,(0,E.Rj)().createAuthApp(P);case 24:if((null===(a=i)||void 0===a?void 0:a.id)&&(0,E.Rj)().checkAvailabilitySource(i.id),!O){e.next=30;break}return k=n.includes(O.application_type_id)?1e4:0,e.next=29,(0,Q.h)(O.id,k);case 29:O=e.sent;case 30:if(!S){e.next=34;break}return e.next=33,(0,Q.h)(S.id,void 0,void 0,"getEndpoint");case 33:S=e.sent;case 34:return e.abrupt("return",ee(ee({},i),{},{endpoint:[S],applications:[O]}));case 37:return e.prev=37,e.t0=e.catch(1),e.next=41,(0,K.S)(e.t0,i?i.id:void 0);case 41:throw e.sent;case 43:case"end":return e.stop()}}),e,null,[[1,37]])})));return function(t,r){return e.apply(this,arguments)}}(),ne=r(73881),ie=r(48897);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var oe=function(e){return{isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0}},ce=function(e,t){var r=t.type,n=t.values,i=t.data,s=t.error,a=t.initialValues,o=t.sourceTypes;switch(r){case"reset":return oe(a);case"prepareSubmitState":return ae(ae({},e),{},{isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:n,sourceTypes:o});case"setSubmitted":return ae(ae({},e),{},{isFinished:!0,createdSource:i});case"setErrored":return ae(ae({},e),{},{isErrored:!0,error:s.toString()});case"onStay":return ae(ae({},e),{},{isCancelling:!1});case"showCancelModal":return ae(ae({},e),{},{isCancelling:!0,values:n})}},ue=function(e){var t=e.successfulMessage,r=e.isOpen,n=e.sourceTypes,i=e.applicationTypes,s=e.disableAppSelection,o=e.hideSourcesButton,u=e.returnButtonTitle,l=e.initialValues,f=e.onClose,m=e.afterSuccess,y=e.selectedType,h=e.initialWizardState,b=e.submitCallback,v=(0,d.useReducer)(ce,oe(l)),S=c()(v,2),O=S[0],T=O.isErrored,E=O.isFinished,w=O.isSubmitted,j=O.values,M=O.error,R=O.isCancelling,C=O.createdSource,P=a()(O,["isErrored","isFinished","isSubmitted","values","error","isCancelling","createdSource"]),k=S[1],z=function(e,t,r){return k({type:"prepareSubmitState",values:e,sourceTypes:t}),re(e,t,(0,ie.T2)(i)).then((function(e){m&&m(e),b&&b({isSubmitted:!0,createdSource:e,sourceTypes:t}),k({type:"setSubmitted",data:e})})).catch((function(n){b&&b({isErrored:!0,error:n,values:e,sourceTypes:t,wizardState:r}),k({type:"setErrored",error:n})}))};return r?w?p().createElement(Y,{afterSubmit:function(){f(void 0,C),k({type:"reset",initialValues:l})},afterError:function(){return f({})},isFinished:E,isErrored:T,successfulMessage:t,hideSourcesButton:o,returnButtonTitle:u,errorMessage:M,reset:function(){return k({type:"reset",initialValues:l})},createdSource:C,tryAgain:function(){return z(j,P.sourceTypes)},afterSuccess:m,sourceTypes:P.sourceTypes}):p().createElement(p().Fragment,null,p().createElement(ne.Z,{isOpen:R,onExit:function(){return f(j)},onStay:function(){return k({type:"onStay"})}}),p().createElement(A,{isCancelling:R,values:j,onSubmit:z,onCancel:function(e){return g()(e)?f({}):k({type:"showCancelModal",values:e})},sourceTypes:n,applicationTypes:i,disableAppSelection:s,selectedType:y,initialWizardState:h})):null};ue.propTypes={afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),onClose:m().func.isRequired,isOpen:m().bool.isRequired,successfulMessage:m().node,initialValues:m().shape(l()({},m().string,m().oneOf([m().string,m().array,m().number,m().bool]))),disableAppSelection:m().bool,hideSourcesButton:m().bool,returnButtonTitle:m().node,selectedType:m().string,initialWizardState:m().object,submitCallback:m().func},ue.defaultProps={successfulMessage:p().createElement(h.Z,{id:"wizard.successfulMessage",defaultMessage:"Your source was successfully added."}),initialValues:{},returnButtonTitle:p().createElement(h.Z,{id:"wizard.goBackToSources",defaultMessage:"Go back to Sources"})};var le=function(e){var t=(0,d.useState)(!1),r=c()(t,2),n=r[0],s=r[1];return p().createElement(p().Fragment,null,p().createElement(b.zx,{variant:"primary",onClick:function(){return s(!0)}},(0,j.Z5)()),p().createElement(ue,i()({isOpen:n,onClose:function(){return s(!1)}},e)))}}}]);
//# sourceMappingURL=addSource.af731feceebb78551f28.js.map