(self.webpackChunksources_ui=self.webpackChunksources_ui||[]).push([[2199],{7622:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AddSourceButton:()=>ge,AddSourceWizard:()=>he});var n=r(67154),i=r.n(n),s=r(6479),a=r.n(s),o=r(63038),c=r.n(o),u=r(59713),l=r.n(u),p=r(80150),d=r.n(p),f=r(45697),m=r.n(f),y=r(41609),h=r.n(y),g=r(44012),b=r(47173),v=r(86896),S=r(77583),O=r(34686),w=r(11062),E=r(57061),T=r(97864),j=r(57210),M=r(51863),P=r(86267);function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _={schema:{},sourceTypes:[],isLoading:!0},k=function(e,t){var r=t.type,n=t.sourceTypes,i=t.applicationTypes,s=t.container,a=t.disableAppSelection,o=t.intl,c=t.selectedType,u=t.initialWizardState;switch(r){case"loaded":return C(C({},e),{},{schema:(0,w.ZP)(n.filter(P.Z).filter(P.j),i.filter(M.Z).filter((0,M.W)(n)),a,s,o,c,u),isLoading:!1,sourceTypes:n})}},x=function(e){var t=e.sourceTypes,r=e.applicationTypes,n=e.disableAppSelection,i=e.isCancelling,s=e.onCancel,a=e.values,o=e.onSubmit,u=e.selectedType,l=e.initialWizardState,f=(0,p.useReducer)(k,_),m=c()(f,2),y=m[0],h=y.schema,g=y.sourceTypes,b=y.isLoading,w=m[1],M=(0,p.useRef)(!1),P=(0,p.useRef)(document.createElement("div")),R=(0,v.Z)();return(0,p.useEffect)((function(){M.current=!0;var e=[];return t||e.push((0,E.lH)()),r||e.push((0,E.$l)()),Promise.all(e).then((function(e){var i=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"sourceTypes")})),s=e.find((function(e){return Object.prototype.hasOwnProperty.call(e,"applicationTypes")}));M.current&&w({type:"loaded",sourceTypes:t||i.sourceTypes,applicationTypes:r||s.applicationTypes,disableAppSelection:n,container:P.current,intl:R,selectedType:u,initialWizardState:l})})),function(){M.current=!1}}),[]),(0,p.useEffect)((function(){P.current.style.opacity=i?0:1}),[i]),b?d().createElement(S.e,{className:"sources",isOpen:!0,onClose:s,title:(0,j.Z5)(),description:(0,j.A6)(),steps:[{name:"Loading",component:d().createElement(T.Z,{onClose:function(){return s()}}),isFinishedStep:!0}]}):d().createElement(O.Z,{initialValues:C(C({},a),u&&{source_type:u}),schema:h,onSubmit:function(e,t,r){return o(e,g,r)},onCancel:s})};x.propTypes={onCancel:m().func.isRequired,onSubmit:m().func.isRequired,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),values:m().object,disableAppSelection:m().bool,isCancelling:m().bool,selectedType:m().string,initialWizardState:m().object},x.defaultProps={values:{},disableAppSelection:!1};const A=x;var z=r(68340),Z=r(68774),q=r(88925),D=r(76690),B=r(98409),F=r(12064),W=r(93973),V=r(334),N=r(24859),L=function(e){var t=e.id,r=(0,v.Z)().formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"});return"sources"===insights.chrome.getApp()?d().createElement(V.Link,{to:"/sources/detail/".concat(t)},d().createElement(b.zx,{variant:"primary",className:"pf-u-mt-xl"},r)):d().createElement(b.zx,{variant:"primary",className:"pf-u-mt-xl",component:"a",target:"_blank",href:"".concat((0,N.Z)(),"/detail/").concat(t),rel:"noopener noreferrer"},r)};L.propTypes={id:m().string.isRequired};const U=L;var I=function(e){var t,r,n,i,s,a,o=e.afterSubmit,u=e.afterError,l=e.isFinished,f=e.isErrored,m=e.successfulMessage,y=e.hideSourcesButton,h=e.returnButtonTitle,g=e.reset,O=e.createdSource,w=void 0===O?{}:O,M=e.tryAgain,P=e.afterSuccess,R=e.sourceTypes,C=(0,p.useState)(),_=c()(C,2),k=_[0],x=_[1],A=(0,p.useState)(),V=c()(A,2),N=V[0],L=V[1],I=(0,v.Z)(),Y=d().createElement(b.zx,{variant:"link",onClick:g},I.formatMessage({id:"wizard.addAnotherSource",defaultMessage:"Add another source"}));if(N)a=d().createElement(q.Z,{onClose:o,title:I.formatMessage({id:"wizard.removeSourceSuccessTitle",defaultMessage:"Removing successful"}),successfulMessage:I.formatMessage({id:"wizard.removeSourceSuccessDescription",defaultMessage:"Source was successfully removed."}),hideSourcesButton:y,returnButtonTitle:h,secondaryActions:Y});else if(k)a=d().createElement(T.Z,{customText:I.formatMessage({id:"wizard.removingSource",defaultMessage:"Removing source"})});else if(l)switch((0,W.Z)(w)){case"unavailable":a=d().createElement(D.Z,{onClose:o,secondaryActions:d().createElement(b.zx,{variant:"link",onClick:function(){return x(!0),(0,E.Rj)().removeSource(w.id).then((function(){P&&P(),L(!0)})).catch((function(){return x(!1)}))}},I.formatMessage({id:"wizard.removeSource",defaultMessage:"Remove source"})),Component:function(){return d().createElement(U,{id:w.id})},message:(null===(t=w.applications)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.availability_status_error)||(null===(n=w.endpoint)||void 0===n||null===(i=n[0])||void 0===i?void 0:i.availability_status_error)||I.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:I.formatMessage({id:"wizard.configurationUnsuccessful",defaultMessage:"Configuration unsuccessful"})});break;case"timeout":a=d().createElement(B.Z,{onClose:o,returnButtonTitle:h,secondaryActions:Y});break;default:a=w.source_type_id===(null===(s=R.find((function(e){return"amazon"===e.name})))||void 0===s?void 0:s.id)?d().createElement(F.Z,{onClose:o}):d().createElement(q.Z,{onClose:o,successfulMessage:m,hideSourcesButton:y,returnButtonTitle:h,secondaryActions:Y})}else a=f?d().createElement(D.Z,{onClose:u,primaryAction:M,secondaryActions:d().createElement(z.x,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},I.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"})),returnButtonTitle:I.formatMessage({id:"wizard.retryText",defaultMessage:"Retry"})}):d().createElement(T.Z,{customText:I.formatMessage({id:"wizard.loadingText",defaultMessage:"Validating credentials"}),description:d().createElement(Z.D,null,d().createElement(z.x,{className:"pf-u-mb-md"},I.formatMessage({id:"wizard.loadingDescription-a",defaultMessage:"This might take some time. You'll receive a notification if you are still in the Sources application when the process completes. Otherwise, you can check the status in the main sources table at any time."})),d().createElement(z.x,null,I.formatMessage({id:"wizard.loadingDescription-b",defaultMessage:"In the meantime, you can close this window while the validation process continues."}))),onClose:u,cancelTitle:I.formatMessage({id:"wizard.close",defaultMessage:"Close"})});return d().createElement(S.e,{className:"sources",isOpen:!0,onClose:l?o:u,title:(0,j.Z5)(),description:(0,j.A6)(),steps:[{name:"Finish",component:a,isFinishedStep:!0}]})};I.propTypes={afterSubmit:m().func.isRequired,afterError:m().func.isRequired,isFinished:m().bool.isRequired,isErrored:m().bool.isRequired,successfulMessage:m().node.isRequired,hideSourcesButton:m().bool,returnButtonTitle:m().node.isRequired,errorMessage:m().node,reset:m().func,createdSource:m().object,tryAgain:m().func,afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired}))};const Y=I;var $=r(87757),G=r.n($),H=r(48926),J=r.n(H),K=r(81240),Q=r(8772);function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var te=function(e){return e.url?function(e){if(!e)return{};try{var t=new URL(e);return{scheme:t.protocol.replace(/:$/,""),host:t.hostname,port:t.port,path:t.pathname}}catch(e){return console.log(e),{}}}(e.url):e},re=function(){var e=J()(G().mark((function e(t,r){var n,i,s,a,o,u,l,p,d,f,m,y,h,g,b,v,S,O,w,T,M,P,R,C,_,k=arguments;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k.length>2&&void 0!==k[2]?k[2]:[],e.prev=1,o=r.find((function(e){return e.name===t.source_type})).id,e.next=5,(0,E.Rj)().createSource(ee(ee({},t.source),{},{source_type_id:o}));case 5:return i=e.sent,u=[],t.endpoint?(l=te(t),p=l.scheme,d=l.host,f=l.port,m=l.path,y=parseInt(f,10),h=ee(ee({},t.endpoint),{},{default:!0,source_id:i.id,scheme:p,host:d,port:isNaN(y)?void 0:y,path:m}),u.push((0,E.Rj)().createEndpoint(h))):u.push(Promise.resolve(void 0)),t.application&&t.application.application_type_id&&t.application.application_type_id!==j.Dt?(g=ee(ee({},t.application),{},{source_id:i.id}),u.push((0,E.Rj)().createApplication(g))):u.push(Promise.resolve(void 0)),e.next=11,Promise.all(u);case 11:if(b=e.sent,v=c()(b,2),S=v[0],O=v[1],!(S||t.authentication&&null!==(s=O)&&void 0!==s&&s.id)){e.next=20;break}return R=ee(ee({},t.authentication),{},{resource_id:(null===(T=S)||void 0===T?void 0:T.id)||(null===(M=O)||void 0===M?void 0:M.id),resource_type:null!==(P=S)&&void 0!==P&&P.id?"Endpoint":"Application",source_id:i.id}),e.next=19,(0,E.Rj)().createAuthentication(R);case 19:w=e.sent;case 20:if(!w||!O){e.next=24;break}return C={application_id:O.id,authentication_id:w.id},e.next=24,(0,E.Rj)().createAuthApp(C);case 24:if((null===(a=i)||void 0===a?void 0:a.id)&&(0,E.Rj)().checkAvailabilitySource(i.id),!O){e.next=30;break}return _=n.includes(O.application_type_id)?1e4:0,e.next=29,(0,Q.h)(O.id,_);case 29:O=e.sent;case 30:if(!S){e.next=34;break}return e.next=33,(0,Q.h)(S.id,void 0,void 0,"getEndpoint");case 33:S=e.sent;case 34:return e.abrupt("return",ee(ee({},i),{},{endpoint:[S],applications:[O]}));case 37:return e.prev=37,e.t0=e.catch(1),e.next=41,(0,K.S)(e.t0,i?i.id:void 0);case 41:throw e.sent;case 43:case"end":return e.stop()}}),e,null,[[1,37]])})));return function(t,r){return e.apply(this,arguments)}}(),ne=r(73881),ie=r(48897),se=r(68551),ae=r.n(se),oe=r(93323);function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const le=function(){var e=J()(G().mark((function e(t,r,n){var i,s,a,o,c,u,l;return G().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=new Date,e.next=4,(0,E.Rj)().bulkCreate({sources:[ue(ue({},t.source),{},{source_type_name:t.source_type})],authentications:[ue(ue({},t.authentication),{},{resource_name:t.source.name,resource_type:"source"})],applications:t.applications.map((function(e){return{application_type_id:e,source_name:t.source.name}}))});case 4:return s=e.sent,e.next=7,(0,oe.Z)(s.sources[0].id);case 7:return(a=[]).push((0,Q.h)(s.authentications[0].id,void 0,void 0,"getAuthentication",i)),s.applications.forEach((function(e){var t=e.id;return a.push((0,Q.h)(t,void 0,void 0,"getApplication",i))})),e.next=12,Promise.all(a);case 12:return o=e.sent,c=ae()(o),u=c[0],l=c.slice(1),e.abrupt("return",ue(ue(ue({},s),s.sources[0]),{},{authentications:[u],applications:l}));case 19:return e.prev=19,e.t0=e.catch(0),e.next=23,(0,K.Z)(e.t0);case 23:throw e.sent;case 25:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r,n){return e.apply(this,arguments)}}();var pe=r(56855);function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){l()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var me=function(e){return{isSubmitted:!1,isFinished:!1,isErrored:!1,isCancelling:!1,values:e,createdSource:{},error:void 0}},ye=function(e,t){var r=t.type,n=t.values,i=t.data,s=t.error,a=t.initialValues,o=t.sourceTypes;switch(r){case"reset":return me(a);case"prepareSubmitState":return fe(fe({},e),{},{isFinished:!1,isErrored:!1,error:void 0,isSubmitted:!0,values:n,sourceTypes:o});case"setSubmitted":return fe(fe({},e),{},{isFinished:!0,createdSource:i});case"setErrored":return fe(fe({},e),{},{isErrored:!0,error:s.toString()});case"onStay":return fe(fe({},e),{},{isCancelling:!1});case"showCancelModal":return fe(fe({},e),{},{isCancelling:!0,values:n})}},he=function(e){var t=e.successfulMessage,r=e.isOpen,n=e.sourceTypes,i=e.applicationTypes,s=e.disableAppSelection,o=e.hideSourcesButton,u=e.returnButtonTitle,l=e.initialValues,f=e.onClose,m=e.afterSuccess,y=e.selectedType,g=e.initialWizardState,b=e.submitCallback,v=(0,p.useReducer)(ye,me(l)),S=c()(v,2),O=S[0],w=O.isErrored,E=O.isFinished,T=O.isSubmitted,j=O.values,M=O.error,P=O.isCancelling,R=O.createdSource,C=a()(O,["isErrored","isFinished","isSubmitted","values","error","isCancelling","createdSource"]),_=S[1],k=function(e,t,r){return _({type:"prepareSubmitState",values:e,sourceTypes:t}),((0,pe.Z)(e.source)?le:re)(e,t,(0,ie.T2)(i)).then((function(e){m&&m(e),b&&b({isSubmitted:!0,createdSource:e,sourceTypes:t}),_({type:"setSubmitted",data:e})})).catch((function(n){b&&b({isErrored:!0,error:n,values:e,sourceTypes:t,wizardState:r}),_({type:"setErrored",error:n})}))};return r?T?d().createElement(Y,{afterSubmit:function(){f(void 0,R),_({type:"reset",initialValues:l})},afterError:function(){return f({})},isFinished:E,isErrored:w,successfulMessage:t,hideSourcesButton:o,returnButtonTitle:u,errorMessage:M,reset:function(){return _({type:"reset",initialValues:l})},createdSource:R,tryAgain:function(){return k(j,C.sourceTypes)},afterSuccess:m,sourceTypes:C.sourceTypes}):d().createElement(d().Fragment,null,P&&d().createElement(ne.Z,{onExit:function(){return f(j)},onStay:function(){return _({type:"onStay"})}}),d().createElement(A,{isCancelling:P,values:j,onSubmit:k,onCancel:function(e){return h()(e)?f({}):_({type:"showCancelModal",values:e})},sourceTypes:n,applicationTypes:i,disableAppSelection:s,selectedType:y,initialWizardState:g})):null};he.propTypes={afterSuccess:m().func,sourceTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,product_name:m().string.isRequired,schema:m().shape({authentication:m().array,endpoint:m().object})})),applicationTypes:m().arrayOf(m().shape({id:m().string.isRequired,name:m().string.isRequired,display_name:m().string.isRequired})),onClose:m().func.isRequired,isOpen:m().bool.isRequired,successfulMessage:m().node,initialValues:m().shape(l()({},m().string,m().oneOf([m().string,m().array,m().number,m().bool]))),disableAppSelection:m().bool,hideSourcesButton:m().bool,returnButtonTitle:m().node,selectedType:m().string,initialWizardState:m().object,submitCallback:m().func},he.defaultProps={successfulMessage:d().createElement(g.Z,{id:"wizard.successfulMessage",defaultMessage:"Your source was successfully added."}),initialValues:{},returnButtonTitle:d().createElement(g.Z,{id:"wizard.goBackToSources",defaultMessage:"Go back to Sources"})};var ge=function(e){var t=(0,p.useState)(!1),r=c()(t,2),n=r[0],s=r[1];return d().createElement(d().Fragment,null,d().createElement(b.zx,{variant:"primary",onClick:function(){return s(!0)}},(0,j.Z5)()),d().createElement(he,i()({isOpen:n,onClose:function(){return s(!1)}},e)))}}}]);
//# sourceMappingURL=addSource.ea4c3880f2db0451ba5d.js.map