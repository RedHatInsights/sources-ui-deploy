(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{294:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(290),o=n.n(r),a=n(0),c=n.n(a),i=n(3),s=n.n(i),u=n(378),p=n.n(u),l=n(43),f=n(333),d="edit-field",m=function(e){var t=e.isRequired,n=e.label,r=e.helperText,o=e.hideLabel,a=e.meta,i=e.input,s=e.type,u=e.setEdit,d=a.error,m=a.touched&&d,b=i.value;"boolean"==typeof b&&(b=b?"True":"False");var O="password"===s||i.name.includes("password")?"Click to edit":"Click to add";return c.a.createElement(f.FormGroup,{isRequired:t,label:!o&&n,fieldId:i.name,isValid:!m,helperText:r,helperTextInvalid:d,onClick:u?function(){return u(i.name)}:void 0,tabIndex:0,onKeyPress:function(e){32===e.charCode&&u&&(e.preventDefault(),u(i.name))}},c.a.createElement("div",{className:"pf-c-form__horizontal-group ins-c-sources__edit-field-group ".concat(u?"clickable":"")},c.a.createElement(l.TextContent,{className:"ins-c-sources__edit-field-group-text-content ".concat(u?"clickable":"")},c.a.createElement("span",{className:"ins-c-sources__edit-field-value pf-u-mr-sm"},b||(u?O:"")),u&&c.a.createElement(p.a,null))))};m.propTypes={label:s.a.node,isRequired:s.a.bool,helperText:s.a.string,meta:s.a.object.isRequired,FieldProvider:s.a.oneOfType([s.a.node,s.a.func]),input:s.a.shape({value:s.a.any,name:s.a.string.isRequired}).isRequired,hideLabel:s.a.bool,setEdit:s.a.func,type:s.a.string};var b=function(e){var t=e.FieldProvider,n=o()(e,["FieldProvider"]);return c.a.createElement(t,n,(function(e){return c.a.createElement(m,e)}))};b.propTypes={FieldProvider:s.a.oneOfType([s.a.node,s.a.func]).isRequired},t.b=b},377:function(e,t,n){"use strict";var r=n(306),o=n.n(r),a=n(1),c=n.n(a),i=n(0),s=n.n(i),u=n(281),p=n.n(u),l=n(332),f=n(286),d=n(294);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return s.a.createElement(p.a,o()({layoutMapper:l.layoutMapper,formFieldsMapper:b({},l.formFieldsMapper,{},f.mapperExtension,{"edit-field":d.b})},e))}},685:function(e,t,n){"use strict";n.r(t);var r=n(37),o=n.n(r),a=n(1),c=n.n(a),i=n(0),s=n.n(i),u=n(30),p=n(29),l=n(276),f=n(318),d=n(332),m=n(629),b=n(377),O=n(24),y=n.n(O),h=n(11),g=n(281),j=n(286),v=n(294);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=function(e,t,n){return[P({name:"source.name",label:s.a.createElement(h.a,{id:"sources.sourceName",defaultMessage:"Source name"}),component:e["source.name"]?g.componentTypes.TEXT_FIELD:v.a},e["source.name"]?{}:{setEdit:t},{validate:[function(e){return Object(j.asyncValidator)(e,n)}],isRequired:!0}),{name:"source_type",label:s.a.createElement(h.a,{id:"sources.sourceType",defaultMessage:"Source type"}),isReadOnly:!0,component:v.a}]},S=n(295),D=n.n(S),M=n(26),T=n(43);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=function(e,t,n,r){return e.map((function(e){var o=e.name.startsWith("authentication")?function(e,t){return"authentications.a".concat(t,".").concat(e.replace("authentication.",""))}(e.name,t):e.name,a=n[o],c=R({},e,{name:o,component:a?e.component:v.a});return a||(c.setEdit=r),"password"===c.name.split(".").pop()&&(c.helperText=s.a.createElement(h.a,{id:"sources.passwordResetHelperText",defaultMessage:"Changing this resets your current { label }.",values:{label:c.label}}),c.isRequired=!1,c.validate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){return e.type!==g.validatorTypes.REQUIRED}))}(c.validate)),c}))},C=function(e,t,n,r){return e&&0!==e.length&&t.schema&&t.schema.authentication?e.map((function(e){var o,a=t.schema.authentication.find((function(t){return t.type===e.authtype}));if(!a)return o=e.authtype,{component:"description",name:"".concat(o,"-unsupported"),Content:function(){return s.a.createElement(T.TextContent,null,s.a.createElement(M.Text,{component:M.TextVariants.p},s.a.createElement(h.a,{id:"sources.unsupportedAuthType",defaultMessage:"Authentication type of { type } is no longer supported.",values:{type:o}})))}};var c=function(e,t){return D()(j.hardcodedSchemas,[e,"authentication",t,"generic","includeStepKeyFields"],[])}(t.name,e.authtype),i=a.fields.filter((function(e){return!e.stepKey||c.includes(e.stepKey)})).map((function(n){return R({},n,{},function(e,t,n){return D()(j.hardcodedSchemas,[e,"authentication",t,"generic",n],{})}(t.name,e.authtype,n.name))}));return{component:g.componentTypes.SUB_FORM,title:a.name,name:a.name,fields:[F(i,e.id,n,r)]}})):[]};function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var x=[g.componentTypes.CHECKBOX,g.componentTypes.SWITCH],I=function(e,t,n){return e.map((function(e){var r=t[e.name],o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{component:r||x.includes(e.component)?e.component:v.a});return r||x.includes(e.component)||(o.setEdit=n),o}))};function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var q=function(e,t,n){if(e.schema&&e.schema.endpoint&&!e.schema.endpoint.hidden){var r=e.schema.endpoint.fields.map((function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},function(e,t){return D()(j.hardcodedSchemas,[e,"endpoint",t],{})}(e.name,t.name))}));return{component:g.componentTypes.SUB_FORM,title:s.a.createElement(h.a,{id:"sources.endpoint",defaultMessage:"Endpoint"}),name:"endpoint",fields:I(r,t,n)}}};function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A="/insights/platform/cost-management",B=["billing_source","credentials"],K=function(e){var t=e.name;return B.some((function(e){return t.startsWith(e)}))},U=function(e){return Object.keys(e).map((function(t){return e[t].fields.filter(K)})).flatMap((function(e){return e}))},G=function(e,t,n){var r=void 0;return n.forEach((function(n){var o=r?{}:D()(j.hardcodedSchemas,[e,"authentication",n],{});Object.keys(o).find((function(o){var a=D()(j.hardcodedSchemas,[e,"authentication",n,o,t],void 0);if(a)return r=a,!0}))})),r||{}},H=function(e,t,n){return"openshift"===n.name?[N({name:"source.source_ref",label:s.a.createElement(h.a,{id:"sources.clusterIdentifier",defaultMessage:"Cluster identifier"}),isRequired:!0},e["source.source_ref"]?{}:{setEdit:t},{validate:[{type:g.validatorTypes.REQUIRED}],component:e["source.source_ref"]?g.componentTypes.TEXT_FIELD:v.a})]:[]},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,c=o.find((function(e){return e.name===A}));if(c){var i=e.find((function(e){return e.application_type_id===c.id}));if(i){var s=U(t.schema.authentication),u=a.authentications?a.authentications.map((function(e){return e.authtype})):[],p=s.map((function(e){return N({},e,{},G(t.name,e.name,u))}));return{component:g.componentTypes.SUB_FORM,title:c.display_name,name:c.display_name,fields:[].concat(y()(I(p,n,r)),y()(H(n,r,t)))}}}},z=function(e,t,n,r,o,a){return[W(e,t,n,r,o,a)]},X=function(e,t,n,r,o){return{fields:[].concat(y()(w(t,n,e.source.id)),y()(C(e.authentications,r,t,n)),y()(z(e.applications,r,t,n,o,e)),[!!(e.endpoints&&e.endpoints.length>0)&&q(r,t,n)]).filter(Boolean)}},J=n(14),Q=n(9);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=n(306),ee=n.n($),te=n(290),ne=n.n(te),re=n(3),oe=n.n(re),ae=n(453),ce=function(e){var t=e.children,n=ne()(e,["children"]);return s.a.createElement(ae.Form,ee()({},n,{isHorizontal:!0}),t)};ce.propTypes={children:oe.a.node};var ie=ce,se=n(314),ue=n(315),pe=n(127),le=function(){return s.a.createElement(se.Grid,null,s.a.createElement(ue.GridItem,{xs:12},s.a.createElement(pe.Title,{headingLevel:pe.TitleLevel.h1,size:"3xl"},s.a.createElement(h.a,{id:"sources.editSource",defaultMessage:"Edit source"}))),s.a.createElement(ue.GridItem,{xs:12},s.a.createElement(h.a,{id:"sources.editSourceDescription",defaultMessage:"You are editing a source."})))},fe=n(627),de=n.n(fe),me=n(85);function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Oe=function(e,t){var n,r,o=e.endpoints,a=e.authentications,i=ne()(e,["endpoints","authentications"]),s={};return a&&a.length>0&&a.forEach((function(e){s["a".concat(e.id)]=e})),o&&o.length>0&&(n=o[0]),n&&(r=n.scheme||n.host||n.path||n.port?Object(me.b)(n):void 0),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({source_type:t,endpoint:n,authentications:s,url:r},i)},ye=n(44),he=n(79),ge=n(365),je=function(e,t,n,r,o,a){return n(Object(ye.o)(r,function(e,t){var n={};return Object.keys(t).filter((function(e){return t[e]})).forEach((function(t){de()(n,t,D()(e,t))})),n}(e,t),o.formatMessage({id:"sources.modifiedNotificationTitle",defaultMessage:'"{ name }" was modified successfully.'},{name:r.source.name}),o.formatMessage({id:"sources.modifiedNotificationDescription",defaultMessage:"The source was successfully modified."}),{authentication:o.formatMessage({id:"sources.sourceEditAuthFailure",defaultMessage:"Authentication update failure."}),source:o.formatMessage({id:"sources.sourceEditFailure",defaultMessage:"Source update failure."}),endpoint:o.formatMessage({id:"sources.sourceEditEndpointFailure",defaultMessage:"Endpoint update failure."}),costManagement:o.formatMessage({id:"sources.sourceCostmanagementFailure",defaultMessage:"Cost Management update failure."})})).then((function(){Object(ge.a)(r.source.id),a(he.c.sources.path),n(Object(ye.g)())}))};function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe={loading:!0,editing:{},source:void 0,initialValues:{},sourceType:void 0,schema:void 0},we=function(e,t){return Ee({},e,{},t)};t.default=function(){var e=Object(i.useReducer)(we,Pe),t=o()(e,2),n=t[0],r=t[1],a=Object(p.h)().id,O=Object(p.f)(),y=n.loading,h=n.editing,g=n.source,j=n.initialValues,v=n.sourceType,E=n.schema,P=Object(l.a)(),w=Object(u.useSelector)((function(e){return e.sources}),u.shallowEqual),S=w.sourceTypes,D=w.appTypes,M=w.sourceTypesLoaded,T=w.appTypesLoaded,_=Object(u.useDispatch)();Object(i.useEffect)((function(){(function(e){return Promise.all([Object(J.i)().showSource(e),Object(J.i)().listSourceEndpoints(e),Object(J.i)().listSourceApplications(e),(t=e,J.a.get("".concat(Q.a,"/sources/").concat(t,"/"))).catch((function(){}))]).then((function(e){var t=o()(e,4),n=t[0],r=t[1],a=t[2],c=t[3],i=r&&r.data&&r.data[0],s={source:n,applications:a.data};return c&&(s=Z({},s,{billing_source:c.billing_source,credentials:c.authentication.credentials})),i?Object(J.i)().listEndpointAuthentications(i.id).then((function(e){return Z({},s,{endpoints:r.data,authentications:e.data})})):s}));var t})(a).then((function(e){e.source.imported&&function(e,t,n,r){e(Object(ye.b)(t.formatMessage({id:"sources.importSourceCannotEdited",defaultMessage:"Source { name } is imported."},{name:r}),"danger",t.formatMessage({id:"sources.importedSourcesCannotEdited",defaultMessage:"Imported sources cannot be edited."}))),n.push(he.c.sources.path)}(_,P,O,e.source.name),r({source:e})}))}),[]);var R=function(e){return r({editing:Ee({},h,c()({},e,!h[e]))})};Object(i.useEffect)((function(){if(g&&T&&M){var e=S.find((function(e){return e.id===g.source.source_type_id}));r({sourceType:e,initialValues:Oe(g,e.product_name),schema:X(g,h,R,e,D),loading:!1})}}),[T,g,M]),Object(i.useEffect)((function(){g&&!y&&r({schema:X(g,h,R,v,D)})}),[h]);var F=function(){return O.push(he.c.sources.path)};return!T||!M||y?s.a.createElement(m.Modal,{title:P.formatMessage({id:"sources.editSource",defaultMessage:"Edit source."}),header:s.a.createElement(le,null),isOpen:!0,isLarge:!0,onClose:F},s.a.createElement("div",{className:"ins-c-sources__dialog--spinnerContainer"},s.a.createElement(f.Spinner,null))):s.a.createElement(m.Modal,{title:P.formatMessage({id:"sources.editSource",defaultMessage:"Edit source."}),header:s.a.createElement(le,null),isOpen:!0,isLarge:!0,onClose:F},s.a.createElement(b.a,{onCancel:F,schema:E,onSubmit:function(e,t){return je(e,t.getState().dirtyFields,_,g,P,O.push)},layoutMapper:Ee({},d.layoutMapper,{FormWrapper:ie}),clearedValue:null,canReset:!0,disableSubmit:["submitting"],onReset:function(){return r({editing:{}})},initialValues:j,buttonsLabels:{submitLabel:P.formatMessage({id:"sources.save",defaultMessage:"Save"})}}))}}}]);
//# sourceMappingURL=../sourcemaps/edit.js.map