(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{615:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(45),i=function(e){return Object(a.j)().checkAvailabilitySource(e).catch((function(){}))}},625:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return p}));var a=n(4),i=n.n(a),r=n(62),o=n(45),c=n(17);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=function(e){return e.url||null===e.url?function(e){if(null===e)return{scheme:null,host:null,port:null,path:null};if(!e)return{};try{var t=new URL(e),n=t.protocol.replace(/:$/,"");return{scheme:n,host:t.hostname,port:""===t.port?Object(r.e)(n):t.port,path:t.pathname}}catch(e){return{}}}(e.url):e.endpoint?e.endpoint:e},p=function(e,t){var n,a,i=[];if(t.source&&i.push(Object(o.j)().updateSource(e.source.id,t.source)),t.endpoint||t.url||null===t.url){var r=l(t),s=r.scheme,p=r.host,d=r.port,f=r.path,m=null===d?null:parseInt(d,10),h=u({scheme:s,host:p,path:f,port:null===m?null:isNaN(m)?void 0:m},t.endpoint);i.push(Object(o.j)().updateEndpoint(e.endpoints[0].id,h))}if(t.authentications&&Object.keys(t.authentications).forEach((function(e){var n=e.replace("a","");i.push(Object(o.j)().updateAuthentication(n,t.authentications[e]))})),t.billing_source||t.credentials){var g={};t.credentials&&(g={authentication:{credentials:t.credentials}}),t.billing_source&&(g=u(u({},g),{},{billing_source:t.billing_source})),i.push((n=e.source.id,a=g,o.a.patch("".concat(c.a,"/sources/").concat(n,"/"),a)))}return Promise.all(i)}},627:function(e,t,n){"use strict";var a=n(155),i=n.n(a),r=n(4),o=n.n(r),c=n(0),s=n.n(c),u=n(509),l=n.n(u),p=n(484),d=n.n(p),f=n(512),m=n.n(f),h=n(611),g=n(44),b=n.n(g),v=n(457),y=n.n(v),O=n(452),j=n(474),w=n(606),E=n.n(w),_=n(451),T=n.n(_),M=n(454),A=n.n(M),P=n(559),x=n.n(P);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=function(e){var t,n,a=T()(),r=a.getState().values,o=(null==e||null===(t=e.name)||void 0===t?void 0:t.match(/\d+/))||[],u=b()(o,1)[0]||(null===(n=r.authentication)||void 0===n?void 0:n.id),l=y()(r,e.name),p=Object(c.useState)(!u||l),d=b()(p,2),f=d[0],m=d[1],h=Object(c.useRef)(!0),g=Object(c.useRef)(!1);Object(c.useEffect)((function(){g.current&&(!h.current&&a.getState().pristine&&(m(!1),h.current=!0),f&&(h.current=!1))})),Object(c.useEffect)((function(){g.current=!0}),[]);var v=e.validate&&e.validate.filter((function(e){return e.type!==A.a.REQUIRED})),w=k(k({},e),u?{validate:v,resolveProps:x.a}:{});return!f&&u?s.a.createElement(O.FormGroup,{helperText:w.helperText,label:w.label,onFocus:function(){return m(!0)},isRequired:!0},s.a.createElement(j.TextInput,{"aria-label":"pre-filled-authentication",value:"•••••••••••••"})):s.a.createElement(E.a,i()({},w,{autoFocus:!0}))};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=function(e){return s.a.createElement(l.a,i()({FormTemplate:d.a,componentMapper:R(R(R({},m.a),h.mapperExtension),{},{authentication:D})},e))}},720:function(e,t,n){"use strict";var a=n(67);t.a=function(e,t,n,i,r){var o=t.formatMessage({id:"sources.removeAppWarning",defaultMessage:"{ name } was removed from this source."},{name:e.display_name}),c=t.formatMessage({id:"sources.removeAppError",defaultMessage:"Removing of { name } application from this source was unsuccessful."},{name:e.display_name});return n&&n(),i(Object(a.i)(e.id,r.id,o,c))}},977:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(36),o=n(277),c=n(13),s=n(59),u=n(91),l=n(151),p=n(532),d=n(153),f=n(244),m=n.n(f),h=n(456),g=n(720),b=n(82);t.default=function(){var e,t=Object(o.a)(),n=Object(c.k)().push,a=Object(c.m)().app_id,f=Object(h.a)(),v=Object(r.useSelector)((function(e){return e.sources.appTypes})),y=Object(r.useDispatch)(),O=null===(e=f.applications)||void 0===e?void 0:e.find((function(e){return e.id===a}));if(!O)return i.a.createElement(c.c,{to:Object(b.b)(b.c.sourcesDetail.path,f.id)});var j=v.find((function(e){return e.id===(null==O?void 0:O.application_type_id)})),w={id:a,display_name:null==j?void 0:j.display_name,dependent_applications:null==j?void 0:j.dependent_applications,sourceAppsNames:f.applications.map((function(e){var t,n=e.application_type_id;return null===(t=v.find((function(e){return e.id===n})))||void 0===t?void 0:t.display_name}))},E=function(){return n(Object(b.b)(b.c.sourcesDetail.path,f.id))},_=null==j?void 0:j.dependent_applications.map((function(e){var t,n=v.find((function(t){return t.name===e}));return(null==f||null===(t=f.applications)||void 0===t?void 0:t.find((function(e){return e.application_type_id===n.id})))&&(null==n?void 0:n.display_name)})).filter(Boolean);return i.a.createElement(p.Modal,{className:"ins-c-sources__dialog--warning",isOpen:!0,onClose:E,variant:"small","aria-label":t.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"}),header:i.a.createElement(d.Title,{headingLevel:"h1",size:"2xl"},i.a.createElement(m.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),t.formatMessage({id:"sources.deleteAppTitle",defaultMessage:"Remove application?"})),actions:[i.a.createElement(l.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){return Object(g.a)(w,t,E,y,f)}},t.formatMessage({id:"sources.remove",defaultMessage:"Remove"})),i.a.createElement(l.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:E},t.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}))]},i.a.createElement(u.TextContent,null,i.a.createElement(s.Text,{component:s.TextVariants.p},t.formatMessage({id:"sources.deleteAppWarning",defaultMessage:"{ appName } will be disconnected from this source."},{appName:i.a.createElement("b",{key:"b"},w.display_name)})),_.length>0&&i.a.createElement(s.Text,{component:s.TextVariants.p},t.formatMessage({id:"sources.deleteAppDetails",defaultMessage:"This change will affect these applications: { apps }."},{apps:_}))))}},978:function(e,t,n){"use strict";n.r(t),n.d(t,"onSubmit",(function(){return Je}));var a=n(122),i=n.n(a),r=n(44),o=n.n(r),c=n(155),s=n.n(c),u=n(127),l=n.n(u),p=n(160),d=n.n(p),f=n(0),m=n.n(f),h=n(13),g=n(66),b=n(36),v=n(277),y=n(618),O=n.n(y),j=n(594),w=n.n(j),E=n(713),_=n.n(E),T=n(616),M=n.n(T),A=n(617),P=n.n(A),x=n(948),S=n.n(x),k=n(711),D=n.n(k),C=n(712),R=n.n(C),V=n(484),N=n.n(V),F=n(67),B=n(627),L=n(4),z=n.n(L),I=n(37),U=n.n(I),W=n(453),q=n.n(W),Q=n(59),J=n(91),Y=n(714),G=n(457),K=n.n(G),X=n(454),Z=n.n(X),$=function(e,t,n,a){return{name:"selectAuthType-".concat(t.id),title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication type"}),fields:[{component:q.a.RADIO,name:"authtype",options:t.supported_authentication_types[e.name].map((function(t){var n;return{value:t,label:(null===(n=e.schema.authentication.find((function(e){return e.type===t})))||void 0===n?void 0:n.name)||"Unknown type"}})),isRequired:!0,validate:[{type:Z.a.REQUIRED}]}],nextStep:function(t){var n=t.values,i=n.application,r=n.authtype;if(r)return a.find((function(e){return e.authtype===r}))?"selectAuthentication":"".concat(e.name,"-").concat(i&&i.application_type_id,"-").concat(r)}}};function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te=function(e,t,n,a,i){var r=U()(n);Y.shouldUseAppAuth(e.name,a,t.name)&&(r=[]);var o,c=e.schema.authentication.find((function(e){return e.type===a})),s="".concat(e.name,"-").concat(a,"-").concat(t.name,"-additional-step"),u=Y.shouldSkipEndpoint(e.name,a,t.name),l=Y.hasCustomSteps(e.name,a,t.name);o=Y.getAdditionalSteps(e.name,a,t.name).length>0?s:0!==n.length||u?"summary":"".concat(e.name,"-endpoint");var p=Y.getAdditionalStepKeys(e.name,a,t.name),d={};if(Y.shouldSkipSelection(e.name,a,t.name)){var f=Y.getAdditionalSteps(e.name,a,t.name).find((function(e){return!e.name})),m=Y.getAdditionalStepFields(c.fields,s);o=f.nextStep?f.nextStep:0!==n.length||u||l?"summary":"".concat(e.name,"-endpoint"),d=ee(ee({},f),{},{fields:[].concat(U()(r),U()(Y.injectAuthFieldsInfo([].concat(U()(f.fields),U()(m)),e.name,a,t.name)))})}return ee({name:"".concat(e.name,"-").concat(t.id,"-").concat(a),title:i.formatMessage({id:"sources.configureCredentials",defaultMessage:"Configure credentials"}),fields:[].concat(U()(r),U()(Y.getAdditionalAuthFields(e.name,a,t.name)),U()(Y.injectAuthFieldsInfo(Y.getNoStepsFields(c.fields,p),e.name,a,t.name))),nextStep:o},d)},ne=n(14),ae=n.n(ne),ie=n(451),re=n.n(ie),oe=function(e){var t=e.authenticationValues,n=re()(),a=n.getState().values.selectedAuthentication,i=Object(f.useState)(a),r=o()(i,2),c=r[0],s=r[1];return Object(f.useEffect)((function(){c!==a&&(!function(e){var t=e.formOptions,n=e.authenticationValues,a=e.selectedAuthentication;if(a.startsWith("new-")){var i=a.replace("new-","");t.change("authentication",{authtype:i})}else{var r=n.find((function(e){return e.id===a}));t.change("authentication",r)}}({formOptions:n,authenticationValues:t,selectedAuthentication:a}),s(void 0))}),[a]),null};oe.propTypes={authenticationValues:ae.a.arrayOf(ae.a.object)};var ce=function(e){var t=e.applicationTypeName,n=e.authenticationTypeName,a=Object(v.a)();return m.a.createElement(J.TextContent,null,m.a.createElement(Q.Text,{component:Q.TextVariants.p},a.formatMessage({id:"sources.selectAuthenticationDescription",defaultMessage:"Selected application { applicationTypeName } supports { authenticationTypeName } authentication type. You can use already defined authentication values or define new."},{applicationTypeName:t,authenticationTypeName:n})))};ce.propTypes={applicationTypeName:ae.a.string,authenticationTypeName:ae.a.string};var se=function(e){var t=e.authenticationValues,n=e.supportedAuthTypeName,a=e.supportedAuthType,i=e.applicationTypes,r=e.source;return t.filter((function(e){return e.authtype===a})).map((function(e){var t=e.username?"-".concat(e.username):"",a=r.applications.find((function(t){return t.authentications.find((function(t){return t.id===e.id}))})),o=a&&a.application_type_id?i.find((function(e){return e.id===a.application_type_id})):"",c=o?"-".concat(o.display_name):"-unused-".concat(e.id);return{label:"".concat(n).concat(t).concat(c),value:e.id}}))},ue=function(e){var t,n=e.intl,a=e.source,i=e.authenticationValues,r=e.sourceType,o=e.app,c=e.applicationTypes,s=[{component:"description",name:"authtypesetter",Content:oe,authenticationValues:i,hideField:!0}],u=o.supported_source_types.includes(r.name),l=!(null===(t=a.applications)||void 0===t?void 0:t.find((function(e){return e.application_type_id===o.id})));u&&l&&K()(o,"supported_authentication_types[".concat(r.name,"]"),[]).forEach((function(e){if(i.find((function(t){return t.authtype===e}))){var t=K()(r,"schema.authentication",{}).find((function(t){return t.type===e})).name;s.push({component:q.a.SUB_FORM,name:"".concat(o.name,"-subform"),fields:[{name:"".concat(o.name,"-select-authentication-summary"),component:"description",Content:ce,applicationTypeName:o.display_name,authenticationTypeName:t},{component:q.a.RADIO,name:"selectedAuthentication",label:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),isRequired:!0,validate:[{type:Z.a.REQUIRED}],options:[{label:n.formatMessage({id:"sources.selectAuthenticationradioLabel",defaultMessage:"Define new { supportedAuthTypeName }"},{supportedAuthTypeName:t}),value:"new-".concat(e)}].concat(U()(se({authenticationValues:i,supportedAuthTypeName:t,supportedAuthType:e,applicationTypes:c,source:a})))}]})}}));return{name:"selectAuthentication",title:n.formatMessage({id:"sources.selectAuthenticationTitle",defaultMessage:"Select authentication"}),fields:s,nextStep:function(e){var t=e.values,n=t.authtype,a=t.authentication;return"".concat(r.name,"-").concat(o.id,"-").concat(n||(null==a?void 0:a.authtype))}}};function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var de=function(){var e=Object(v.a)();return m.a.createElement(J.TextContent,null,m.a.createElement(Q.Text,{component:Q.TextVariants.p},e.formatMessage({id:"sources.reviewAddAppSummary",defaultMessage:"Review the information below and click Add to add the application to your source. Use the Back button to make changes."})))},fe=function(e,t,n,a,i,r,o,c,s){var u,l,p,d=[];if(!i.imported){var f,m=t.schema.endpoint.hidden?t.schema.endpoint.fields:[],h=0===m.length;n.supported_source_types.includes(t.name)&&n.supported_authentication_types[t.name].forEach((function(a){d.push(te(t,n,m,a,e))})),t.schema.authentication.forEach((function(e){if(n.supported_source_types.includes(t.name)){var a=Y.getAdditionalSteps(t.name,e.type,n.name);a.length>0&&d.push.apply(d,U()(Y.createAdditionalSteps(a,t.name,e.type,h,e.fields,n.name)))}})),h&&d.push(Y.createEndpointStep(t.schema.endpoint,t.name)),u=d[0],(l=(null==n||null===(f=n.supported_authentication_types[t.name])||void 0===f?void 0:f.length)>1)&&(u=$(t,n,e,a)),(p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.find((function(e){return e.authtype===K()(t,"supported_authentication_types.".concat(n,"[0]"))}))}(a,n,t.name))&&(u=ue({intl:e,source:i,authenticationValues:a,sourceType:t,app:n,applicationTypes:s}))}var g={component:q.a.TEXT_FIELD,name:"application.application_type_id",hideField:!0,initialValue:n.id};return{fields:[{component:q.a.WIZARD,name:"wizard",title:o,inModal:!0,container:r,showTitles:!0,crossroads:["selectedAuthentication","authtype"],description:c,buttonLabels:{submit:e.formatMessage({id:"sources.add",defaultMessage:"Add"}),cancel:e.formatMessage({id:"sources.cancel",defaultMessage:"Cancel"}),back:e.formatMessage({id:"sources.back",defaultMessage:"Back"})},fields:[].concat(U()(i.imported?[]:[pe(pe({},u),{},{fields:[].concat(U()(u.fields),[g])})]),[{title:e.formatMessage({id:"sources.reviewDetails",defaultMessage:"Review details"}),name:"summary",fields:[{component:"description",name:"description-summary",Content:de},{component:"summary",name:"summary",sourceTypes:[t],applicationTypes:[n]}].concat(U()(i.imported?[g]:[]))}],U()(p||l?d:d.splice(1)))}]}},me=n(709),he=function(e){var t=e.step,n=e.goToSources,a=e.title,i=e.description;return m.a.createElement(me.Wizard,{isOpen:!0,onClose:n,title:a,description:i,steps:[{name:"Finish",component:t,isFinishedStep:!0}]})};he.propTypes={step:ne.PropTypes.node.isRequired,goToSources:ne.PropTypes.func.isRequired,title:ne.PropTypes.string,description:ne.PropTypes.string};var ge=he,be=n(45),ve=n(456),ye=n(491),Oe=n(62),je=n(82),we=n(279),Ee=n.n(we),_e=n(715),Te=n(561),Me=n(562),Ae=n(560),Pe=n(459),xe=n(951),Se=n.n(xe),ke=n(952),De=n.n(ke),Ce=n(625);function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ne=function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===Ee()(t[n])?O()(t[n])?delete t[n]:e(t[n]):void 0===t[n]&&delete t[n]})),t},Fe=function(){var e=d()(l.a.mark((function e(t,n,a,r){var c,s,u,p,d,f,m,h,g,b,v,y,j,w,E,_,T,M,A,P,x,S,k,D,C,R,V,N,F,B,L,z,I,U,W,q,Q,J,Y,G,K,X,Z,$,H,ee,te,ne=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=ne.length>4&&void 0!==ne[4]?ne[4]:[],p=n.getState(),d=p.values,f=null===(c=d.authentication)||void 0===c?void 0:c.id,m=f&&a.find((function(e){return e.id===f})),h=t.authentication,g=i()(t,["authentication"]),b=Object(_e.addedDiff)(r,g),v=Object(_e.updatedDiff)(r,g),y=Object(_e.addedDiff)(m,h),j=Object(_e.updatedDiff)(m,h),w=Ne(Ve(Ve({},Se()(De()(b),v)),{},{authentication:Ve({},Se()(De()(y),j))})),e.prev=11,null==d||null===(E=d.source)||void 0===E?void 0:E.id){e.next=14;break}throw"Missing source id";case 14:return A=new Date,P=d.source.id,x=null==d||null===(_=d.endpoint)||void 0===_?void 0:_.id,S=[],w.source&&!O()(w.source)?S.push(Object(be.j)().updateSource(P,w.source)):S.push(Promise.resolve(void 0)),k=w.endpoint&&!O()(w.endpoint),D=w.url&&!O()(w.url),k||D?(C=Object(Ce.b)(w),R=C.scheme,V=C.host,N=C.port,F=C.path,B=parseInt(N,10),L=Ne(Ve(Ve({},w.endpoint),{},{scheme:R,host:V,port:isNaN(B)?void 0:B,path:F})),x?S.push(Object(be.j)().updateEndpoint(x,L)):(z=Ve(Ve({},L),{},{default:!0,source_id:P}),S.push(Object(be.j)().createEndpoint(z)))):S.push(Promise.resolve(void 0)),(null===(T=w.application)||void 0===T?void 0:T.application_type_id)?S.push(Object(be.b)(P,w.application.application_type_id)):S.push(Promise.resolve(void 0)),e.next=25,Promise.all(S);case 25:if(I=e.sent,U=o()(I,3),U[0],W=U[1],q=U[2],!w.authentication||O()(w.authentication)){e.next=41;break}if(!f){e.next=37;break}return e.next=34,Object(be.j)().updateAuthentication(f,w.authentication);case 34:Q=e.sent,e.next=41;break;case 37:return J=Ve(Ve({},w.authentication),{},{resource_id:(null==W?void 0:W.id)||(null==q?void 0:q.id),resource_type:(null==W?void 0:W.id)?"Endpoint":"Application"}),e.next=40,Object(be.j)().createAuthentication(J);case 40:Q=e.sent;case 41:return u=null==q?void 0:q.id,Y=f||(null===(M=Q)||void 0===M?void 0:M.id),G=[],(null==q?void 0:q.id)&&Y&&(K={application_id:q.id,authentication_id:Y},G.push(Object(be.j)().createAuthApp(K))),(w.credentials||w.billing_source)&&(X=w.credentials,Z=w.billing_source,$={},$=X?{authentication:{credentials:X}}:{},$=Z?Ve(Ve({},$),{},{billing_source:Z}):$,G.push(Object(Te.patchSource)(Ve({id:P},$)))),e.next=49,Promise.all(G);case 49:if(!x){e.next=53;break}return e.next=52,Object(Ae.checkAppAvailability)(x,void 0,void 0,"getEndpoint",A);case 52:H=e.sent;case 53:if(!q){e.next=59;break}return ee=Object(Pe.timeoutedApps)(s).includes(q.application_type_id)?1e4:0,e.next=57,Object(Ae.checkAppAvailability)(q.id,ee);case 57:return te=e.sent,e.abrupt("return",Ve({id:te.id,applications:[te]},H&&{endpoint:[H]}));case 59:return e.abrupt("return",{});case 62:if(e.prev=62,e.t0=e.catch(11),console.error(e.t0),!u){e.next=68;break}return e.next=68,Object(be.j)().deleteApplication(u);case 68:return e.next=70,Object(Me.handleError)(e.t0);case 70:throw e.sent;case 72:case"end":return e.stop()}}),e,null,[[11,62]])})));return function(t,n,a,i){return e.apply(this,arguments)}}(),Be=n(615);function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){z()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie={state:"loading",error:"",values:{},authenticationsValues:[],sourceAppsLength:0,initialValues:{},isCancelling:!1},Ue=function(e,t){var n=t.type,a=t.length,i=t.authenticationsValues,r=t.initialValues,o=t.error,c=t.values,s=t.data,u=t.formApi;switch(n){case"setSourceAppslength":return ze(ze({},e),{},{sourceAppsLength:a});case"loadAuthentications":return ze(ze({},e),{},{authenticationsValues:i,initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"loadWithoutAuthentications":return ze(ze({},e),{},{initialValues:r,values:{},state:"loading"===e.state?"wizard":e.state});case"reset":return ze(ze({},e),{},{state:"wizard"});case"submit":return ze(ze({},e),{},{values:c,formApi:u,state:"submitting"});case"finish":return ze(ze({},e),{},{state:"finished",data:s});case"error":return ze(ze({},e),{},{state:"errored",error:o});case"toggleCancelling":return ze(ze({},e),{},{isCancelling:!e.isCancelling},c&&{values:c});default:return e}},We=n(93),qe=n(969),Qe=n(720),Je=function(e,t,n,a,i,r,o,c){return i({type:"submit",values:e,formApi:t}),Fe(e,t,n,r,o).then(function(){var e=d()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Be.a)(r.source.id),e.next=3,a(Object(F.f)());case 3:return c({values:{application:null}}),e.abrupt("return",i({type:"finish",data:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return i({type:"error",error:e})}))},Ye=function(e){return m.a.createElement(N.a,s()({},e,{showFormControls:!1}))};t.default=function(){var e,t,n,a,r=Object(v.a)(),c=Object(h.k)(),s=Object(f.useRef)(),u=function(e){var t=e.values.application;return s.current=t},l=Object(h.m)().app_type_id,p=Object(ye.a)(),d=Object(b.useSelector)((function(e){return e.sources}),b.shallowEqual),y=d.appTypes,j=d.sourceTypesLoaded,E=d.appTypesLoaded,T=d.sourceTypes,A=Object(ve.a)(),x=Object(b.useDispatch)(),k=Object(f.useReducer)(Ue,Ie),C=o()(k,2),V=C[0],N=C[1],F=Object(f.useRef)(document.createElement("div")),L=y.find((function(e){return e.id===l}));Object(f.useEffect)((function(){if(A){var e=V.sourceAppsLength>=A.applications.length&&V.sourceAppsLength>0;N({type:"setSourceAppslength",length:A.applications.length}),e||(A.endpoints&&A.endpoints[0]?Object(be.j)().listEndpointAuthentications(A.endpoints[0].id).then((function(e){var t=e.data;return N({type:"loadAuthentications",authenticationsValues:t,initialValues:{source:A,endpoint:A.endpoints[0],url:Object(Oe.f)(A.endpoints[0]),application:s.current},values:{}})})):N({type:"loadWithoutAuthentications",initialValues:{source:A,application:s.current},values:{}}))}}),[A]);var z=function(){return c.push(Object(je.b)(je.c.sourcesDetail.path,A.id))},I=r.formatMessage({id:"sources.addApplicationNameTitle",defaultMessage:"Connect {appName}"},{appName:(null==L?void 0:L.display_name)||"application"}),U=r.formatMessage({id:"sources.addApplicationNameDescription",defaultMessage:"Configure {appName} for this source."},{appName:(null==L?void 0:L.display_name)||"application"});if(!(E&&j&&p&&"loading"!==V.state||"submitting"===V.state))return m.a.createElement(ge,{goToSources:z,title:I,description:U,step:m.a.createElement(M.a,{customText:r.formatMessage({id:"sources.loading",defaultMessage:"Loading, please wait."}),cancelTitle:r.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:z})});var W=function(e,t){return Je(e,t,V.authenticationsValues,x,N,V.initialValues,y,u)};if("submitting"===V.state)return m.a.createElement(ge,{title:I,description:U,goToSources:z,step:m.a.createElement(M.a,{cancelTitle:r.formatMessage({id:"sources.close",defaultMessage:"Close"}),onClose:z,customText:r.formatMessage({id:"wizard.loadingText defaultMessage=Validating source credentials",defaultMessage:"Validating source credentials"})})});var q=function(){return N({type:"reset"})};if("wizard"!==V.state){var Q;if("finished"!==V.state)Q=m.a.createElement(P.a,{onRetry:q,onClose:z,returnButtonTitle:r.formatMessage({id:"sources.retry",defaultMessage:"Retry"}),primaryAction:function(){return W(V.values,V.formApi)},secondaryActions:m.a.createElement(qe.Text,{component:"a",target:"_blank",href:"https://access.redhat.com/support/cases/#/case/new/open-case?caseCreate=true",rel:"noopener noreferrer"},r.formatMessage({id:"wizard.openTicket",defaultMessage:"Open a support case"}))});else switch(R()(V.data)){default:Q=m.a.createElement(S.a,{title:r.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration successful"}),hideSourcesButton:!0,onClose:z,returnButtonTitle:r.formatMessage({id:"sources.exit",defaultMessage:"Exit"}),successfulMessage:r.formatMessage({id:"sources.successAddApp",defaultMessage:"Your application was successfully added."})});break;case"unavailable":Q=m.a.createElement(P.a,{onRetry:q,onClose:z,message:(null===(e=V.data.applications)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.availability_status_error)||(null===(n=V.data.endpoint)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.availability_status_error)||r.formatMessage({id:"wizard.unknownError",defaultMessage:"Unknown error"}),title:r.formatMessage({id:"sources.configurationSuccessful",defaultMessage:"Configuration unsuccessful"}),secondaryActions:m.a.createElement(We.Button,{variant:"link",onClick:function(){var e,t;return N({type:"reset"}),Object(Qe.a)({id:null===(e=V.data)||void 0===e?void 0:e.id,display_name:null===(t=y.find((function(e){var t;return e.id===(null===(t=V.data)||void 0===t?void 0:t.application_type_id)})))||void 0===t?void 0:t.display_name},r,void 0,x,A)}},r.formatMessage({id:"wizard.removeApp",defaultMessage:"Remove application"})),Component:function(){return m.a.createElement(g.Link,{to:Object(je.b)(je.c.sourcesDetail.path,A.id)},m.a.createElement(We.Button,{variant:"primary",className:"pf-u-mt-xl"},r.formatMessage({id:"wizard.editSource",defaultMessage:"Edit source"})))}});break;case"timeout":Q=m.a.createElement(D.a,{returnButtonTitle:r.formatMessage({id:"sources.exit",defaultMessage:"Exit"}),onClose:z})}return m.a.createElement(ge,{title:I,description:U,goToSources:z,step:Q})}var J=T.find((function(e){return e.id===A.source_type_id})),Y=J&&J.name,G=y.filter((function(e){return e.supported_source_types.includes(Y)})).filter(w.a).map((function(e){return{value:e.id,label:e.display_name}}));if(!L||A.applications.find((function(e){return e.application_type_id===l}))||!L.supported_source_types.includes(J.name))return m.a.createElement(h.c,{to:Object(je.b)(je.c.sourcesDetail.path,A.id)});var K=fe(r,J,L,V.authenticationsValues,A,F.current,I,U,y),X=G.length>0?W:z;return m.a.createElement(m.a.Fragment,null,m.a.createElement(_.a,{title:r.formatMessage({id:"sources.manageAppsCloseModalTitle",defaultMessage:"Exit application adding?"}),isOpen:V.isCancelling,onStay:function(){F.current.hidden=!1,N({type:"toggleCancelling"})},onExit:z}),m.a.createElement(B.a,{schema:K,showFormControls:!1,onSubmit:X,onCancel:function(e){var t=V.initialValues,n=(t.application,i()(t,["application"])),a=(e.application,i()(e,["application"]));!O()(Object(_e.diff)(n,a))?(F.current.hidden=!0,N({type:"toggleCancelling",values:e})):z()},initialValues:V.initialValues,subscription:{values:!0},debug:u,clearedValue:null,FormTemplate:Ye}))}},979:function(e,t,n){"use strict";n.r(t);var a=n(44),i=n.n(a),r=n(0),o=n.n(r),c=n(14),s=n.n(c),u=n(13),l=n(36),p=n(277),d=n(59),f=n(91),m=n(151),h=n(532),g=n(503),b=n(153),v=n(244),y=n.n(v),O=n(67),j=n(456),w=n(82),E=n(25),_=function(e,t){var n;return(null===(n=t.find((function(t){return t.id===e})))||void 0===n?void 0:n.display_name)||"Unknown"},T=["satellite","ansible-tower"],M=function(e,t){var n=t.name,a=t.count;return{noApps:o.a.createElement(E.a,{id:"sources.deleteTextBodyNoApps",defaultMessage:"Removing { name } will permanently delete all data collected.",values:{name:o.a.createElement("b",null,n)}}),withApps:o.a.createElement(E.a,{id:"sources.deleteTextBodyWithApps",defaultMessage:"Removing { name } detaches the following\n        connected {count, plural, one {application} other {applications}} from this source:",values:{name:o.a.createElement("b",null,n),count:a}}),withAppsExtendedText:o.a.createElement(E.a,{id:"sources.deleteTextBodyWithAppsExtended",defaultMessage:"Removing { name } permanently deletes all collected data and detaches the following\n    connected {count, plural, one {application} other {applications}}:",values:{name:o.a.createElement("b",null,n),count:a}})}[e]},A=n(477),P=n(476),x=function(e){var t=e.applications,n=Object(l.useSelector)((function(e){return e.sources}),l.shallowEqual).appTypes;return 1===t.length?o.a.createElement(d.Text,{variant:d.TextVariants.p},_(t[0].application_type_id,n)):o.a.createElement(A.TextList,null,t.map((function(e){var t=e.id,a=e.application_type_id;return o.a.createElement(P.TextListItem,{key:t},_(a,n))})))};x.propTypes={applications:s.a.array};var S=x,k=function(e){var t,n=e.backPath,a=Object(u.k)().push,c=Object(r.useState)(!1),s=i()(c,2),v=s[0],E=s[1],_=Object(p.a)(),A=Object(j.a)(),P=Object(l.useDispatch)(),x=Object(l.useSelector)((function(e){return e.sources}),l.shallowEqual).sourceTypes,k=function(){return a(n)},D=[o.a.createElement(m.Button,{id:"deleteSubmit",key:"submit",variant:"danger",type:"button",onClick:function(){a(w.c.sources.path),P(Object(O.j)(A.id,_.formatMessage({id:"sources.notificationDeleteMessage",defaultMessage:"{title} was deleted successfully."},{title:A.name})))},isDisabled:!v},_.formatMessage({id:"sources.deleteConfirm",defaultMessage:"Remove source and its data"})),o.a.createElement(m.Button,{id:"deleteCancel",key:"cancel",variant:"link",type:"button",onClick:k},_.formatMessage({id:"sources.deleteCancel",defaultMessage:"Cancel"}))],C=null===(t=x.find((function(e){return e.id===A.source_type_id})))||void 0===t?void 0:t.name,R=A.applications.filter((function(e){return!e.isDeleting})),V=o.a.createElement(f.TextContent,null,o.a.createElement(d.Text,{component:d.TextVariants.p},0===R.length&&M("noApps",{name:A.name}),R.length>0&&T.includes(C)&&M("withApps",{name:A.name,count:R.length}),R.length>0&&!T.includes(C)&&M("withAppsExtendedText",{name:A.name,count:R.length})),R.length>0&&o.a.createElement(S,{applications:R}),o.a.createElement(g.Checkbox,{label:_.formatMessage({id:"sources.deleteCheckboxTitle",defaultMessage:"I acknowledge that this action cannot be undone."}),onChange:function(){return E((function(e){return!e}))},"aria-label":_.formatMessage({id:"sources.deleteCheckboxTitle",defaultMessage:"I acknowledge that this action cannot be undone."}),id:"acknowledgeDelete",name:"acknowledgeDelete",isChecked:v}));return o.a.createElement(h.Modal,{className:"ins-c-sources__dialog--warning","aria-label":_.formatMessage({id:"sources.deleteTitle",defaultMessage:"Remove source?"}),header:o.a.createElement(b.Title,{headingLevel:"h1",size:"2xl"},o.a.createElement(y.a,{size:"sm",className:"ins-m-alert ins-c-source__delete-icon pf-u-mr-sm"}),_.formatMessage({id:"sources.deleteTitle",defaultMessage:"Remove source?"})),isOpen:!0,variant:"small",onClose:k,actions:D},V)};k.propTypes={backPath:s.a.string},k.defaultProps={backPath:w.c.sources.path};t.default=k}}]);
//# sourceMappingURL=../sourcemaps/remove.js.map